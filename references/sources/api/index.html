
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/dyvenia/viadot/references/sources/api/">
      
      
        <link rel="prev" href="../database/">
      
      
        <link rel="next" href="../other/">
      
      
      <link rel="icon" href="../../../_static/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>API - viadot</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Open Sans";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="API - viadot" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="https://github.com/dyvenia/viadot/assets/images/social/references/sources/api.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://github.com/dyvenia/viadot/references/sources/api/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="API - viadot" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="https://github.com/dyvenia/viadot/assets/images/social/references/sources/api.png" >
      
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-sources" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="viadot" class="md-header__button md-logo" aria-label="viadot" data-md-component="logo">
      
  <img src="../../../_static/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            viadot
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/dyvenia/viadot" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../getting_started/" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../developer_guide/" class="md-tabs__link">
          
  
  
  Developer Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../advanced_usage/" class="md-tabs__link">
          
  
  
  Advanced Usage

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../database/" class="md-tabs__link">
          
  
  
  References

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="viadot" class="md-nav__button md-logo" aria-label="viadot" data-md-component="logo">
      
  <img src="../../../_static/logo.png" alt="logo">

    </a>
    viadot
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dyvenia/viadot" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/creating_a_source/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating a source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/creating_a_prefect_flow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating a Prefect flow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/contributing_to_viadot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Advanced Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Advanced Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced_usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced_usage/containerized_env/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Containerized development environment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    References
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            References
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" checked>
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Sources
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Sources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Database
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.bigquery.BigQuery" class="md-nav__link">
    <span class="md-ellipsis">
      BigQuery
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BigQuery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.bigquery.BigQuery.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.bigquery.BigQuery.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.business_core.BusinessCore" class="md-nav__link">
    <span class="md-ellipsis">
      BusinessCore
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BusinessCore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.business_core.BusinessCore.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.business_core.BusinessCore.generate_token" class="md-nav__link">
    <span class="md-ellipsis">
      generate_token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.business_core.BusinessCore.get_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.business_core.BusinessCore.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.cloud_for_customers.CloudForCustomers" class="md-nav__link">
    <span class="md-ellipsis">
      CloudForCustomers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CloudForCustomers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.cloud_for_customers.CloudForCustomers.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.cloud_for_customers.CloudForCustomers.create_metadata_url" class="md-nav__link">
    <span class="md-ellipsis">
      create_metadata_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.cloud_for_customers.CloudForCustomers.extract_records" class="md-nav__link">
    <span class="md-ellipsis">
      extract_records
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.cloud_for_customers.CloudForCustomers.get_entities" class="md-nav__link">
    <span class="md-ellipsis">
      get_entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.cloud_for_customers.CloudForCustomers.get_property_to_sap_label_dict" class="md-nav__link">
    <span class="md-ellipsis">
      get_property_to_sap_label_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.cloud_for_customers.CloudForCustomers.get_response" class="md-nav__link">
    <span class="md-ellipsis">
      get_response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.cloud_for_customers.CloudForCustomers.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.customer_gauge.CustomerGauge" class="md-nav__link">
    <span class="md-ellipsis">
      CustomerGauge
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CustomerGauge">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.customer_gauge.CustomerGauge.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.customer_gauge.CustomerGauge.api_connection" class="md-nav__link">
    <span class="md-ellipsis">
      api_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.customer_gauge.CustomerGauge.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.epicor.Epicor" class="md-nav__link">
    <span class="md-ellipsis">
      Epicor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Epicor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.epicor.Epicor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.epicor.Epicor.generate_token" class="md-nav__link">
    <span class="md-ellipsis">
      generate_token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.epicor.Epicor.get_xml_response" class="md-nav__link">
    <span class="md-ellipsis">
      get_xml_response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.epicor.Epicor.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.epicor.Epicor.validate_filter" class="md-nav__link">
    <span class="md-ellipsis">
      validate_filter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.eurostat.Eurostat" class="md-nav__link">
    <span class="md-ellipsis">
      Eurostat
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Eurostat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.eurostat.Eurostat.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.eurostat.Eurostat.eurostat_dictionary_to_df" class="md-nav__link">
    <span class="md-ellipsis">
      eurostat_dictionary_to_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.eurostat.Eurostat.get_parameters_codes" class="md-nav__link">
    <span class="md-ellipsis">
      get_parameters_codes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.eurostat.Eurostat.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.eurostat.Eurostat.validate_params" class="md-nav__link">
    <span class="md-ellipsis">
      validate_params
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.exchange_rates.ExchangeRates" class="md-nav__link">
    <span class="md-ellipsis">
      ExchangeRates
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExchangeRates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.exchange_rates.ExchangeRates.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.exchange_rates.ExchangeRates.get_columns" class="md-nav__link">
    <span class="md-ellipsis">
      get_columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.exchange_rates.ExchangeRates.get_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.exchange_rates.ExchangeRates.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.exchange_rates.ExchangeRates.to_json" class="md-nav__link">
    <span class="md-ellipsis">
      to_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.exchange_rates.ExchangeRates.to_records" class="md-nav__link">
    <span class="md-ellipsis">
      to_records
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.genesys.Genesys" class="md-nav__link">
    <span class="md-ellipsis">
      Genesys
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Genesys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.genesys.Genesys.headers" class="md-nav__link">
    <span class="md-ellipsis">
      headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.genesys.Genesys.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.genesys.Genesys.api_connection" class="md-nav__link">
    <span class="md-ellipsis">
      api_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.genesys.Genesys.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.hubspot.Hubspot" class="md-nav__link">
    <span class="md-ellipsis">
      Hubspot
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hubspot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.hubspot.Hubspot.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.hubspot.Hubspot.api_connection" class="md-nav__link">
    <span class="md-ellipsis">
      api_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.hubspot.Hubspot.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.mediatool.Mediatool" class="md-nav__link">
    <span class="md-ellipsis">
      Mediatool
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mediatool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.mediatool.Mediatool.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.mediatool.Mediatool.fetch_and_transform" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_and_transform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.mediatool.Mediatool.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.mindful.Mindful" class="md-nav__link">
    <span class="md-ellipsis">
      Mindful
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mindful">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.mindful.Mindful.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.mindful.Mindful.api_connection" class="md-nav__link">
    <span class="md-ellipsis">
      api_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.mindful.Mindful.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources._minio.MinIO" class="md-nav__link">
    <span class="md-ellipsis">
      MinIO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MinIO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources._minio.MinIO.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources._minio.MinIO.check_connection" class="md-nav__link">
    <span class="md-ellipsis">
      check_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources._minio.MinIO.from_arrow" class="md-nav__link">
    <span class="md-ellipsis">
      from_arrow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources._minio.MinIO.from_df" class="md-nav__link">
    <span class="md-ellipsis">
      from_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources._minio.MinIO.ls" class="md-nav__link">
    <span class="md-ellipsis">
      ls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources._minio.MinIO.rm" class="md-nav__link">
    <span class="md-ellipsis">
      rm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.outlook.Outlook" class="md-nav__link">
    <span class="md-ellipsis">
      Outlook
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Outlook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.outlook.Outlook.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.outlook.Outlook.api_connection" class="md-nav__link">
    <span class="md-ellipsis">
      api_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.outlook.Outlook.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.salesforce.Salesforce" class="md-nav__link">
    <span class="md-ellipsis">
      Salesforce
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Salesforce">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.salesforce.Salesforce.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.salesforce.Salesforce.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.salesforce.Salesforce.upsert" class="md-nav__link">
    <span class="md-ellipsis">
      upsert
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.sharepoint.Sharepoint" class="md-nav__link">
    <span class="md-ellipsis">
      Sharepoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sharepoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.sharepoint.Sharepoint.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.sharepoint.Sharepoint.download_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.sharepoint.Sharepoint.get_connection" class="md-nav__link">
    <span class="md-ellipsis">
      get_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.sharepoint.Sharepoint.scan_sharepoint_folder" class="md-nav__link">
    <span class="md-ellipsis">
      scan_sharepoint_folder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.sharepoint.Sharepoint.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.supermetrics.Supermetrics" class="md-nav__link">
    <span class="md-ellipsis">
      Supermetrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Supermetrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.supermetrics.Supermetrics.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.supermetrics.Supermetrics.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.supermetrics.Supermetrics.to_json" class="md-nav__link">
    <span class="md-ellipsis">
      to_json
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.uk_carbon_intensity.UKCarbonIntensity" class="md-nav__link">
    <span class="md-ellipsis">
      UKCarbonIntensity
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UKCarbonIntensity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.uk_carbon_intensity.UKCarbonIntensity.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.uk_carbon_intensity.UKCarbonIntensity.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.uk_carbon_intensity.UKCarbonIntensity.query" class="md-nav__link">
    <span class="md-ellipsis">
      query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.uk_carbon_intensity.UKCarbonIntensity.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.uk_carbon_intensity.UKCarbonIntensity.to_json" class="md-nav__link">
    <span class="md-ellipsis">
      to_json
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viadot.sources.vid_club.VidClub" class="md-nav__link">
    <span class="md-ellipsis">
      VidClub
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VidClub">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viadot.sources.vid_club.VidClub.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.vid_club.VidClub.build_query" class="md-nav__link">
    <span class="md-ellipsis">
      build_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.vid_club.VidClub.check_connection" class="md-nav__link">
    <span class="md-ellipsis">
      check_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.vid_club.VidClub.get_response" class="md-nav__link">
    <span class="md-ellipsis">
      get_response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.vid_club.VidClub.intervals" class="md-nav__link">
    <span class="md-ellipsis">
      intervals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viadot.sources.vid_club.VidClub.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../other/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Other
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Orchestration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Orchestration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_1" >
        
          
          <label class="md-nav__link" for="__nav_5_2_1" id="__nav_5_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Prefect
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_1">
            <span class="md-nav__icon md-icon"></span>
            Prefect
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../orchestration/prefect/tasks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tasks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../orchestration/prefect/flows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flows
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/dyvenia/viadot/blob/main/docs/references/sources/api.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/dyvenia/viadot/raw/main/docs/references/sources/api.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg>
    </a>
  


<h1 id="api-sources">API sources</h1>


<div class="doc doc-object doc-class">



<h2 id="viadot.sources.bigquery.BigQuery" class="doc doc-heading">
            <code>viadot.sources.bigquery.BigQuery</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>


        <p>Class to connect with Bigquery project and SQL tables.</p>
<p>Documentation for this API is located at: https://cloud.google.com/bigquery/docs.</p>







              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/bigquery.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BigQuery</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to connect with Bigquery project and SQL tables.</span>

<span class="sd">    Documentation for this API is located at: https://cloud.google.com/bigquery/docs.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">BigQueryCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an instance of the BigQuery class.</span>

<span class="sd">        Args:</span>
<span class="sd">            credentials (BigQueryCredentials, optional): BigQuery credentials.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            config_key (str, optional): The key in the viadot config holding</span>
<span class="sd">                relevant credentials. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">credentials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Missing credentials.&quot;</span>
            <span class="k">raise</span> <span class="n">CredentialError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">BigQueryCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">credentials</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">credentials_service_account</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">service_account</span><span class="o">.</span><span class="n">Credentials</span><span class="o">.</span><span class="n">from_service_account_info</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project_id</span> <span class="o">=</span> <span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;project_id&quot;</span><span class="p">]</span>

        <span class="n">pandas_gbq</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials_service_account</span>
        <span class="n">pandas_gbq</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_id</span>

    <span class="k">def</span> <span class="nf">_get_list_datasets_query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get datasets from BigQuery project.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Custom query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT schema_name</span>
<span class="s2">                FROM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_id</span><span class="si">}</span><span class="s2">.INFORMATION_SCHEMA.SCHEMATA</span>
<span class="s2">                &quot;&quot;&quot;</span>  <span class="c1"># noqa: S608</span>

    <span class="k">def</span> <span class="nf">_get_list_tables_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get tables from BigQuery dataset. Dataset is required.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset_name (str): Dataset from Bigquery project.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Custom query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT table_name</span>
<span class="s2">                FROM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">.INFORMATION_SCHEMA.TABLES</span>
<span class="s2">                &quot;&quot;&quot;</span>  <span class="c1"># noqa: S608</span>

    <span class="k">def</span> <span class="nf">_list_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get columns from BigQuery table. Dataset name and Table name are required.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset_name (str): Dataset from Bigquery project.</span>
<span class="sd">            table_name (str): Table name from given dataset.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: List of table names from the BigQuery dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT column_name</span>
<span class="s2">                FROM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">.INFORMATION_SCHEMA.COLUMNS</span>
<span class="s2">                WHERE table_name=&quot;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="s2">                &quot;&quot;&quot;</span>  <span class="c1"># noqa: S608</span>
        <span class="n">df_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_google_bigquery_data</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df_columns</span><span class="p">[</span><span class="s2">&quot;column_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="nf">_get_google_bigquery_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Connect to BigQuery API.</span>

<span class="sd">        Args:</span>
<span class="sd">            query (str): SQL query to querying data in BigQuery. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            APIError: Error with BigQuery API connection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: BigQuery response data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pandas_gbq</span><span class="o">.</span><span class="n">read_gbq</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GenericGBQException</span> <span class="k">as</span> <span class="n">message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">message</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@add_viadot_metadata_columns</span>
    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">date_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">if_empty</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a DataFrame from the API response of a queried BigQuery table.</span>

<span class="sd">        Args:</span>
<span class="sd">            query (str): SQL query to querying data in BigQuery.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">                Espetial queries:</span>
<span class="sd">                -----------------</span>
<span class="sd">                If the words &quot;tables&quot; or &quot;datasets&quot; are passed in this parameter all</span>
<span class="sd">                tables and data sets will be returned as special internal queries.</span>
<span class="sd">            dataset_name (str, optional): Dataset name. Defaults to None.</span>
<span class="sd">            table_name (str, optional): Table name. Defaults to None.</span>
<span class="sd">            date_column_name (str, optional): The user can provide the name of the date.</span>
<span class="sd">                If the user-specified column does not exist, all data will be retrieved</span>
<span class="sd">                from the table. Defaults to None.</span>
<span class="sd">            start_date (str, optional): Parameter to pass start date e.g.</span>
<span class="sd">                &quot;2022-01-01&quot;. Defaults to None.</span>
<span class="sd">            end_date (str, optional): Parameter to pass end date e.g.</span>
<span class="sd">                &quot;2022-01-01&quot;. Defaults to None.</span>
<span class="sd">            columns (list[str], optional): List of columns from given table name.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            if_empty (Literal[warn, skip, fail], optional): What to do if there is no</span>
<span class="sd">                data. Defaults to &quot;warn&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: DataFrame with the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">query</span> <span class="o">==</span> <span class="s2">&quot;tables&quot;</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_list_tables_query</span><span class="p">(</span><span class="n">dataset_name</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">query</span> <span class="o">==</span> <span class="s2">&quot;datasets&quot;</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_list_datasets_query</span><span class="p">()</span>

        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;select&quot;</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;from&quot;</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;query has been provided!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">date_column_name</span> <span class="ow">or</span> <span class="n">columns</span><span class="p">:</span>
                <span class="n">table_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_columns</span><span class="p">(</span>
                    <span class="n">dataset_name</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">table_columns</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Some of the columns provided are either, not in the table or &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;the list is empty. Downloading all the data instead.&quot;</span>
                <span class="p">)</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">date_column_name</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="nb">set</span><span class="p">([</span><span class="n">date_column_name</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">table_columns</span><span class="p">))</span>  <span class="c1"># noqa: C405</span>
                    <span class="ow">or</span> <span class="n">start_date</span> <span class="ow">is</span> <span class="kc">None</span>
                    <span class="ow">or</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">date_column_name</span><span class="si">}</span><span class="s2">&#39; column is not recognized, &quot;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;or either `start_date`: </span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> or `end_date`: &quot;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2"> is None.</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;Downloading all the data instead.&quot;</span>
                    <span class="p">)</span>
                    <span class="n">query</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Filtering data from date </span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                        SELECT </span><span class="si">{</span><span class="n">columns</span><span class="si">}</span>
<span class="s2">                            FROM `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">`</span>
<span class="s2">                            WHERE </span><span class="si">{</span><span class="n">date_column_name</span><span class="si">}</span><span class="s2"> BETWEEN</span>
<span class="s2">                                PARSE_DATE(&quot;%Y-%m-%d&quot;, &quot;</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2">&quot;) AND</span>
<span class="s2">                                PARSE_DATE(&quot;%Y-%m-%d&quot;, &quot;</span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;)</span>
<span class="s2">                            ORDER BY </span><span class="si">{</span><span class="n">date_column_name</span><span class="si">}</span><span class="s2"> DESC</span>
<span class="s2">                    &quot;&quot;&quot;</span>  <span class="c1"># noqa: S608</span>

            <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;SELECT </span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;FROM `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_google_bigquery_data</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span><span class="n">if_empty</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded the data from the table name: &#39;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.bigquery.BigQuery.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create an instance of the BigQuery class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>credentials</code>
            </td>
            <td>
                  <code><span title="viadot.sources.bigquery.BigQueryCredentials">BigQueryCredentials</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>BigQuery credentials.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key in the viadot config holding
relevant credentials. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/bigquery.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="n">BigQueryCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an instance of the BigQuery class.</span>

<span class="sd">    Args:</span>
<span class="sd">        credentials (BigQueryCredentials, optional): BigQuery credentials.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        config_key (str, optional): The key in the viadot config holding</span>
<span class="sd">            relevant credentials. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">credentials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Missing credentials.&quot;</span>
        <span class="k">raise</span> <span class="n">CredentialError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">BigQueryCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">credentials</span><span class="p">))</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">credentials_service_account</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">service_account</span><span class="o">.</span><span class="n">Credentials</span><span class="o">.</span><span class="n">from_service_account_info</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">project_id</span> <span class="o">=</span> <span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;project_id&quot;</span><span class="p">]</span>

    <span class="n">pandas_gbq</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials_service_account</span>
    <span class="n">pandas_gbq</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.bigquery.BigQuery.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dataset_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">date_column_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">if_empty</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a DataFrame from the API response of a queried BigQuery table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQL query to querying data in BigQuery.
Defaults to None.
Espetial queries:</p>
<hr />
<p>If the words "tables" or "datasets" are passed in this parameter all
tables and data sets will be returned as special internal queries.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataset_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset name. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>table_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table name. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>date_column_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The user can provide the name of the date.
If the user-specified column does not exist, all data will be retrieved
from the table. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter to pass start date e.g.
"2022-01-01". Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter to pass end date e.g.
"2022-01-01". Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>columns</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns from given table name.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>if_empty</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[<span title="warn">warn</span>, <span title="skip">skip</span>, <span title="fail">fail</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What to do if there is no
data. Defaults to "warn".</p>
              </div>
            </td>
            <td>
                  <code>&#39;warn&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: DataFrame with the data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/bigquery.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_viadot_metadata_columns</span>
<span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">date_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">if_empty</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a DataFrame from the API response of a queried BigQuery table.</span>

<span class="sd">    Args:</span>
<span class="sd">        query (str): SQL query to querying data in BigQuery.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">            Espetial queries:</span>
<span class="sd">            -----------------</span>
<span class="sd">            If the words &quot;tables&quot; or &quot;datasets&quot; are passed in this parameter all</span>
<span class="sd">            tables and data sets will be returned as special internal queries.</span>
<span class="sd">        dataset_name (str, optional): Dataset name. Defaults to None.</span>
<span class="sd">        table_name (str, optional): Table name. Defaults to None.</span>
<span class="sd">        date_column_name (str, optional): The user can provide the name of the date.</span>
<span class="sd">            If the user-specified column does not exist, all data will be retrieved</span>
<span class="sd">            from the table. Defaults to None.</span>
<span class="sd">        start_date (str, optional): Parameter to pass start date e.g.</span>
<span class="sd">            &quot;2022-01-01&quot;. Defaults to None.</span>
<span class="sd">        end_date (str, optional): Parameter to pass end date e.g.</span>
<span class="sd">            &quot;2022-01-01&quot;. Defaults to None.</span>
<span class="sd">        columns (list[str], optional): List of columns from given table name.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        if_empty (Literal[warn, skip, fail], optional): What to do if there is no</span>
<span class="sd">            data. Defaults to &quot;warn&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: DataFrame with the data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">query</span> <span class="o">==</span> <span class="s2">&quot;tables&quot;</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_list_tables_query</span><span class="p">(</span><span class="n">dataset_name</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">query</span> <span class="o">==</span> <span class="s2">&quot;datasets&quot;</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_list_datasets_query</span><span class="p">()</span>

    <span class="k">elif</span> <span class="p">(</span>
        <span class="n">query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;select&quot;</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;from&quot;</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;query has been provided!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">date_column_name</span> <span class="ow">or</span> <span class="n">columns</span><span class="p">:</span>
            <span class="n">table_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_columns</span><span class="p">(</span>
                <span class="n">dataset_name</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">table_columns</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Some of the columns provided are either, not in the table or &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;the list is empty. Downloading all the data instead.&quot;</span>
            <span class="p">)</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">date_column_name</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="nb">set</span><span class="p">([</span><span class="n">date_column_name</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">table_columns</span><span class="p">))</span>  <span class="c1"># noqa: C405</span>
                <span class="ow">or</span> <span class="n">start_date</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">date_column_name</span><span class="si">}</span><span class="s2">&#39; column is not recognized, &quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;or either `start_date`: </span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> or `end_date`: &quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2"> is None.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;Downloading all the data instead.&quot;</span>
                <span class="p">)</span>
                <span class="n">query</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Filtering data from date </span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    SELECT </span><span class="si">{</span><span class="n">columns</span><span class="si">}</span>
<span class="s2">                        FROM `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">`</span>
<span class="s2">                        WHERE </span><span class="si">{</span><span class="n">date_column_name</span><span class="si">}</span><span class="s2"> BETWEEN</span>
<span class="s2">                            PARSE_DATE(&quot;%Y-%m-%d&quot;, &quot;</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2">&quot;) AND</span>
<span class="s2">                            PARSE_DATE(&quot;%Y-%m-%d&quot;, &quot;</span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;)</span>
<span class="s2">                        ORDER BY </span><span class="si">{</span><span class="n">date_column_name</span><span class="si">}</span><span class="s2"> DESC</span>
<span class="s2">                &quot;&quot;&quot;</span>  <span class="c1"># noqa: S608</span>

        <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;SELECT </span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;FROM `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">`&quot;</span>
            <span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_google_bigquery_data</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span><span class="n">if_empty</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded the data from the table name: &#39;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.business_core.BusinessCore" class="doc doc-heading">
            <code>viadot.sources.business_core.BusinessCore</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>


        <p>Business Core ERP API connector.</p>







              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/business_core.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BusinessCore</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Business Core ERP API connector.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BusinessCore&quot;</span><span class="p">,</span>
        <span class="n">verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a BusinessCore connector instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str, optional): Base url to a view in Business Core API.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            filters (dict[str, Any], optional): Filters in form of dictionary. Available</span>
<span class="sd">                filters: &#39;BucketCount&#39;, &#39;BucketNo&#39;, &#39;FromDate&#39;, &#39;ToDate&#39;. Defaults to</span>
<span class="sd">                None.</span>
<span class="sd">            credentials (dict[str, Any], optional): Credentials stored in a dictionary.</span>
<span class="sd">                Required credentials: username, password. Defaults to None.</span>
<span class="sd">            config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">                credentials. Defaults to &quot;BusinessCore&quot;.</span>
<span class="sd">            verify (bool, optional): Whether or not verify certificates while connecting</span>
<span class="sd">                to an API. Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
        <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">BusinessCoreCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="c1"># API requires that filters are always specified</span>
        <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;BucketCount&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;BucketNo&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;FromDate&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ToDate&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="n">verify</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a token for the user.</span>

<span class="sd">        Returns:</span>
<span class="sd">            string: The token.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://api.businesscore.ae/api/user/Login&quot;</span>

        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;grant_type=password&amp;username=</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&amp;password=</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">&amp;scope=&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_clean_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace &#39;None&#39; with &#39;&amp;&#39; in a dictionary.</span>

<span class="sd">        Required for payload in &#39;x-www-form-urlencoded&#39; from.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, str]: Dictionary with filters prepared for further use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;&amp;&quot;</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Obtain data from Business Core API.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary with data downloaded from Business Core API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">view</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;GetCustomerData&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GetItemMaster&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GetPendingSalesOrderData&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GetSalesInvoiceData&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GetSalesReturnDetailData&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GetSalesOrderData&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GetSalesQuotationData&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;View </span><span class="si">{</span><span class="n">view</span><span class="si">}</span><span class="s2"> currently not available.&quot;</span>
            <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;BucketCount=&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;BucketCount&quot;</span><span class="p">))</span>
            <span class="o">+</span> <span class="s2">&quot;BucketNo=&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;BucketNo&quot;</span><span class="p">))</span>
            <span class="o">+</span> <span class="s2">&quot;FromDate=&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FromDate&quot;</span><span class="p">))</span>
            <span class="o">+</span> <span class="s2">&quot;ToDate&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ToDate&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_token</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Downloading the data...&quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Data was downloaded successfully.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MasterDataList&quot;</span><span class="p">)</span>

    <span class="nd">@add_viadot_metadata_columns</span>
    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">if_empty</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;skip&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download data into a pandas DataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            if_empty (Literal[&quot;warn&quot;, &quot;fail&quot;, &quot;skip&quot;], optional): What to do if output</span>
<span class="sd">                DataFrame is empty. Defaults to &quot;skip&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: DataFrame with the data.</span>

<span class="sd">        Raises:</span>
<span class="sd">            APIError: When selected API view is not available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Data was successfully transformed into DataFrame: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> columns and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows.&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span><span class="n">if_empty</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.business_core.BusinessCore.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_key</span><span class="o">=</span><span class="s1">&#39;BusinessCore&#39;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a BusinessCore connector instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base url to a view in Business Core API.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filters in form of dictionary. Available
filters: 'BucketCount', 'BucketNo', 'FromDate', 'ToDate'. Defaults to
None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>credentials</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Credentials stored in a dictionary.
Required credentials: username, password. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key in the viadot config holding relevant
credentials. Defaults to "BusinessCore".</p>
              </div>
            </td>
            <td>
                  <code>&#39;BusinessCore&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verify</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not verify certificates while connecting
to an API. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/business_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BusinessCore&quot;</span><span class="p">,</span>
    <span class="n">verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a BusinessCore connector instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str, optional): Base url to a view in Business Core API.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        filters (dict[str, Any], optional): Filters in form of dictionary. Available</span>
<span class="sd">            filters: &#39;BucketCount&#39;, &#39;BucketNo&#39;, &#39;FromDate&#39;, &#39;ToDate&#39;. Defaults to</span>
<span class="sd">            None.</span>
<span class="sd">        credentials (dict[str, Any], optional): Credentials stored in a dictionary.</span>
<span class="sd">            Required credentials: username, password. Defaults to None.</span>
<span class="sd">        config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">            credentials. Defaults to &quot;BusinessCore&quot;.</span>
<span class="sd">        verify (bool, optional): Whether or not verify certificates while connecting</span>
<span class="sd">            to an API. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
    <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">BusinessCoreCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
    <span class="c1"># API requires that filters are always specified</span>
    <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;BucketCount&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BucketNo&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FromDate&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ToDate&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="n">verify</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.business_core.BusinessCore.generate_token" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_token</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a token for the user.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>string</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The token.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/business_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a token for the user.</span>

<span class="sd">    Returns:</span>
<span class="sd">        string: The token.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://api.businesscore.ae/api/user/Login&quot;</span>

    <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;grant_type=password&amp;username=</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&amp;password=</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">&amp;scope=&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
        <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.business_core.BusinessCore.get_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_data</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Obtain data from Business Core API.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with data downloaded from Business Core API.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/business_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Obtain data from Business Core API.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary with data downloaded from Business Core API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">view</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;GetCustomerData&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GetItemMaster&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GetPendingSalesOrderData&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GetSalesInvoiceData&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GetSalesReturnDetailData&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GetSalesOrderData&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GetSalesQuotationData&quot;</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;View </span><span class="si">{</span><span class="n">view</span><span class="si">}</span><span class="s2"> currently not available.&quot;</span>
        <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;BucketCount=&quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;BucketCount&quot;</span><span class="p">))</span>
        <span class="o">+</span> <span class="s2">&quot;BucketNo=&quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;BucketNo&quot;</span><span class="p">))</span>
        <span class="o">+</span> <span class="s2">&quot;FromDate=&quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FromDate&quot;</span><span class="p">))</span>
        <span class="o">+</span> <span class="s2">&quot;ToDate&quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ToDate&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_token</span><span class="p">(),</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Downloading the data...&quot;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
        <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Data was downloaded successfully.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MasterDataList&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.business_core.BusinessCore.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="s1">&#39;skip&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download data into a pandas DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>if_empty</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;warn&#39;, &#39;fail&#39;, &#39;skip&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What to do if output
DataFrame is empty. Defaults to "skip".</p>
              </div>
            </td>
            <td>
                  <code>&#39;skip&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: DataFrame with the data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="viadot.exceptions.APIError">APIError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When selected API view is not available.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/business_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_viadot_metadata_columns</span>
<span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">if_empty</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;skip&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download data into a pandas DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        if_empty (Literal[&quot;warn&quot;, &quot;fail&quot;, &quot;skip&quot;], optional): What to do if output</span>
<span class="sd">            DataFrame is empty. Defaults to &quot;skip&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: DataFrame with the data.</span>

<span class="sd">    Raises:</span>
<span class="sd">        APIError: When selected API view is not available.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Data was successfully transformed into DataFrame: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> columns and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows.&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span><span class="n">if_empty</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.cloud_for_customers.CloudForCustomers" class="doc doc-heading">
            <code>viadot.sources.cloud_for_customers.CloudForCustomers</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>


        <p>Cloud for Customers connector to fetch OData source.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL to the C4C API. For example,
'https://myNNNNNN.crm.ondemand.com/c4c/v1/'.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>endpoint</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The API endpoint.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>report_url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL of a prepared report.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter_params</code>
            </td>
            <td>
                  <code><span title="Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filtering parameters passed to the
request. E.g {"$filter": "AccountID eq '1234'"}. More info on:
https://userapps.support.sap.com/sap/support/knowledge/en/2330688</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>credentials</code>
            </td>
            <td>
                  <code><span title="viadot.sources.cloud_for_customers.CloudForCustomersCredentials">CloudForCustomersCredentials</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cloud for Customers
credentials.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key in the viadot config holding relevant
credentials.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/cloud_for_customers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CloudForCustomers</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cloud for Customers connector to fetch OData source.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str, optional): The URL to the C4C API. For example,</span>
<span class="sd">            &#39;https://myNNNNNN.crm.ondemand.com/c4c/v1/&#39;.</span>
<span class="sd">        endpoint (str, optional): The API endpoint.</span>
<span class="sd">        report_url (str, optional): The URL of a prepared report.</span>
<span class="sd">        filter_params (Dict[str, Any], optional): Filtering parameters passed to the</span>
<span class="sd">            request. E.g {&quot;$filter&quot;: &quot;AccountID eq &#39;1234&#39;&quot;}. More info on:</span>
<span class="sd">            https://userapps.support.sap.com/sap/support/knowledge/en/2330688</span>
<span class="sd">        credentials (CloudForCustomersCredentials, optional): Cloud for Customers</span>
<span class="sd">            credentials.</span>
<span class="sd">        config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">            credentials.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DEFAULT_PARAMS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;$format&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">}</span>  <span class="c1"># noqa: RUF012</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">report_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filter_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">CloudForCustomersCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the class with the provided parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            *args: Variable length argument list.</span>
<span class="sd">            url (str, optional): The base URL for the service.</span>
<span class="sd">            endpoint (str, optional): The specific endpoint for the service.</span>
<span class="sd">            report_url (str, optional): The URL for the report.</span>
<span class="sd">            filter_params (Dict[str, Any], optional): Parameters to filter the report</span>
<span class="sd">                data.</span>
<span class="sd">            credentials (CloudForCustomersCredentials, optional): Credentials required</span>
<span class="sd">                for authentication.</span>
<span class="sd">            config_key (Optional[str], optional): A key to retrieve specific</span>
<span class="sd">                configuration settings.</span>
<span class="sd">            **kwargs: Arbitrary keyword arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Credentials logic</span>
        <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">CloudForCustomersCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># validate the credentials</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_url</span> <span class="o">=</span> <span class="n">report_url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;report_url&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_report</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoint</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filter_params</span><span class="p">:</span>
            <span class="n">filter_params_merged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_PARAMS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">filter_params_merged</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">filter_params</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">filter_params</span> <span class="o">=</span> <span class="n">filter_params_merged</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filter_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_PARAMS</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_metadata_url</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create URL to fetch metadata from.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): The URL to transform to metadata URL.</span>

<span class="sd">        Returns:</span>
<span class="sd">            meta_url (str): The URL to fetch metadata from.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.svc&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">url_raw</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">url_raw</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">start</span> <span class="o">+</span> <span class="s2">&quot;.svc/$metadata?entityset=&quot;</span> <span class="o">+</span> <span class="n">end</span>

    <span class="k">def</span> <span class="nf">_extract_records_from_report_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch report_url to extract records.</span>

<span class="sd">        Args:</span>
<span class="sd">            report_url (str): The url to extract records from.</span>

<span class="sd">        Returns:</span>
<span class="sd">            records (List[Dict[str, Any]]): The records extracted from report_url.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">report_url</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">report_url</span><span class="p">,</span> <span class="n">filter_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_params</span><span class="p">)</span>
            <span class="n">response_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">new_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entities</span><span class="p">(</span><span class="n">response_json</span><span class="p">,</span> <span class="n">report_url</span><span class="p">)</span>
            <span class="n">records</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_records</span><span class="p">)</span>

            <span class="n">report_url</span> <span class="o">=</span> <span class="n">response_json</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;__next&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">records</span>

    <span class="k">def</span> <span class="nf">_extract_records_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch URL to extract records.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): The URL to extract records from.</span>

<span class="sd">        Returns:</span>
<span class="sd">            records (List[Dict[str, Any]]): The records extracted from URL.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmp_full_url</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">tmp_filter_params</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_params</span><span class="p">)</span>
        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">tmp_full_url</span><span class="p">,</span> <span class="n">filter_params</span><span class="o">=</span><span class="n">tmp_filter_params</span><span class="p">)</span>
            <span class="n">response_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response_json</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1"># ODATA v2+ API</span>
                <span class="n">new_records</span> <span class="o">=</span> <span class="n">response_json</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">)</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">response_json</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;__next&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># ODATA v1</span>
                <span class="n">new_records</span> <span class="o">=</span> <span class="n">response_json</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">response_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;__next&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="c1"># prevents concatenation of previous urls with filter_params with the same</span>
            <span class="c1"># filter_params</span>
            <span class="n">tmp_filter_params</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">tmp_full_url</span> <span class="o">=</span> <span class="n">url</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">new_records</span><span class="p">,</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">):</span>
                <span class="n">records</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_records</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">records</span>

    <span class="k">def</span> <span class="nf">extract_records</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">report_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download records from `url` or `report_url` if present.</span>

<span class="sd">        Returns:</span>
<span class="sd">            records (List[Dict[str, Any]]): The records extracted from URL.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_report</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_records_from_report_url</span><span class="p">(</span><span class="n">report_url</span><span class="o">=</span><span class="n">report_url</span><span class="p">)</span>
        <span class="n">full_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">)</span> <span class="k">if</span> <span class="n">url</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_url</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_records_from_url</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">full_url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_entities</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dirty_json</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract entities from request.json().</span>

<span class="sd">        Entities represent objects that store information. More info on:</span>
<span class="sd">        https://help.sap.com/docs/EAD_HANA/0e60f05842fd41078917822867220c78/</span>
<span class="sd">        0bd1db568fa546d6823d4c19a6b609ab.html</span>

<span class="sd">        Args:</span>
<span class="sd">            dirty_json (Dict[str, Any]): request.json() dict from response to API.</span>
<span class="sd">            url (str): The URL to fetch metadata from.</span>

<span class="sd">        Returns:</span>
<span class="sd">            entities (List[Dict[str, Any]]): list filled with entities.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_metadata_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">column_maper_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_property_to_sap_label_dict</span><span class="p">(</span><span class="n">metadata_url</span><span class="p">)</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">dirty_json</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">][</span><span class="s2">&quot;results&quot;</span><span class="p">]:</span>
            <span class="n">new_entity</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">object_of_interest</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;__metadata&quot;</span><span class="p">,</span> <span class="s2">&quot;Photo&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Picture&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="s2">&quot;{&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">object_of_interest</span>
                <span class="p">):</span>
                    <span class="n">new_key</span> <span class="o">=</span> <span class="n">column_maper_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">new_key</span><span class="p">:</span>
                        <span class="n">new_entity</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">object_of_interest</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_entity</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">object_of_interest</span>
            <span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_entity</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">entities</span>

    <span class="k">def</span> <span class="nf">get_property_to_sap_label_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create Dict that maps Property Name to value of SAP label.</span>

<span class="sd">           Property: Properties define the characteristics of the data.</span>
<span class="sd">           SAP label: Labels are used for identification and for provision of content</span>
<span class="sd">           information.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str, optional): The URL to fetch metadata from.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, str]: Property Name to value of SAP label.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">column_mapping</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
            <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">url</span><span class="p">,</span>
                <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()),</span>
                <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="mf">3.05</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&gt;&quot;</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                    <span class="sa">r</span><span class="s1">&#39;(?&lt;=Name=&quot;)([^&quot;]+).+(sap:label=&quot;)([^&quot;]+)+&#39;</span><span class="p">,</span> <span class="n">sentence</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">groups</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">groups</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">column_mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">column_mapping</span>

    <span class="k">def</span> <span class="nf">get_response</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filter_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.05</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">30</span><span class="p">),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle requests.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): The url to request to.</span>
<span class="sd">            filter_params (Dict[str, Any], optional): Additional parameters like filter,</span>
<span class="sd">                used in case of normal url.</span>
<span class="sd">            timeout (tuple, optional): The request time-out. Default is (3.05, 60 * 30).</span>

<span class="sd">        Returns:</span>
<span class="sd">            requests.models.Response.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">handle_api_response</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">filter_params</span><span class="p">,</span>
            <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()),</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">if_empty</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download a table or report into a pandas DataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            kwargs: The parameters to pass to DataFrame constructor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            df (pandas.DataFrame): DataFrame containing the records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Your implementation here</span>
        <span class="k">if</span> <span class="n">if_empty</span> <span class="o">==</span> <span class="s2">&quot;warn&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Warning: DataFrame is empty.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">if_empty</span> <span class="o">==</span> <span class="s2">&quot;skip&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping due to empty DataFrame.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">if_empty</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failing due to empty DataFrame.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid value for if_empty parameter.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">tests</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tests&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span>
        <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_records</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">report_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">report_url</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">records</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dtype</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fields</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">fields</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">tests</span><span class="p">:</span>
            <span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="n">tests</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.cloud_for_customers.CloudForCustomers.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">report_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filter_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the class with the provided parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>*args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable length argument list.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The base URL for the service.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>endpoint</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The specific endpoint for the service.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>report_url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL for the report.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter_params</code>
            </td>
            <td>
                  <code><span title="Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters to filter the report
data.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>credentials</code>
            </td>
            <td>
                  <code><span title="viadot.sources.cloud_for_customers.CloudForCustomersCredentials">CloudForCustomersCredentials</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Credentials required
for authentication.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_key</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A key to retrieve specific
configuration settings.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Arbitrary keyword arguments.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/cloud_for_customers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">report_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filter_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="n">CloudForCustomersCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the class with the provided parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        *args: Variable length argument list.</span>
<span class="sd">        url (str, optional): The base URL for the service.</span>
<span class="sd">        endpoint (str, optional): The specific endpoint for the service.</span>
<span class="sd">        report_url (str, optional): The URL for the report.</span>
<span class="sd">        filter_params (Dict[str, Any], optional): Parameters to filter the report</span>
<span class="sd">            data.</span>
<span class="sd">        credentials (CloudForCustomersCredentials, optional): Credentials required</span>
<span class="sd">            for authentication.</span>
<span class="sd">        config_key (Optional[str], optional): A key to retrieve specific</span>
<span class="sd">            configuration settings.</span>
<span class="sd">        **kwargs: Arbitrary keyword arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Credentials logic</span>
    <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">CloudForCustomersCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">)</span>
    <span class="p">)</span>  <span class="c1"># validate the credentials</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_url</span> <span class="o">=</span> <span class="n">report_url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;report_url&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">is_report</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_url</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoint</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filter_params</span><span class="p">:</span>
        <span class="n">filter_params_merged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_PARAMS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">filter_params_merged</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">filter_params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filter_params</span> <span class="o">=</span> <span class="n">filter_params_merged</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_PARAMS</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.cloud_for_customers.CloudForCustomers.create_metadata_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_metadata_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create URL to fetch metadata from.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL to transform to metadata URL.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>meta_url</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL to fetch metadata from.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/cloud_for_customers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">create_metadata_url</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create URL to fetch metadata from.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): The URL to transform to metadata URL.</span>

<span class="sd">    Returns:</span>
<span class="sd">        meta_url (str): The URL to fetch metadata from.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.svc&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">url_raw</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">url_raw</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">start</span> <span class="o">+</span> <span class="s2">&quot;.svc/$metadata?entityset=&quot;</span> <span class="o">+</span> <span class="n">end</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.cloud_for_customers.CloudForCustomers.extract_records" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_records</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">report_url</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download records from <code>url</code> or <code>report_url</code> if present.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>records</code></td>            <td>
                  <code><span title="List">List</span>[<span title="Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The records extracted from URL.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/cloud_for_customers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_records</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">report_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download records from `url` or `report_url` if present.</span>

<span class="sd">    Returns:</span>
<span class="sd">        records (List[Dict[str, Any]]): The records extracted from URL.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_report</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_records_from_report_url</span><span class="p">(</span><span class="n">report_url</span><span class="o">=</span><span class="n">report_url</span><span class="p">)</span>
    <span class="n">full_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">)</span> <span class="k">if</span> <span class="n">url</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_url</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_records_from_url</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">full_url</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.cloud_for_customers.CloudForCustomers.get_entities" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_entities</span><span class="p">(</span><span class="n">dirty_json</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract entities from request.json().</p>
<p>Entities represent objects that store information. More info on:
https://help.sap.com/docs/EAD_HANA/0e60f05842fd41078917822867220c78/
0bd1db568fa546d6823d4c19a6b609ab.html</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dirty_json</code>
            </td>
            <td>
                  <code><span title="Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>request.json() dict from response to API.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL to fetch metadata from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>entities</code></td>            <td>
                  <code><span title="List">List</span>[<span title="Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list filled with entities.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/cloud_for_customers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_entities</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dirty_json</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract entities from request.json().</span>

<span class="sd">    Entities represent objects that store information. More info on:</span>
<span class="sd">    https://help.sap.com/docs/EAD_HANA/0e60f05842fd41078917822867220c78/</span>
<span class="sd">    0bd1db568fa546d6823d4c19a6b609ab.html</span>

<span class="sd">    Args:</span>
<span class="sd">        dirty_json (Dict[str, Any]): request.json() dict from response to API.</span>
<span class="sd">        url (str): The URL to fetch metadata from.</span>

<span class="sd">    Returns:</span>
<span class="sd">        entities (List[Dict[str, Any]]): list filled with entities.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metadata_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_metadata_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">column_maper_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_property_to_sap_label_dict</span><span class="p">(</span><span class="n">metadata_url</span><span class="p">)</span>
    <span class="n">entities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">dirty_json</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">][</span><span class="s2">&quot;results&quot;</span><span class="p">]:</span>
        <span class="n">new_entity</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">object_of_interest</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;__metadata&quot;</span><span class="p">,</span> <span class="s2">&quot;Photo&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Picture&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="s2">&quot;{&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">object_of_interest</span>
            <span class="p">):</span>
                <span class="n">new_key</span> <span class="o">=</span> <span class="n">column_maper_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">new_key</span><span class="p">:</span>
                    <span class="n">new_entity</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">object_of_interest</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_entity</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">object_of_interest</span>
        <span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_entity</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entities</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.cloud_for_customers.CloudForCustomers.get_property_to_sap_label_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_property_to_sap_label_dict</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create Dict that maps Property Name to value of SAP label.</p>
<p>Property: Properties define the characteristics of the data.
   SAP label: Labels are used for identification and for provision of content
   information.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL to fetch metadata from.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, str]: Property Name to value of SAP label.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/cloud_for_customers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_property_to_sap_label_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create Dict that maps Property Name to value of SAP label.</span>

<span class="sd">       Property: Properties define the characteristics of the data.</span>
<span class="sd">       SAP label: Labels are used for identification and for provision of content</span>
<span class="sd">       information.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str, optional): The URL to fetch metadata from.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict[str, str]: Property Name to value of SAP label.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">column_mapping</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()),</span>
            <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="mf">3.05</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">5</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&gt;&quot;</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="sa">r</span><span class="s1">&#39;(?&lt;=Name=&quot;)([^&quot;]+).+(sap:label=&quot;)([^&quot;]+)+&#39;</span><span class="p">,</span> <span class="n">sentence</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">groups</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">groups</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">column_mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
    <span class="k">return</span> <span class="n">column_mapping</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.cloud_for_customers.CloudForCustomers.get_response" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_response</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filter_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="mf">3.05</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">30</span><span class="p">))</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Handle requests.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The url to request to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter_params</code>
            </td>
            <td>
                  <code><span title="Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional parameters like filter,
used in case of normal url.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The request time-out. Default is (3.05, 60 * 30).</p>
              </div>
            </td>
            <td>
                  <code>(3.05, 60 * 30)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="requests.models.Response">Response</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>requests.models.Response.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/cloud_for_customers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_response</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">filter_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.05</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">30</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle requests.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): The url to request to.</span>
<span class="sd">        filter_params (Dict[str, Any], optional): Additional parameters like filter,</span>
<span class="sd">            used in case of normal url.</span>
<span class="sd">        timeout (tuple, optional): The request time-out. Default is (3.05, 60 * 30).</span>

<span class="sd">    Returns:</span>
<span class="sd">        requests.models.Response.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">handle_api_response</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">filter_params</span><span class="p">,</span>
        <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()),</span>
        <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.cloud_for_customers.CloudForCustomers.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download a table or report into a pandas DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters to pass to DataFrame constructor.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>df</code></td>            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing the records.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/cloud_for_customers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">if_empty</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download a table or report into a pandas DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        kwargs: The parameters to pass to DataFrame constructor.</span>

<span class="sd">    Returns:</span>
<span class="sd">        df (pandas.DataFrame): DataFrame containing the records.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Your implementation here</span>
    <span class="k">if</span> <span class="n">if_empty</span> <span class="o">==</span> <span class="s2">&quot;warn&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Warning: DataFrame is empty.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">if_empty</span> <span class="o">==</span> <span class="s2">&quot;skip&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping due to empty DataFrame.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">if_empty</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failing due to empty DataFrame.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid value for if_empty parameter.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">tests</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tests&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span>
    <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_records</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">report_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">report_url</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">records</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dtype</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fields</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">fields</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">tests</span><span class="p">:</span>
        <span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="n">tests</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.customer_gauge.CustomerGauge" class="doc doc-heading">
            <code>viadot.sources.customer_gauge.CustomerGauge</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>


        <p>A class to connect and download data using Customer Gauge API.</p>
<p>Documentation for each of this API's gateways:
    Responses gateway https://support.customergauge.com/support/solutions/
        articles/5000875861-get-responses
    Non-Responses gateway https://support.customergauge.com/support/solutions/
        articles/5000877703-get-non-responses</p>







              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/customer_gauge.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CustomerGauge</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class to connect and download data using Customer Gauge API.</span>

<span class="sd">    Documentation for each of this API&#39;s gateways:</span>
<span class="sd">        Responses gateway https://support.customergauge.com/support/solutions/</span>
<span class="sd">            articles/5000875861-get-responses</span>
<span class="sd">        Non-Responses gateway https://support.customergauge.com/support/solutions/</span>
<span class="sd">            articles/5000877703-get-non-responses</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">API_URL</span> <span class="o">=</span> <span class="s2">&quot;https://api.eu.customergauge.com/v7/rest/sync/&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">CustomerGaugeCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;customer_gauge&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A class to connect and download data using Customer Gauge API.</span>

<span class="sd">        Args:</span>
<span class="sd">            credentials (CustomerGaugeCredentials, optional): Customer Gauge</span>
<span class="sd">                credentials. Defaults to None.</span>
<span class="sd">            config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">                credentials. Defaults to &quot;customer_gauge&quot;.</span>

<span class="sd">        Raises:</span>
<span class="sd">            CredentialError: If credentials are not provided in local_config or</span>
<span class="sd">                directly as a parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
        <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">CustomerGaugeCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clean_json</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets Bearer Token using POST request method.</span>

<span class="sd">        Raises:</span>
<span class="sd">            APIError: If token is not returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Bearer Token value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://auth.EU.customergauge.com/oauth2/token&quot;</span>
        <span class="n">client_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;client_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">client_secret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;client_secret&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">}</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;grant_type&quot;</span><span class="p">:</span> <span class="s2">&quot;client_credentials&quot;</span><span class="p">,</span>
            <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="n">client_id</span><span class="p">,</span>
            <span class="s2">&quot;client_secret&quot;</span><span class="p">:</span> <span class="n">client_secret</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">api_response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span>
        <span class="p">)</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">api_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;The token could not be generated. Check your credentials.&quot;</span>
            <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">token</span>

    <span class="k">def</span> <span class="nf">_field_reference_unpacker</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">json_response</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpack and modify dictionaries within the specified field of a JSON response.</span>

<span class="sd">        This function takes a JSON response and a field name. It processes dictionaries</span>
<span class="sd">        within the specified field, checking if each dictionary contains</span>
<span class="sd">        exactly two items. If a dictionary meets this criteria, it is transformed</span>
<span class="sd">        into a new dictionary, where the first key becomes a key, and the second key</span>
<span class="sd">        becomes its associated value</span>

<span class="sd">        Args:</span>
<span class="sd">            json_response (dict[str, Any], optional): JSON response with data.</span>
<span class="sd">            field (str): The key (column) of the dictionary to be modified.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: The JSON response with modified nested dictionaries</span>
<span class="sd">            within the specified field.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If a dictionary within the specified field doesn&#39;t contain</span>
<span class="sd">                exactly two items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">dictionary</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">json_response</span><span class="p">[</span><span class="n">field</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># noqa: PLR2004</span>
                <span class="n">list_properties</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dictionary</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="n">result</span><span class="p">[</span><span class="n">list_properties</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">list_properties</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Dictionary within the specified field &quot;</span>
                    <span class="s2">&quot;doesn&#39;t contain exactly two items.&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">json_response</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">json_response</span>

    <span class="k">def</span> <span class="nf">_nested_dict_transformer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">json_response</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Modify nested dictionaries within the specified field of a JSON response.</span>

<span class="sd">        This function takes a JSON response and a field name. It modifies nested</span>
<span class="sd">        dictionaries within the specified field by adding an index and underscore</span>
<span class="sd">        to the keys. The modified dictionary is then updated in the JSON response.</span>

<span class="sd">        Args:</span>
<span class="sd">            json_response (dict[str, Any], optional): JSON response with data.</span>
<span class="sd">            field (str): The key (column) of the dictionary to be modified.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: The JSON response with modified nested dictionaries</span>
<span class="sd">                within the specified field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dictionary</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">json_response</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">json_response</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">type_error</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">type_error</span><span class="p">)</span>  <span class="c1"># noqa: TRY401</span>
            <span class="k">raise</span>

        <span class="k">return</span> <span class="n">json_response</span>

    <span class="k">def</span> <span class="nf">_get_json_response</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cursor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pagesize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">date_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get JSON that contains data and cursor parameter value.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str, optional): URL API direction. Defaults to None.</span>
<span class="sd">            cursor (int, optional): Cursor value to navigate to the page.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            pagesize (int, optional): Number of responses (records) returned per page,</span>
<span class="sd">                max value = 1000. Defaults to 1000. Defaults to 1000.</span>
<span class="sd">            date_field (str, optional): Specifies the date type which filter date range.</span>
<span class="sd">                Possible options: &quot;date_creation&quot;, &quot;date_order&quot;, &quot;date_sent&quot; or</span>
<span class="sd">                &quot;date_survey_response&quot;. Defaults to None.</span>
<span class="sd">            start_date (datetime, optional): Defines the period start date in</span>
<span class="sd">                yyyy-mm-dd format. Defaults to None.</span>
<span class="sd">            end_date (datetime, optional): Defines the period end date in</span>
<span class="sd">                yyyy-mm-dd format. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If at least one date argument were provided and the rest is</span>
<span class="sd">                missing. Needed all 3 or skip them.</span>
<span class="sd">            APIError: If no response from API call.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: JSON with data and cursor parameter value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;per_page&quot;</span><span class="p">:</span> <span class="n">pagesize</span><span class="p">,</span>
            <span class="s2">&quot;with[]&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;drivers&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="s2">&quot;questions&quot;</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">],</span>
            <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">cursor</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">date_field</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">date_field</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">]):</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;period[field]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">date_field</span><span class="p">,)</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;period[start]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_date</span><span class="p">,)</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;period[end]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_date</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Missing date arguments: &#39;date_field&#39;, &#39;start_date&#39;, &quot;</span>
                    <span class="s2">&quot;&#39;end_date&#39;. Provide all 3 arguments or skip all of them.&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_token</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
        <span class="n">api_response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">api_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;No response.&quot;</span>
            <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span> <span class="nf">_get_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_response</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns cursor value that is needed to navigate to the next page.</span>

<span class="sd">        Args:</span>
<span class="sd">            json_response (dict[str, Any], optional): Dictionary with nested structure</span>
<span class="sd">                that contains data and cursor parameter value. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If cursor value not found.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Cursor value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;cursor&quot;</span><span class="p">][</span><span class="s2">&quot;next&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Provided argument doesn&#39;t contain &#39;cursor&#39; value. &quot;</span>
                <span class="s2">&quot;Pass json returned from the endpoint.&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

        <span class="k">return</span> <span class="n">cur</span>

    <span class="k">def</span> <span class="nf">_get_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">json_response</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract the &#39;data&#39; part of a JSON response as a list of dictionaries.</span>

<span class="sd">        Args:</span>
<span class="sd">            json_response (Dict[str, Any], optional): JSON object represented as a</span>
<span class="sd">                nested dictionary that contains data and cursor parameter value.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If the &#39;data&#39; key is not present in the provided JSON response.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: A list of dictionaries containing data from the &#39;data&#39;</span>
<span class="sd">                part of the JSON response.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">jsons_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">jsons_list</span> <span class="o">=</span> <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Provided argument doesn&#39;t contain &#39;data&#39; value. &quot;</span>
                <span class="s2">&quot;Pass json returned from the endpoint.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">return</span> <span class="n">jsons_list</span>

    <span class="k">def</span> <span class="nf">_unpack_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">json_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">unpack_by_field_reference_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">unpack_by_nested_dict_transformer</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to unpack and modify specific columns in a list of dictionaries.</span>

<span class="sd">        It is using one of two methods, chosen by the user.</span>
<span class="sd">        If user would like to use field_reference_unpacker, he/she needs to provide</span>
<span class="sd">        list of fields as strings in `unpack_by_field_reference_cols`  parameter,</span>
<span class="sd">        if user would like to use nested_dict_transformer he/she needs to provide</span>
<span class="sd">        list of fields as strings in unpack_by_nested_dict_transformer parameter.</span>

<span class="sd">        Args:</span>
<span class="sd">            json_list (list[dict[str, Any]): A list of dictionaries containing the data.</span>
<span class="sd">            unpack_by_field_reference_cols (list[str]): Columns to unpack and modify</span>
<span class="sd">                using `_field_reference_unpacker`. Defaults to None.</span>
<span class="sd">            unpack_by_nested_dict_transformer (list[str]): Columns to unpack and</span>
<span class="sd">                modify using `_nested_dict_transformer`. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If &#39;json_list&#39; is not provided.</span>
<span class="sd">            ValueError: If specified columns do not exist in the JSON data.</span>
<span class="sd">            ValueError: If columns are mentioned in both</span>
<span class="sd">                &#39;unpack_by_field_reference_cols&#39; and &#39;unpack_by_nested_dict_transformer&#39;</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: The updated list of dictionaries after column</span>
<span class="sd">                unpacking and modification.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">duplicated_cols</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">json_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Input &#39;json_list&#39; is required.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">unpack_columns</span><span class="p">(</span><span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">unpack_function</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
            <span class="n">json_list_clean</span> <span class="o">=</span> <span class="n">json_list</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">json_list_clean</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Unpacking column &#39;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">&#39; with </span><span class="si">{</span><span class="n">unpack_function</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span>
<span class="s2">                        method...&quot;&quot;&quot;</span>
                    <span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">json_list_clean</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                            <span class="nb">map</span><span class="p">(</span>
                                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">field</span><span class="p">:</span> <span class="n">unpack_function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span>
                                <span class="n">json_list_clean</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;All elements in &#39;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">&#39; are unpacked successfully.&quot;</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;No transformation were made in &#39;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">&#39;,&quot;</span>
                            <span class="s2">&quot;because didn&#39;t contain list of key-value data.&quot;</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">json_list_clean</span>

        <span class="k">if</span> <span class="n">unpack_by_field_reference_cols</span> <span class="ow">and</span> <span class="n">unpack_by_nested_dict_transformer</span><span class="p">:</span>
            <span class="n">duplicated_cols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">unpack_by_field_reference_cols</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="n">unpack_by_nested_dict_transformer</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">duplicated_cols</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">duplicated_cols</span><span class="si">}</span><span class="s2"> were mentioned in both&quot;</span>
                <span class="s2">&quot;unpack_by_field_reference_cols and unpack_by_nested_dict_transformer.&quot;</span>
                <span class="s2">&quot;It&#39;s not possible to apply two methods to the same field.&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">unpack_by_field_reference_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">json_list</span> <span class="o">=</span> <span class="n">unpack_columns</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="n">unpack_by_field_reference_cols</span><span class="p">,</span>
                <span class="n">unpack_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_reference_unpacker</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">unpack_by_nested_dict_transformer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">json_list</span> <span class="o">=</span> <span class="n">unpack_columns</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="n">unpack_by_nested_dict_transformer</span><span class="p">,</span>
                <span class="n">unpack_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nested_dict_transformer</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">json_list</span>

    <span class="k">def</span> <span class="nf">api_connection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">,</span> <span class="s2">&quot;non-responses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;non-responses&quot;</span><span class="p">,</span>
        <span class="n">cursor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pagesize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">date_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">total_load</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">unpack_by_field_reference_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">unpack_by_nested_dict_transformer</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;General method to connect to Customer Gauge API and generate the response.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (Literal[&quot;responses&quot;, &quot;non-responses&quot;], optional): Indicate which</span>
<span class="sd">                endpoint to connect. Defaults to &quot;non-responses.</span>
<span class="sd">            cursor (int, optional): Cursor value to navigate to the page.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            pagesize (int, optional): Number of responses (records) returned per page,</span>
<span class="sd">                max value = 1000. Defaults to 1000. Defaults to 1000.</span>
<span class="sd">            date_field (str, optional): Specifies the date type which filter date range.</span>
<span class="sd">                Possible options: &quot;date_creation&quot;, &quot;date_order&quot;, &quot;date_sent&quot; or</span>
<span class="sd">                &quot;date_survey_response&quot;. Defaults to None.</span>
<span class="sd">            start_date (datetime, optional): Defines the period start date in</span>
<span class="sd">                yyyy-mm-dd format. Defaults to None.</span>
<span class="sd">            end_date (datetime, optional): Defines the period end date in</span>
<span class="sd">                yyyy-mm-dd format. Defaults to None.</span>
<span class="sd">            total_load (bool, optional): Indicate whether to download the data to the</span>
<span class="sd">                latest. If &#39;False&#39;, only one API call is executed (up to 1000 records).</span>
<span class="sd">                Defaults to True.</span>
<span class="sd">            unpack_by_field_reference_cols (list[str]): Columns to unpack and modify</span>
<span class="sd">                using `_field_reference_unpacker`. Defaults to None.</span>
<span class="sd">            unpack_by_nested_dict_transformer (list[str]): Columns to unpack and modify</span>
<span class="sd">                using `_nested_dict_transformer`. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">API_URL</span><span class="si">}{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting downloading data from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> endpoint...&quot;</span><span class="p">)</span>

        <span class="n">total_json</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_json_response</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="p">,</span>
            <span class="n">pagesize</span><span class="o">=</span><span class="n">pagesize</span><span class="p">,</span>
            <span class="n">date_field</span><span class="o">=</span><span class="n">date_field</span><span class="p">,</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cursor</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
        <span class="n">jsn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">total_load</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Downloading all the data from the </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2"> endpoint.&quot;</span>
                    <span class="s2">&quot;Process might take a few minutes...&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Downloading starting from the </span><span class="si">{</span><span class="n">cursor</span><span class="si">}</span><span class="s2"> cursor. &quot;</span>
                    <span class="s2">&quot;Process might take a few minutes...&quot;</span>
                <span class="p">)</span>
            <span class="k">while</span> <span class="n">jsn</span><span class="p">:</span>
                <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_json_response</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="n">cur</span><span class="p">)</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cursor</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
                <span class="n">jsn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
                <span class="n">total_json</span> <span class="o">+=</span> <span class="n">jsn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clean_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_columns</span><span class="p">(</span>
            <span class="n">json_list</span><span class="o">=</span><span class="n">total_json</span><span class="p">,</span>
            <span class="n">unpack_by_field_reference_cols</span><span class="o">=</span><span class="n">unpack_by_field_reference_cols</span><span class="p">,</span>
            <span class="n">unpack_by_nested_dict_transformer</span><span class="o">=</span><span class="n">unpack_by_nested_dict_transformer</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_flatten_json</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">json_response</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flattens a nested structure of the JSON object.</span>

<span class="sd">        Function flattens it into a single-level dictionary. It uses a nested</span>
<span class="sd">        `flattify()` function to recursively combine nested keys in the JSON</span>
<span class="sd">        object with &#39;_&#39; to create the flattened keys.</span>

<span class="sd">        Args:</span>
<span class="sd">            json_response (dict[str, Any], optional): JSON object represented as a</span>
<span class="sd">                nested dictionary. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If the &#39;json_response&#39; not a dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: The flattened dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">json_response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Input must be a dictionary.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">flattify</span><span class="p">(</span>
            <span class="n">field</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">result</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">field</span><span class="p">:</span>
                    <span class="n">flattify</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="n">key</span> <span class="o">+</span> <span class="n">item</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span>

        <span class="n">flattify</span><span class="p">(</span><span class="n">json_response</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_remove_square_brackets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace square brackets &quot;[]&quot; with an empty string in a pandas DataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pd.DataFrame, optional): Replace square brackets &quot;[]&quot; with an empty</span>
<span class="sd">                string in a pandas DataFrame. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: The modified DataFrame with square brackets replaced by</span>
<span class="sd">                an empty string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[]&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_clean_drivers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drivers</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean and format the &#39;drivers&#39; data.</span>

<span class="sd">        Args:</span>
<span class="sd">            drivers (str, optional): Column name of the data to be cleaned.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A cleaned and formatted string of driver data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">drivers</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;label: &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@add_viadot_metadata_columns</span>
    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
        <span class="n">validate_df_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">anonymize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">columns_to_anonymize</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">anonymize_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="s2">&quot;hash&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mask&quot;</span><span class="p">,</span>
        <span class="n">anonymize_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;***&quot;</span><span class="p">,</span>
        <span class="n">date_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a Pandas Data Frame with the data in the Response and metadata.</span>

<span class="sd">        Args:</span>
<span class="sd">            if_empty (str, optional): What to do if a fetch produce no data.</span>
<span class="sd">                Defaults to &quot;warn</span>
<span class="sd">            validate_df_dict (dict[str, Any], optional): A dictionary with optional list</span>
<span class="sd">                of tests to verify the output dataframe. If defined, triggers the</span>
<span class="sd">                `validate_df` task from task_utils. Defaults to None.</span>
<span class="sd">            anonymize (bool, optional): Indicates if anonymize selected columns.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">            columns_to_anonymize (list[str], optional): List of columns to anonymize.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            anonymize_method  (Literal[&quot;mask&quot;, &quot;hash&quot;], optional): Method of</span>
<span class="sd">                anonymizing data. &quot;mask&quot; -&gt; replace the data with &quot;value&quot; arg. &quot;hash&quot; -&gt;</span>
<span class="sd">                replace the data with the hash value of an object (using `hash()`</span>
<span class="sd">                method). Defaults to &quot;mask&quot;.</span>
<span class="sd">            anonymize_value (str, optional): Value to replace the data.</span>
<span class="sd">                Defaults to &quot;***&quot;.</span>
<span class="sd">            date_column (str, optional): Name of the date column used to identify rows</span>
<span class="sd">                that are older than a specified number of days. Defaults to None.</span>
<span class="sd">            days (int, optional): The number of days beyond which we want to anonymize</span>
<span class="sd">                the data, e.g. older than 2 years can be: 2*365. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.Dataframe: The response data as a Pandas Data Frame plus viadot metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Inserting data into the DataFrame...&quot;</span><span class="p">)</span>

        <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flatten_json</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_json</span><span class="p">)))</span>
        <span class="n">data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_square_brackets</span><span class="p">(</span><span class="n">data_frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;drivers&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="n">data_frame</span><span class="p">[</span><span class="s2">&quot;drivers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_frame</span><span class="p">[</span><span class="s2">&quot;drivers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_clean_drivers</span><span class="p">)</span>
        <span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span>
                <span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;The response does not contain any data.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Successfully downloaded data from the Customer Gauge API.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">validate_df_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="n">validate_df_dict</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">anonymize</span><span class="p">:</span>
            <span class="n">data_frame</span> <span class="o">=</span> <span class="n">anonymize_df</span><span class="p">(</span>
                <span class="n">df</span><span class="o">=</span><span class="n">data_frame</span><span class="p">,</span>
                <span class="n">columns</span><span class="o">=</span><span class="n">columns_to_anonymize</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">anonymize_method</span><span class="p">,</span>
                <span class="n">mask_value</span><span class="o">=</span><span class="n">anonymize_value</span><span class="p">,</span>
                <span class="n">date_column</span><span class="o">=</span><span class="n">date_column</span><span class="p">,</span>
                <span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Data Frame anonymized&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_frame</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.customer_gauge.CustomerGauge.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_key</span><span class="o">=</span><span class="s1">&#39;customer_gauge&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A class to connect and download data using Customer Gauge API.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>credentials</code>
            </td>
            <td>
                  <code><span title="viadot.sources.customer_gauge.CustomerGaugeCredentials">CustomerGaugeCredentials</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Customer Gauge
credentials. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key in the viadot config holding relevant
credentials. Defaults to "customer_gauge".</p>
              </div>
            </td>
            <td>
                  <code>&#39;customer_gauge&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="CredentialError">CredentialError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If credentials are not provided in local_config or
directly as a parameter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/customer_gauge.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="n">CustomerGaugeCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;customer_gauge&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class to connect and download data using Customer Gauge API.</span>

<span class="sd">    Args:</span>
<span class="sd">        credentials (CustomerGaugeCredentials, optional): Customer Gauge</span>
<span class="sd">            credentials. Defaults to None.</span>
<span class="sd">        config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">            credentials. Defaults to &quot;customer_gauge&quot;.</span>

<span class="sd">    Raises:</span>
<span class="sd">        CredentialError: If credentials are not provided in local_config or</span>
<span class="sd">            directly as a parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
    <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">CustomerGaugeCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">clean_json</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.customer_gauge.CustomerGauge.api_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">api_connection</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="s1">&#39;non-responses&#39;</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pagesize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">date_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">total_load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unpack_by_field_reference_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unpack_by_nested_dict_transformer</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>General method to connect to Customer Gauge API and generate the response.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>endpoint</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;responses&#39;, &#39;non-responses&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicate which
endpoint to connect. Defaults to "non-responses.</p>
              </div>
            </td>
            <td>
                  <code>&#39;non-responses&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cursor</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cursor value to navigate to the page.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pagesize</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of responses (records) returned per page,
max value = 1000. Defaults to 1000. Defaults to 1000.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>date_field</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specifies the date type which filter date range.
Possible options: "date_creation", "date_order", "date_sent" or
"date_survey_response". Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_date</code>
            </td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Defines the period start date in
yyyy-mm-dd format. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date</code>
            </td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Defines the period end date in
yyyy-mm-dd format. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_load</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicate whether to download the data to the
latest. If 'False', only one API call is executed (up to 1000 records).
Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unpack_by_field_reference_cols</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Columns to unpack and modify
using <code>_field_reference_unpacker</code>. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unpack_by_nested_dict_transformer</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Columns to unpack and modify
using <code>_nested_dict_transformer</code>. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/customer_gauge.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">api_connection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">,</span> <span class="s2">&quot;non-responses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;non-responses&quot;</span><span class="p">,</span>
    <span class="n">cursor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">pagesize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">date_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">total_load</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">unpack_by_field_reference_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">unpack_by_nested_dict_transformer</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;General method to connect to Customer Gauge API and generate the response.</span>

<span class="sd">    Args:</span>
<span class="sd">        endpoint (Literal[&quot;responses&quot;, &quot;non-responses&quot;], optional): Indicate which</span>
<span class="sd">            endpoint to connect. Defaults to &quot;non-responses.</span>
<span class="sd">        cursor (int, optional): Cursor value to navigate to the page.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        pagesize (int, optional): Number of responses (records) returned per page,</span>
<span class="sd">            max value = 1000. Defaults to 1000. Defaults to 1000.</span>
<span class="sd">        date_field (str, optional): Specifies the date type which filter date range.</span>
<span class="sd">            Possible options: &quot;date_creation&quot;, &quot;date_order&quot;, &quot;date_sent&quot; or</span>
<span class="sd">            &quot;date_survey_response&quot;. Defaults to None.</span>
<span class="sd">        start_date (datetime, optional): Defines the period start date in</span>
<span class="sd">            yyyy-mm-dd format. Defaults to None.</span>
<span class="sd">        end_date (datetime, optional): Defines the period end date in</span>
<span class="sd">            yyyy-mm-dd format. Defaults to None.</span>
<span class="sd">        total_load (bool, optional): Indicate whether to download the data to the</span>
<span class="sd">            latest. If &#39;False&#39;, only one API call is executed (up to 1000 records).</span>
<span class="sd">            Defaults to True.</span>
<span class="sd">        unpack_by_field_reference_cols (list[str]): Columns to unpack and modify</span>
<span class="sd">            using `_field_reference_unpacker`. Defaults to None.</span>
<span class="sd">        unpack_by_nested_dict_transformer (list[str]): Columns to unpack and modify</span>
<span class="sd">            using `_nested_dict_transformer`. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">API_URL</span><span class="si">}{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting downloading data from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> endpoint...&quot;</span><span class="p">)</span>

    <span class="n">total_json</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_json_response</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
        <span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="p">,</span>
        <span class="n">pagesize</span><span class="o">=</span><span class="n">pagesize</span><span class="p">,</span>
        <span class="n">date_field</span><span class="o">=</span><span class="n">date_field</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cursor</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
    <span class="n">jsn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">total_load</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Downloading all the data from the </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2"> endpoint.&quot;</span>
                <span class="s2">&quot;Process might take a few minutes...&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Downloading starting from the </span><span class="si">{</span><span class="n">cursor</span><span class="si">}</span><span class="s2"> cursor. &quot;</span>
                <span class="s2">&quot;Process might take a few minutes...&quot;</span>
            <span class="p">)</span>
        <span class="k">while</span> <span class="n">jsn</span><span class="p">:</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_json_response</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="n">cur</span><span class="p">)</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cursor</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
            <span class="n">jsn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
            <span class="n">total_json</span> <span class="o">+=</span> <span class="n">jsn</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">clean_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_columns</span><span class="p">(</span>
        <span class="n">json_list</span><span class="o">=</span><span class="n">total_json</span><span class="p">,</span>
        <span class="n">unpack_by_field_reference_cols</span><span class="o">=</span><span class="n">unpack_by_field_reference_cols</span><span class="p">,</span>
        <span class="n">unpack_by_nested_dict_transformer</span><span class="o">=</span><span class="n">unpack_by_nested_dict_transformer</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.customer_gauge.CustomerGauge.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="n">validate_df_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anonymize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">columns_to_anonymize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anonymize_method</span><span class="o">=</span><span class="s1">&#39;mask&#39;</span><span class="p">,</span> <span class="n">anonymize_value</span><span class="o">=</span><span class="s1">&#39;***&#39;</span><span class="p">,</span> <span class="n">date_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a Pandas Data Frame with the data in the Response and metadata.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>if_empty</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What to do if a fetch produce no data.
Defaults to "warn</p>
              </div>
            </td>
            <td>
                  <code>&#39;warn&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>validate_df_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with optional list
of tests to verify the output dataframe. If defined, triggers the
<code>validate_df</code> task from task_utils. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>anonymize</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicates if anonymize selected columns.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>columns_to_anonymize</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns to anonymize.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>anonymize_method</code>
            </td>
            <td>
                  <code> (Literal[&#34;mask&#34;, &#34;hash&#34;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method of
anonymizing data. "mask" -&gt; replace the data with "value" arg. "hash" -&gt;
replace the data with the hash value of an object (using <code>hash()</code>
method). Defaults to "mask".</p>
              </div>
            </td>
            <td>
                  <code>&#39;mask&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>anonymize_value</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value to replace the data.
Defaults to "***".</p>
              </div>
            </td>
            <td>
                  <code>&#39;***&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>date_column</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the date column used to identify rows
that are older than a specified number of days. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>days</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of days beyond which we want to anonymize
the data, e.g. older than 2 years can be: 2*365. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.Dataframe: The response data as a Pandas Data Frame plus viadot metadata.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/customer_gauge.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_viadot_metadata_columns</span>
<span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
    <span class="n">validate_df_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">anonymize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">columns_to_anonymize</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">anonymize_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="s2">&quot;hash&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mask&quot;</span><span class="p">,</span>
    <span class="n">anonymize_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;***&quot;</span><span class="p">,</span>
    <span class="n">date_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a Pandas Data Frame with the data in the Response and metadata.</span>

<span class="sd">    Args:</span>
<span class="sd">        if_empty (str, optional): What to do if a fetch produce no data.</span>
<span class="sd">            Defaults to &quot;warn</span>
<span class="sd">        validate_df_dict (dict[str, Any], optional): A dictionary with optional list</span>
<span class="sd">            of tests to verify the output dataframe. If defined, triggers the</span>
<span class="sd">            `validate_df` task from task_utils. Defaults to None.</span>
<span class="sd">        anonymize (bool, optional): Indicates if anonymize selected columns.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">        columns_to_anonymize (list[str], optional): List of columns to anonymize.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        anonymize_method  (Literal[&quot;mask&quot;, &quot;hash&quot;], optional): Method of</span>
<span class="sd">            anonymizing data. &quot;mask&quot; -&gt; replace the data with &quot;value&quot; arg. &quot;hash&quot; -&gt;</span>
<span class="sd">            replace the data with the hash value of an object (using `hash()`</span>
<span class="sd">            method). Defaults to &quot;mask&quot;.</span>
<span class="sd">        anonymize_value (str, optional): Value to replace the data.</span>
<span class="sd">            Defaults to &quot;***&quot;.</span>
<span class="sd">        date_column (str, optional): Name of the date column used to identify rows</span>
<span class="sd">            that are older than a specified number of days. Defaults to None.</span>
<span class="sd">        days (int, optional): The number of days beyond which we want to anonymize</span>
<span class="sd">            the data, e.g. older than 2 years can be: 2*365. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.Dataframe: The response data as a Pandas Data Frame plus viadot metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Inserting data into the DataFrame...&quot;</span><span class="p">)</span>

    <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flatten_json</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_json</span><span class="p">)))</span>
    <span class="n">data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_square_brackets</span><span class="p">(</span><span class="n">data_frame</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;drivers&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">data_frame</span><span class="p">[</span><span class="s2">&quot;drivers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_frame</span><span class="p">[</span><span class="s2">&quot;drivers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_clean_drivers</span><span class="p">)</span>
    <span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span>
            <span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;The response does not contain any data.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Successfully downloaded data from the Customer Gauge API.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">validate_df_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="n">validate_df_dict</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">anonymize</span><span class="p">:</span>
        <span class="n">data_frame</span> <span class="o">=</span> <span class="n">anonymize_df</span><span class="p">(</span>
            <span class="n">df</span><span class="o">=</span><span class="n">data_frame</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">columns_to_anonymize</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">anonymize_method</span><span class="p">,</span>
            <span class="n">mask_value</span><span class="o">=</span><span class="n">anonymize_value</span><span class="p">,</span>
            <span class="n">date_column</span><span class="o">=</span><span class="n">date_column</span><span class="p">,</span>
            <span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Data Frame anonymized&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data_frame</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.epicor.Epicor" class="doc doc-heading">
            <code>viadot.sources.epicor.Epicor</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>








              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/epicor.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Epicor</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">validate_date_filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">start_date_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BegInvoiceDate&quot;</span><span class="p">,</span>
        <span class="n">end_date_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EndInvoiceDate&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Class to connect to Epicor API and pasere XML output into a pandas DataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            base_url (str, required): Base url to Epicor.</span>
<span class="sd">            filters_xml (str, required): Filters in form of XML. The date filter</span>
<span class="sd">                 is required.</span>
<span class="sd">            credentials (dict[str, Any], optional): Credentials to connect with</span>
<span class="sd">            Epicor API containing host, port, username and password.Defaults to None.</span>
<span class="sd">            config_key (str, optional): Credential key to dictionary where details</span>
<span class="sd">                 are stored.</span>
<span class="sd">            validate_date_filter (bool, optional): Whether or not validate xml</span>
<span class="sd">                date filters. Defaults to True.</span>
<span class="sd">            start_date_field (str, optional) The name of filters field containing</span>
<span class="sd">                start date.Defaults to &quot;BegInvoiceDate&quot;.</span>
<span class="sd">            end_date_field (str, optional) The name of filters field containing</span>
<span class="sd">                end date. Defaults to &quot;EndInvoiceDate&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
        <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">EpicorCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_date_filter</span> <span class="o">=</span> <span class="n">validate_date_filter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_date_field</span> <span class="o">=</span> <span class="n">start_date_field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_date_field</span> <span class="o">=</span> <span class="n">end_date_field</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;http://&quot;</span>
            <span class="o">+</span> <span class="n">validated_creds</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">validated_creds</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="n">base_url</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to generate API access token that is valid for 24 hours.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Generated token.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;http://&quot;</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="s2">&quot;/api/security/token/&quot;</span>
        <span class="p">)</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">],</span>
            <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;AccessToken&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

    <span class="k">def</span> <span class="nf">validate_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters_xml</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="s2">&quot;Function checking if user had specified date range filters.&quot;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">filters_xml</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subchild</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">subchild</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date_field</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date_field</span><span class="p">)</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="n">subchild</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Too much data. Please provide a date range filter.&quot;</span>
                    <span class="k">raise</span> <span class="n">DataRangeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_xml_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters_xml</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="s2">&quot;Function for getting response from Epicor API.&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_date_filter</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_filter</span><span class="p">(</span><span class="n">filters_xml</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">filters_xml</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/xml&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_token</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">handle_api_response</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters_xml</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function for creating pandas DataFrame from Epicor API response.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Output DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xml_response</span><span class="p">(</span><span class="n">filters_xml</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;ORDER.HISTORY.DETAIL.QUERY&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">parse_orders_xml</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;CUSTOMER.QUERY&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">parse_customer_xml</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;ORDER.DETAIL.PROD.QUERY&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">parse_open_orders_xml</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;BOOKINGS.DETAIL.QUERY&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">parse_bookings_xml</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Parser for selected viev </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2"> is not avaiable&quot;</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.epicor.Epicor.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate_date_filter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start_date_field</span><span class="o">=</span><span class="s1">&#39;BegInvoiceDate&#39;</span><span class="p">,</span> <span class="n">end_date_field</span><span class="o">=</span><span class="s1">&#39;EndInvoiceDate&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Class to connect to Epicor API and pasere XML output into a pandas DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>base_url</code>
            </td>
            <td>
                  <code>(<span title="str">str</span>, <span title="required">required</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base url to Epicor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filters_xml</code>
            </td>
            <td>
                  <code>(<span title="str">str</span>, <span title="required">required</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filters in form of XML. The date filter
 is required.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>credentials</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Credentials to connect with</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Credential key to dictionary where details
 are stored.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>validate_date_filter</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not validate xml
date filters. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/epicor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">validate_date_filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">start_date_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BegInvoiceDate&quot;</span><span class="p">,</span>
    <span class="n">end_date_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EndInvoiceDate&quot;</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to connect to Epicor API and pasere XML output into a pandas DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        base_url (str, required): Base url to Epicor.</span>
<span class="sd">        filters_xml (str, required): Filters in form of XML. The date filter</span>
<span class="sd">             is required.</span>
<span class="sd">        credentials (dict[str, Any], optional): Credentials to connect with</span>
<span class="sd">        Epicor API containing host, port, username and password.Defaults to None.</span>
<span class="sd">        config_key (str, optional): Credential key to dictionary where details</span>
<span class="sd">             are stored.</span>
<span class="sd">        validate_date_filter (bool, optional): Whether or not validate xml</span>
<span class="sd">            date filters. Defaults to True.</span>
<span class="sd">        start_date_field (str, optional) The name of filters field containing</span>
<span class="sd">            start date.Defaults to &quot;BegInvoiceDate&quot;.</span>
<span class="sd">        end_date_field (str, optional) The name of filters field containing</span>
<span class="sd">            end date. Defaults to &quot;EndInvoiceDate&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
    <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">EpicorCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">validate_date_filter</span> <span class="o">=</span> <span class="n">validate_date_filter</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_date_field</span> <span class="o">=</span> <span class="n">start_date_field</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_date_field</span> <span class="o">=</span> <span class="n">end_date_field</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;http://&quot;</span>
        <span class="o">+</span> <span class="n">validated_creds</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">]</span>
        <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">validated_creds</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="n">base_url</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.epicor.Epicor.generate_token" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_token</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function to generate API access token that is valid for 24 hours.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generated token.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/epicor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to generate API access token that is valid for 24 hours.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Generated token.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;http://&quot;</span>
        <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">]</span>
        <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;/api/security/token/&quot;</span>
    <span class="p">)</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">],</span>
        <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;AccessToken&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.epicor.Epicor.get_xml_response" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_xml_response</span><span class="p">(</span><span class="n">filters_xml</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function for getting response from Epicor API.</p>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/epicor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_xml_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters_xml</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
    <span class="s2">&quot;Function for getting response from Epicor API.&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_date_filter</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_filter</span><span class="p">(</span><span class="n">filters_xml</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">filters_xml</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/xml&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_token</span><span class="p">(),</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">handle_api_response</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.epicor.Epicor.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">filters_xml</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function for creating pandas DataFrame from Epicor API response.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Output DataFrame.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/epicor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters_xml</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function for creating pandas DataFrame from Epicor API response.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Output DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xml_response</span><span class="p">(</span><span class="n">filters_xml</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;ORDER.HISTORY.DETAIL.QUERY&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">parse_orders_xml</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;CUSTOMER.QUERY&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">parse_customer_xml</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;ORDER.DETAIL.PROD.QUERY&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">parse_open_orders_xml</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;BOOKINGS.DETAIL.QUERY&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">parse_bookings_xml</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Parser for selected viev </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2"> is not avaiable&quot;</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.epicor.Epicor.validate_filter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_filter</span><span class="p">(</span><span class="n">filters_xml</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function checking if user had specified date range filters.</p>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/epicor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters_xml</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="s2">&quot;Function checking if user had specified date range filters.&quot;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">filters_xml</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">subchild</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">subchild</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date_field</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date_field</span><span class="p">)</span>
            <span class="p">)</span> <span class="ow">and</span> <span class="n">subchild</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Too much data. Please provide a date range filter.&quot;</span>
                <span class="k">raise</span> <span class="n">DataRangeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.eurostat.Eurostat" class="doc doc-heading">
            <code>viadot.sources.eurostat.Eurostat</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>


        <p>Eurostat REST API v1 connector.</p>
<p>This module provides functionalities for connecting to Eurostat  API and download
the datasets. It includes the following features:
- Pulling json file with all data from specific dataset.
- Creating pandas Data Frame from pulled json file.
- Creating dataset parameters validation if specified.</p>
<p>Typical usage example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code>eurostat = Eurostat()

eurostat.to_df(
    dataset_code: str,
    params: dict = None,
    columns: list = None,
    tests: dict = None,
)
</code></pre></div></td></tr></table></div>







              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/eurostat.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Eurostat</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Eurostat REST API v1 connector.</span>

<span class="sd">    This module provides functionalities for connecting to Eurostat  API and download</span>
<span class="sd">    the datasets. It includes the following features:</span>
<span class="sd">    - Pulling json file with all data from specific dataset.</span>
<span class="sd">    - Creating pandas Data Frame from pulled json file.</span>
<span class="sd">    - Creating dataset parameters validation if specified.</span>

<span class="sd">    Typical usage example:</span>

<span class="sd">        eurostat = Eurostat()</span>

<span class="sd">        eurostat.to_df(</span>
<span class="sd">            dataset_code: str,</span>
<span class="sd">            params: dict = None,</span>
<span class="sd">            columns: list = None,</span>
<span class="sd">            tests: dict = None,</span>
<span class="sd">        )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://ec.europa.eu/eurostat/api/dissemination/statistics/1.0/data/&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">dataset_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tests</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the class with Eurostat API data fetching setup.</span>

<span class="sd">        This method uses an HTTPS request to pull data from the Eurostat API.</span>
<span class="sd">        No API registration or API key is required. Data is fetched based on the</span>
<span class="sd">        parameters provided in the dynamic part of the URL.</span>

<span class="sd">        Example URL:</span>
<span class="sd">        Static part: https://ec.europa.eu/eurostat/api/dissemination/statistics/1.0/data</span>
<span class="sd">        Dynamic part: /TEIBS020/?format=JSON&amp;lang=EN&amp;indic=BS-CSMCI-BAL</span>

<span class="sd">        To retrieve specific data, parameters with codes must be provided in `params`.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset_code (str):</span>
<span class="sd">                The code of the Eurostat dataset to be downloaded.</span>
<span class="sd">            params (dict[str, str] | None, optional):</span>
<span class="sd">                A dictionary with optional URL parameters. Each key is a parameter ID,</span>
<span class="sd">                and the value is a specific parameter code, e.g.,</span>
<span class="sd">                `params = {&#39;unit&#39;: &#39;EUR&#39;}` where &quot;unit&quot; is the parameter, and &quot;EUR&quot; is</span>
<span class="sd">                the code. Only one code per parameter is allowed. Defaults to None.</span>
<span class="sd">            columns (list[str] | None, optional):</span>
<span class="sd">                A list of column names (as strings) that are required from the dataset.</span>
<span class="sd">                Filters the data to only include the specified columns.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            tests (dict | None, optional):</span>
<span class="sd">                A dictionary containing test cases for the data, including:</span>
<span class="sd">                - `column_size`: dict{column: size}</span>
<span class="sd">                - `column_unique_values`: list[columns]</span>
<span class="sd">                - `column_list_to_match`: list[columns]</span>
<span class="sd">                - `dataset_row_count`: dict{&#39;min&#39;: number, &#39;max&#39;: number}</span>
<span class="sd">                - `column_match_regex`: dict{column: &#39;regex&#39;}</span>
<span class="sd">                - `column_sum`: dict{column: {&#39;min&#39;: number, &#39;max&#39;: number}}.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            **kwargs:</span>
<span class="sd">                Additional arguments passed to the class initializer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_code</span> <span class="o">=</span> <span class="n">dataset_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tests</span> <span class="o">=</span> <span class="n">tests</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_parameters_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve available API request parameters and their codes.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): URL built for API call.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the response from the API is empty or invalid.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, list[str]]: Key is a parameter, and value is a list of</span>
<span class="sd">                available codes for the specified parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">available_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

        <span class="c1"># Dictionary from JSON with keys and related codes values</span>
        <span class="n">dimension</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dimension&quot;</span><span class="p">]</span>

        <span class="c1"># Assigning list of available codes to specific parameters</span>
        <span class="n">params_and_codes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">available_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dimension</span><span class="p">:</span>
                <span class="n">codes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dimension</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;category&quot;</span><span class="p">][</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">params_and_codes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">codes</span>
        <span class="k">return</span> <span class="n">params_and_codes</span>

    <span class="k">def</span> <span class="nf">validate_params</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataset_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates given parameters against the available parameters in the dataset.</span>

<span class="sd">        Important:</span>
<span class="sd">            Each dataset in Eurostat has specific parameters that could be used for</span>
<span class="sd">            filtering the data. For example dataset ILC_DI04 -Mean and median income by</span>
<span class="sd">            household type - EU-SILC and ECHP surveys has parameter such as:</span>
<span class="sd">            hhhtyp (Type of household), which can be filtered by specific available</span>
<span class="sd">            code of this parameter, such as: &#39;total&#39;, &#39;a1&#39; (single person),</span>
<span class="sd">            &#39;a1_dhc&#39; (single person with dependent children). Please note that each</span>
<span class="sd">            dataset has different parameters and different codes</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If any of the `params` keys or values is not a string or</span>
<span class="sd">            any of them is not available for specific dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># In order to make params validation, first we need to get params_and_codes.</span>
        <span class="n">key_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameters_codes</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key_codes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Conversion keys and values on lower cases by using casefold</span>
            <span class="n">key_codes_after_conversion</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="o">.</span><span class="n">casefold</span><span class="p">():</span> <span class="p">[</span><span class="n">v_elem</span><span class="o">.</span><span class="n">casefold</span><span class="p">()</span> <span class="k">for</span> <span class="n">v_elem</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">key_codes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="n">params_after_conversion</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="o">.</span><span class="n">casefold</span><span class="p">():</span> <span class="n">v</span><span class="o">.</span><span class="n">casefold</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>

            <span class="c1"># Comparing keys and values</span>
            <span class="n">non_available_keys</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">key</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params_after_conversion</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_codes_after_conversion</span>
            <span class="p">]</span>
            <span class="n">non_available_codes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">value</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params_after_conversion</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_codes_after_conversion</span>
                <span class="ow">and</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_codes_after_conversion</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="p">]</span>

            <span class="c1"># Error loggers</span>

            <span class="k">if</span> <span class="n">non_available_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Parameters: &#39;</span><span class="si">{</span><span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">non_available_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; are not in &quot;</span>
                    <span class="s2">&quot;dataset. Please check your spelling!&quot;</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Possible parameters: </span><span class="si">{</span><span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">key_codes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">non_available_codes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Parameters codes: &#39;</span><span class="si">{</span><span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">non_available_codes</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; are not &quot;</span>
                    <span class="s2">&quot;available. Please check your spelling!</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;You can find everything via link: https://ec.europa.eu/&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;eurostat/databrowser/view/</span><span class="si">{</span><span class="n">dataset_code</span><span class="si">}</span><span class="s2">/default/table?lang=en&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">non_available_keys</span> <span class="ow">or</span> <span class="n">non_available_codes</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Wrong parameters or codes were provided!&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">eurostat_dictionary_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">signals</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function for creating DataFrame from JSON pulled from Eurostat.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Pandas DataFrame With 4 columns: index, geo, time, indicator</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">class</span> <span class="nc">TSignal</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Class representing a signal with keys, indexes, labels, and name.</span>

<span class="sd">            Attributes:</span>
<span class="sd">            signal_keys_list : list[str]</span>
<span class="sd">                A list of keys representing unique identifiers for the signal.</span>
<span class="sd">            signal_index_list : list[str]</span>
<span class="sd">                A list of index values corresponding to the keys of the signal.</span>
<span class="sd">            signal_label_list : list[str]</span>
<span class="sd">                A list of labels providing human-readable names for the</span>
<span class="sd">                signal&#39;s keys.</span>
<span class="sd">            signal_name : str</span>
<span class="sd">                The name of the signal.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">signal_keys_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
            <span class="n">signal_index_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
            <span class="n">signal_label_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
            <span class="n">signal_name</span><span class="p">:</span> <span class="nb">str</span>

        <span class="c1"># Dataframe creation</span>
        <span class="n">columns0</span> <span class="o">=</span> <span class="n">signals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">columns0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;indicator&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns0</span><span class="p">)</span>
        <span class="n">indicator_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">index_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">signal_lists</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Get the dictionary from the inputs</span>
        <span class="n">eurostat_dictionary</span> <span class="o">=</span> <span class="n">signals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">signal</span> <span class="ow">in</span> <span class="n">signals</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">signal_struct</span> <span class="o">=</span> <span class="n">TSignal</span><span class="p">()</span>
            <span class="n">signal_struct</span><span class="o">.</span><span class="n">signal_name</span> <span class="o">=</span> <span class="n">signal</span>
            <span class="n">signal_struct</span><span class="o">.</span><span class="n">signal_keys_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">eurostat_dictionary</span><span class="p">[</span><span class="s2">&quot;dimension&quot;</span><span class="p">][</span><span class="n">signal</span><span class="p">][</span><span class="s2">&quot;category&quot;</span><span class="p">][</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">signal_struct</span><span class="o">.</span><span class="n">signal_index_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">eurostat_dictionary</span><span class="p">[</span><span class="s2">&quot;dimension&quot;</span><span class="p">][</span><span class="n">signal</span><span class="p">][</span><span class="s2">&quot;category&quot;</span><span class="p">][</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">signal_label_dict</span> <span class="o">=</span> <span class="n">eurostat_dictionary</span><span class="p">[</span><span class="s2">&quot;dimension&quot;</span><span class="p">][</span><span class="n">signal</span><span class="p">][</span><span class="s2">&quot;category&quot;</span><span class="p">][</span>
                <span class="s2">&quot;label&quot;</span>
            <span class="p">]</span>
            <span class="n">signal_struct</span><span class="o">.</span><span class="n">signal_label_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">signal_label_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">signal_struct</span><span class="o">.</span><span class="n">signal_keys_list</span>
            <span class="p">]</span>
            <span class="n">signal_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">signal_struct</span><span class="p">)</span>

        <span class="n">col_signal_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">row_signal_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row_label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">signal_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">signal_index_list</span><span class="p">,</span>
            <span class="n">signal_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">signal_label_list</span><span class="p">,</span>
            <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">):</span>  <span class="c1"># rows</span>
            <span class="k">for</span> <span class="n">col_index</span><span class="p">,</span> <span class="n">col_label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">signal_lists</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">signal_index_list</span><span class="p">,</span>
                <span class="n">signal_lists</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">signal_label_list</span><span class="p">,</span>
                <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">):</span>  <span class="c1"># cols</span>
                <span class="n">index</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">col_index</span> <span class="o">+</span> <span class="n">row_index</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">signal_lists</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">signal_label_list</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">eurostat_dictionary</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]:</span>
                    <span class="n">index_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">col_signal_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_label</span><span class="p">)</span>
                    <span class="n">row_signal_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_label</span><span class="p">)</span>

        <span class="n">indicator_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">eurostat_dictionary</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index_list</span><span class="p">]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">indicator</span> <span class="o">=</span> <span class="n">indicator_list</span>
        <span class="n">df</span><span class="p">[</span><span class="n">signal_lists</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">signal_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">col_signal_temp</span>
        <span class="n">df</span><span class="p">[</span><span class="n">signal_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">signal_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_signal_temp</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@add_viadot_metadata_columns</span>
    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function responsible for getting response and creating DataFrame.</span>

<span class="sd">        It is using method &#39;eurostat_dictionary_to_df&#39; with validation</span>
<span class="sd">        of provided parameters and their codes if needed.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If self.params is different type than a dictionary.</span>
<span class="sd">            TypeError: If self.columns is different type than a list containing strings.</span>
<span class="sd">            APIError: If there is an error with the API request.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Pandas DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Checking if params and columns have correct type</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Params should be a dictionary.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Requested columns should be provided as list of strings.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Creating url for connection with API</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_code</span><span class="si">}</span><span class="s2">?format=JSON&amp;lang=EN&quot;</span>

        <span class="c1"># Making parameters validation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_params</span><span class="p">(</span>
                <span class="n">dataset_code</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_code</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span>
            <span class="p">)</span>

        <span class="c1"># Getting response from API</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">APIError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_params</span><span class="p">(</span>
                <span class="n">dataset_code</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_code</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span>
            <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eurostat_dictionary_to_df</span><span class="p">([</span><span class="s2">&quot;geo&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>

        <span class="c1"># Merge data_frame with label and last updated date</span>
        <span class="n">label_col</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]),</span> <span class="n">index</span><span class="o">=</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
        <span class="n">last_updated__col</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]),</span>
            <span class="n">index</span><span class="o">=</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;updated&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">label_col</span><span class="p">,</span> <span class="n">last_updated__col</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Validation and transformation of requested column</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filter_df_columns</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

        <span class="c1"># Additional validation from utils</span>
        <span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tests</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_frame</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.eurostat.Eurostat.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">dataset_code</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the class with Eurostat API data fetching setup.</p>
<p>This method uses an HTTPS request to pull data from the Eurostat API.
No API registration or API key is required. Data is fetched based on the
parameters provided in the dynamic part of the URL.</p>
<p>Example URL:
Static part: https://ec.europa.eu/eurostat/api/dissemination/statistics/1.0/data
Dynamic part: /TEIBS020/?format=JSON&amp;lang=EN&amp;indic=BS-CSMCI-BAL</p>
<p>To retrieve specific data, parameters with codes must be provided in <code>params</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dataset_code</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The code of the Eurostat dataset to be downloaded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with optional URL parameters. Each key is a parameter ID,
and the value is a specific parameter code, e.g.,
<code>params = {'unit': 'EUR'}</code> where "unit" is the parameter, and "EUR" is
the code. Only one code per parameter is allowed. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>columns</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of column names (as strings) that are required from the dataset.
Filters the data to only include the specified columns.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tests</code>
            </td>
            <td>
                  <code><span title="dict">dict</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing test cases for the data, including:
- <code>column_size</code>: dict{column: size}
- <code>column_unique_values</code>: list[columns]
- <code>column_list_to_match</code>: list[columns]
- <code>dataset_row_count</code>: dict{'min': number, 'max': number}
- <code>column_match_regex</code>: dict{column: 'regex'}
- <code>column_sum</code>: dict{column: {'min': number, 'max': number}}.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional arguments passed to the class initializer.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/eurostat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">dataset_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tests</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the class with Eurostat API data fetching setup.</span>

<span class="sd">    This method uses an HTTPS request to pull data from the Eurostat API.</span>
<span class="sd">    No API registration or API key is required. Data is fetched based on the</span>
<span class="sd">    parameters provided in the dynamic part of the URL.</span>

<span class="sd">    Example URL:</span>
<span class="sd">    Static part: https://ec.europa.eu/eurostat/api/dissemination/statistics/1.0/data</span>
<span class="sd">    Dynamic part: /TEIBS020/?format=JSON&amp;lang=EN&amp;indic=BS-CSMCI-BAL</span>

<span class="sd">    To retrieve specific data, parameters with codes must be provided in `params`.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset_code (str):</span>
<span class="sd">            The code of the Eurostat dataset to be downloaded.</span>
<span class="sd">        params (dict[str, str] | None, optional):</span>
<span class="sd">            A dictionary with optional URL parameters. Each key is a parameter ID,</span>
<span class="sd">            and the value is a specific parameter code, e.g.,</span>
<span class="sd">            `params = {&#39;unit&#39;: &#39;EUR&#39;}` where &quot;unit&quot; is the parameter, and &quot;EUR&quot; is</span>
<span class="sd">            the code. Only one code per parameter is allowed. Defaults to None.</span>
<span class="sd">        columns (list[str] | None, optional):</span>
<span class="sd">            A list of column names (as strings) that are required from the dataset.</span>
<span class="sd">            Filters the data to only include the specified columns.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        tests (dict | None, optional):</span>
<span class="sd">            A dictionary containing test cases for the data, including:</span>
<span class="sd">            - `column_size`: dict{column: size}</span>
<span class="sd">            - `column_unique_values`: list[columns]</span>
<span class="sd">            - `column_list_to_match`: list[columns]</span>
<span class="sd">            - `dataset_row_count`: dict{&#39;min&#39;: number, &#39;max&#39;: number}</span>
<span class="sd">            - `column_match_regex`: dict{column: &#39;regex&#39;}</span>
<span class="sd">            - `column_sum`: dict{column: {&#39;min&#39;: number, &#39;max&#39;: number}}.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        **kwargs:</span>
<span class="sd">            Additional arguments passed to the class initializer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_code</span> <span class="o">=</span> <span class="n">dataset_code</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tests</span> <span class="o">=</span> <span class="n">tests</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.eurostat.Eurostat.eurostat_dictionary_to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eurostat_dictionary_to_df</span><span class="p">(</span><span class="o">*</span><span class="n">signals</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function for creating DataFrame from JSON pulled from Eurostat.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Pandas DataFrame With 4 columns: index, geo, time, indicator</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/eurostat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">eurostat_dictionary_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">signals</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function for creating DataFrame from JSON pulled from Eurostat.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Pandas DataFrame With 4 columns: index, geo, time, indicator</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">TSignal</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Class representing a signal with keys, indexes, labels, and name.</span>

<span class="sd">        Attributes:</span>
<span class="sd">        signal_keys_list : list[str]</span>
<span class="sd">            A list of keys representing unique identifiers for the signal.</span>
<span class="sd">        signal_index_list : list[str]</span>
<span class="sd">            A list of index values corresponding to the keys of the signal.</span>
<span class="sd">        signal_label_list : list[str]</span>
<span class="sd">            A list of labels providing human-readable names for the</span>
<span class="sd">            signal&#39;s keys.</span>
<span class="sd">        signal_name : str</span>
<span class="sd">            The name of the signal.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">signal_keys_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
        <span class="n">signal_index_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
        <span class="n">signal_label_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
        <span class="n">signal_name</span><span class="p">:</span> <span class="nb">str</span>

    <span class="c1"># Dataframe creation</span>
    <span class="n">columns0</span> <span class="o">=</span> <span class="n">signals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">columns0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;indicator&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns0</span><span class="p">)</span>
    <span class="n">indicator_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">index_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">signal_lists</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Get the dictionary from the inputs</span>
    <span class="n">eurostat_dictionary</span> <span class="o">=</span> <span class="n">signals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">signal</span> <span class="ow">in</span> <span class="n">signals</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">signal_struct</span> <span class="o">=</span> <span class="n">TSignal</span><span class="p">()</span>
        <span class="n">signal_struct</span><span class="o">.</span><span class="n">signal_name</span> <span class="o">=</span> <span class="n">signal</span>
        <span class="n">signal_struct</span><span class="o">.</span><span class="n">signal_keys_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">eurostat_dictionary</span><span class="p">[</span><span class="s2">&quot;dimension&quot;</span><span class="p">][</span><span class="n">signal</span><span class="p">][</span><span class="s2">&quot;category&quot;</span><span class="p">][</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">signal_struct</span><span class="o">.</span><span class="n">signal_index_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">eurostat_dictionary</span><span class="p">[</span><span class="s2">&quot;dimension&quot;</span><span class="p">][</span><span class="n">signal</span><span class="p">][</span><span class="s2">&quot;category&quot;</span><span class="p">][</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">signal_label_dict</span> <span class="o">=</span> <span class="n">eurostat_dictionary</span><span class="p">[</span><span class="s2">&quot;dimension&quot;</span><span class="p">][</span><span class="n">signal</span><span class="p">][</span><span class="s2">&quot;category&quot;</span><span class="p">][</span>
            <span class="s2">&quot;label&quot;</span>
        <span class="p">]</span>
        <span class="n">signal_struct</span><span class="o">.</span><span class="n">signal_label_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">signal_label_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">signal_struct</span><span class="o">.</span><span class="n">signal_keys_list</span>
        <span class="p">]</span>
        <span class="n">signal_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">signal_struct</span><span class="p">)</span>

    <span class="n">col_signal_temp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">row_signal_temp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row_label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">signal_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">signal_index_list</span><span class="p">,</span>
        <span class="n">signal_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">signal_label_list</span><span class="p">,</span>
        <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>  <span class="c1"># rows</span>
        <span class="k">for</span> <span class="n">col_index</span><span class="p">,</span> <span class="n">col_label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">signal_lists</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">signal_index_list</span><span class="p">,</span>
            <span class="n">signal_lists</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">signal_label_list</span><span class="p">,</span>
            <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">):</span>  <span class="c1"># cols</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">col_index</span> <span class="o">+</span> <span class="n">row_index</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">signal_lists</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">signal_label_list</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">eurostat_dictionary</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]:</span>
                <span class="n">index_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="n">col_signal_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_label</span><span class="p">)</span>
                <span class="n">row_signal_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_label</span><span class="p">)</span>

    <span class="n">indicator_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">eurostat_dictionary</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index_list</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">indicator</span> <span class="o">=</span> <span class="n">indicator_list</span>
    <span class="n">df</span><span class="p">[</span><span class="n">signal_lists</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">signal_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">col_signal_temp</span>
    <span class="n">df</span><span class="p">[</span><span class="n">signal_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">signal_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_signal_temp</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.eurostat.Eurostat.get_parameters_codes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_parameters_codes</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Retrieve available API request parameters and their codes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>URL built for API call.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the response from the API is empty or invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="list">list</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, list[str]]: Key is a parameter, and value is a list of
available codes for the specified parameter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/eurostat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_parameters_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve available API request parameters and their codes.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): URL built for API call.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the response from the API is empty or invalid.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, list[str]]: Key is a parameter, and value is a list of</span>
<span class="sd">            available codes for the specified parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="n">available_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

    <span class="c1"># Dictionary from JSON with keys and related codes values</span>
    <span class="n">dimension</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dimension&quot;</span><span class="p">]</span>

    <span class="c1"># Assigning list of available codes to specific parameters</span>
    <span class="n">params_and_codes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">available_params</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dimension</span><span class="p">:</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dimension</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;category&quot;</span><span class="p">][</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">params_and_codes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">codes</span>
    <span class="k">return</span> <span class="n">params_and_codes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.eurostat.Eurostat.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function responsible for getting response and creating DataFrame.</p>
<p>It is using method 'eurostat_dictionary_to_df' with validation
of provided parameters and their codes if needed.</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If self.params is different type than a dictionary.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If self.columns is different type than a list containing strings.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="viadot.utils.APIError">APIError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If there is an error with the API request.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Pandas DataFrame.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/eurostat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_viadot_metadata_columns</span>
<span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function responsible for getting response and creating DataFrame.</span>

<span class="sd">    It is using method &#39;eurostat_dictionary_to_df&#39; with validation</span>
<span class="sd">    of provided parameters and their codes if needed.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: If self.params is different type than a dictionary.</span>
<span class="sd">        TypeError: If self.columns is different type than a list containing strings.</span>
<span class="sd">        APIError: If there is an error with the API request.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Pandas DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Checking if params and columns have correct type</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Params should be a dictionary.&quot;</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Requested columns should be provided as list of strings.&quot;</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Creating url for connection with API</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_code</span><span class="si">}</span><span class="s2">?format=JSON&amp;lang=EN&quot;</span>

    <span class="c1"># Making parameters validation</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_params</span><span class="p">(</span>
            <span class="n">dataset_code</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_code</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span>
        <span class="p">)</span>

    <span class="c1"># Getting response from API</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">APIError</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_params</span><span class="p">(</span>
            <span class="n">dataset_code</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_code</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span>
        <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eurostat_dictionary_to_df</span><span class="p">([</span><span class="s2">&quot;geo&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>

    <span class="c1"># Merge data_frame with label and last updated date</span>
    <span class="n">label_col</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]),</span> <span class="n">index</span><span class="o">=</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
    <span class="n">last_updated__col</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]),</span>
        <span class="n">index</span><span class="o">=</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;updated&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">label_col</span><span class="p">,</span> <span class="n">last_updated__col</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Validation and transformation of requested column</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filter_df_columns</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="c1"># Additional validation from utils</span>
    <span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tests</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data_frame</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.eurostat.Eurostat.validate_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_params</span><span class="p">(</span><span class="n">dataset_code</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Validates given parameters against the available parameters in the dataset.</p>


<details class="important" open>
  <summary>Important</summary>
  <p>Each dataset in Eurostat has specific parameters that could be used for
filtering the data. For example dataset ILC_DI04 -Mean and median income by
household type - EU-SILC and ECHP surveys has parameter such as:
hhhtyp (Type of household), which can be filtered by specific available
code of this parameter, such as: 'total', 'a1' (single person),
'a1_dhc' (single person with dependent children). Please note that each
dataset has different parameters and different codes</p>
</details>

<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If any of the <code>params</code> keys or values is not a string or</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/eurostat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_params</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataset_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validates given parameters against the available parameters in the dataset.</span>

<span class="sd">    Important:</span>
<span class="sd">        Each dataset in Eurostat has specific parameters that could be used for</span>
<span class="sd">        filtering the data. For example dataset ILC_DI04 -Mean and median income by</span>
<span class="sd">        household type - EU-SILC and ECHP surveys has parameter such as:</span>
<span class="sd">        hhhtyp (Type of household), which can be filtered by specific available</span>
<span class="sd">        code of this parameter, such as: &#39;total&#39;, &#39;a1&#39; (single person),</span>
<span class="sd">        &#39;a1_dhc&#39; (single person with dependent children). Please note that each</span>
<span class="sd">        dataset has different parameters and different codes</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If any of the `params` keys or values is not a string or</span>
<span class="sd">        any of them is not available for specific dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># In order to make params validation, first we need to get params_and_codes.</span>
    <span class="n">key_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameters_codes</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">key_codes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Conversion keys and values on lower cases by using casefold</span>
        <span class="n">key_codes_after_conversion</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="o">.</span><span class="n">casefold</span><span class="p">():</span> <span class="p">[</span><span class="n">v_elem</span><span class="o">.</span><span class="n">casefold</span><span class="p">()</span> <span class="k">for</span> <span class="n">v_elem</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">key_codes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">params_after_conversion</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="o">.</span><span class="n">casefold</span><span class="p">():</span> <span class="n">v</span><span class="o">.</span><span class="n">casefold</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="c1"># Comparing keys and values</span>
        <span class="n">non_available_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">key</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params_after_conversion</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_codes_after_conversion</span>
        <span class="p">]</span>
        <span class="n">non_available_codes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">value</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params_after_conversion</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_codes_after_conversion</span>
            <span class="ow">and</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_codes_after_conversion</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="c1"># Error loggers</span>

        <span class="k">if</span> <span class="n">non_available_keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Parameters: &#39;</span><span class="si">{</span><span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">non_available_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; are not in &quot;</span>
                <span class="s2">&quot;dataset. Please check your spelling!&quot;</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Possible parameters: </span><span class="si">{</span><span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">key_codes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">non_available_codes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Parameters codes: &#39;</span><span class="si">{</span><span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">non_available_codes</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; are not &quot;</span>
                <span class="s2">&quot;available. Please check your spelling!</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;You can find everything via link: https://ec.europa.eu/&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;eurostat/databrowser/view/</span><span class="si">{</span><span class="n">dataset_code</span><span class="si">}</span><span class="s2">/default/table?lang=en&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">non_available_keys</span> <span class="ow">or</span> <span class="n">non_available_codes</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Wrong parameters or codes were provided!&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.exchange_rates.ExchangeRates" class="doc doc-heading">
            <code>viadot.sources.exchange_rates.ExchangeRates</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>








              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/exchange_rates.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ExchangeRates</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
    <span class="n">URL</span> <span class="o">=</span> <span class="s2">&quot;https://api.apilayer.com/exchangerates_data/timeseries&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">currency</span><span class="p">:</span> <span class="n">Currency</span> <span class="o">=</span> <span class="s2">&quot;USD&quot;</span><span class="p">,</span>
        <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="n">symbols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download data from https://api.apilayer.com/exchangerates_data/timeseries.</span>

<span class="sd">        Args:</span>
<span class="sd">            currency (Currency, optional): Base currency to which prices of searched</span>
<span class="sd">                currencies are related. Defaults to &quot;USD&quot;.</span>
<span class="sd">            start_date (str, optional): Initial date for data search. Data range is</span>
<span class="sd">                start_date -&gt; end_date, supported format &#39;yyyy-mm-dd&#39;. Defaults to</span>
<span class="sd">                    datetime.today().strftime(&quot;%Y-%m-%d&quot;).</span>
<span class="sd">            end_date (str, optional): See above. Defaults to</span>
<span class="sd">                datetime.today().strftime(&quot;%Y-%m-%d&quot;).</span>
<span class="sd">            symbols (list, optional): List of ISO codes for which exchange rates from</span>
<span class="sd">                base currency will be fetched. Defaults to [&quot;USD&quot;, &quot;EUR&quot;, &quot;GBP&quot;, &quot;CHF&quot;,</span>
<span class="sd">                &quot;PLN&quot;, &quot;DKK&quot;, &quot;COP&quot;, &quot;CZK&quot;, &quot;SEK&quot;, &quot;NOK&quot;, &quot;ISK&quot; ].</span>
<span class="sd">            credentials (Dict[str, Any], optional): The credentials to use. Defaults to</span>
<span class="sd">                None.</span>
<span class="sd">            config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">                credentials.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">credentials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please specify the credentials.&quot;</span>
            <span class="k">raise</span> <span class="n">CredentialError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">symbols</span><span class="p">:</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;USD&quot;</span><span class="p">,</span>
                <span class="s2">&quot;EUR&quot;</span><span class="p">,</span>
                <span class="s2">&quot;GBP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;CHF&quot;</span><span class="p">,</span>
                <span class="s2">&quot;PLN&quot;</span><span class="p">,</span>
                <span class="s2">&quot;DKK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;COP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;CZK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;SEK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;NOK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ISK&quot;</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="n">symbols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_symbols</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">currency</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">cur_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;USD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EUR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GBP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CHF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PLN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DKK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;COP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CZK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SEK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NOK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ISK&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">currency</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cur_list</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The specified currency does not exist or is unsupported: </span><span class="si">{</span><span class="n">currency</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cur_list</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The specified currency list item does not exist or is not supported: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download data from the API.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: The data from the API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;api_key&quot;</span><span class="p">]}</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span>
            <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
            <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
            <span class="s2">&quot;symbols&quot;</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
            <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">ExchangeRates</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_records</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download data and convert it to a list of records.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[tuple]: The records of the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">]:</span>
            <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;base&quot;</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">iter</span><span class="p">(</span><span class="n">records</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">)),</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the columns of the data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: The columns of the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;Base&quot;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download data and convert it to a JSON.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: The JSON with the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_records</span><span class="p">()</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_columns</span><span class="p">()</span>
        <span class="n">records</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">))</span>
        <span class="p">]</span>
        <span class="n">json</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">json</span><span class="p">[</span><span class="s2">&quot;currencies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">records</span>

        <span class="k">return</span> <span class="n">json</span>

    <span class="nd">@add_viadot_metadata_columns</span>
    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tests</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download data and convert it to a pandas DataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            tests (dict | None, optional): The tests specification. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: The pandas DataFrame with the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s2">&quot;currencies&quot;</span><span class="p">])</span>
        <span class="n">df_clean</span> <span class="o">=</span> <span class="n">cleanup_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tests</span><span class="p">:</span>
            <span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df_clean</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="n">tests</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df_clean</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.exchange_rates.ExchangeRates.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">currency</span><span class="o">=</span><span class="s1">&#39;USD&#39;</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download data from https://api.apilayer.com/exchangerates_data/timeseries.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>currency</code>
            </td>
            <td>
                  <code><span title="viadot.sources.exchange_rates.Currency">Currency</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base currency to which prices of searched
currencies are related. Defaults to "USD".</p>
              </div>
            </td>
            <td>
                  <code>&#39;USD&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial date for data search. Data range is
start_date -&gt; end_date, supported format 'yyyy-mm-dd'. Defaults to
    datetime.today().strftime("%Y-%m-%d").</p>
              </div>
            </td>
            <td>
                  <code><span title="strftime">strftime</span>(&#39;%Y-%m-%d&#39;)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>See above. Defaults to
datetime.today().strftime("%Y-%m-%d").</p>
              </div>
            </td>
            <td>
                  <code><span title="strftime">strftime</span>(&#39;%Y-%m-%d&#39;)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>symbols</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of ISO codes for which exchange rates from
base currency will be fetched. Defaults to ["USD", "EUR", "GBP", "CHF",
"PLN", "DKK", "COP", "CZK", "SEK", "NOK", "ISK" ].</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>credentials</code>
            </td>
            <td>
                  <code><span title="Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The credentials to use. Defaults to
None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key in the viadot config holding relevant
credentials.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/exchange_rates.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">currency</span><span class="p">:</span> <span class="n">Currency</span> <span class="o">=</span> <span class="s2">&quot;USD&quot;</span><span class="p">,</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="n">symbols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download data from https://api.apilayer.com/exchangerates_data/timeseries.</span>

<span class="sd">    Args:</span>
<span class="sd">        currency (Currency, optional): Base currency to which prices of searched</span>
<span class="sd">            currencies are related. Defaults to &quot;USD&quot;.</span>
<span class="sd">        start_date (str, optional): Initial date for data search. Data range is</span>
<span class="sd">            start_date -&gt; end_date, supported format &#39;yyyy-mm-dd&#39;. Defaults to</span>
<span class="sd">                datetime.today().strftime(&quot;%Y-%m-%d&quot;).</span>
<span class="sd">        end_date (str, optional): See above. Defaults to</span>
<span class="sd">            datetime.today().strftime(&quot;%Y-%m-%d&quot;).</span>
<span class="sd">        symbols (list, optional): List of ISO codes for which exchange rates from</span>
<span class="sd">            base currency will be fetched. Defaults to [&quot;USD&quot;, &quot;EUR&quot;, &quot;GBP&quot;, &quot;CHF&quot;,</span>
<span class="sd">            &quot;PLN&quot;, &quot;DKK&quot;, &quot;COP&quot;, &quot;CZK&quot;, &quot;SEK&quot;, &quot;NOK&quot;, &quot;ISK&quot; ].</span>
<span class="sd">        credentials (Dict[str, Any], optional): The credentials to use. Defaults to</span>
<span class="sd">            None.</span>
<span class="sd">        config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">            credentials.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">credentials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please specify the credentials.&quot;</span>
        <span class="k">raise</span> <span class="n">CredentialError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">symbols</span><span class="p">:</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;USD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EUR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GBP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CHF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PLN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DKK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;COP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CZK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SEK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NOK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ISK&quot;</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="n">symbols</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_symbols</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.exchange_rates.ExchangeRates.get_columns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_columns</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the columns of the data.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[str]: The columns of the data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/exchange_rates.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the columns of the data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[str]: The columns of the data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;Base&quot;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.exchange_rates.ExchangeRates.get_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_data</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download data from the API.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, Any]: The data from the API.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/exchange_rates.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download data from the API.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, Any]: The data from the API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;api_key&quot;</span><span class="p">]}</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span>
        <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
        <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
        <span class="s2">&quot;symbols&quot;</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
        <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">ExchangeRates</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.exchange_rates.ExchangeRates.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">tests</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download data and convert it to a pandas DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tests</code>
            </td>
            <td>
                  <code><span title="dict">dict</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tests specification. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: The pandas DataFrame with the data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/exchange_rates.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_viadot_metadata_columns</span>
<span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">tests</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download data and convert it to a pandas DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        tests (dict | None, optional): The tests specification. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: The pandas DataFrame with the data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s2">&quot;currencies&quot;</span><span class="p">])</span>
    <span class="n">df_clean</span> <span class="o">=</span> <span class="n">cleanup_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tests</span><span class="p">:</span>
        <span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df_clean</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="n">tests</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_clean</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.exchange_rates.ExchangeRates.to_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_json</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download data and convert it to a JSON.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, Any]: The JSON with the data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/exchange_rates.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download data and convert it to a JSON.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, Any]: The JSON with the data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_records</span><span class="p">()</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_columns</span><span class="p">()</span>
    <span class="n">records</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">))</span>
    <span class="p">]</span>
    <span class="n">json</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">json</span><span class="p">[</span><span class="s2">&quot;currencies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">records</span>

    <span class="k">return</span> <span class="n">json</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.exchange_rates.ExchangeRates.to_records" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_records</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download data and convert it to a list of records.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[tuple]: The records of the data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/exchange_rates.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_records</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download data and convert it to a list of records.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[tuple]: The records of the data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
    <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">]:</span>
        <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;base&quot;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">iter</span><span class="p">(</span><span class="n">records</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">)),</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.genesys.Genesys" class="doc doc-heading">
            <code>viadot.sources.genesys.Genesys</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>








              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/genesys.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Genesys</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
    <span class="n">ENVIRONMENTS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;cac1.pure.cloud&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sae1.pure.cloud&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mypurecloud.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;usw2.pure.cloud&quot;</span><span class="p">,</span>
        <span class="s2">&quot;aps1.pure.cloud&quot;</span><span class="p">,</span>
        <span class="s2">&quot;apne3.pure.cloud&quot;</span><span class="p">,</span>
        <span class="s2">&quot;apne2.pure.cloud&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mypurecloud.com.au&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mypurecloud.jp&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mypurecloud.ie&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mypurecloud.de&quot;</span><span class="p">,</span>
        <span class="s2">&quot;euw2.pure.cloud&quot;</span><span class="p">,</span>
        <span class="s2">&quot;euc2.pure.cloud&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mec1.pure.cloud&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">GenesysCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;genesys&quot;</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">environment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mypurecloud.de&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genesys Cloud API connector.</span>

<span class="sd">        Provides functionalities for connecting to Genesys Cloud API and downloading</span>
<span class="sd">        generated reports. It includes the following features:</span>

<span class="sd">        - Generate reports inside Genesys.</span>
<span class="sd">        - Download the reports previously created.</span>
<span class="sd">        - Direct connection to Genesys Cloud API, via GET method, to retrieve the data</span>
<span class="sd">          without any report creation.</span>
<span class="sd">        - Remove any report previously created.</span>

<span class="sd">        Args:</span>
<span class="sd">            credentials (Optional[GenesysCredentials], optional): Genesys credentials.</span>
<span class="sd">                Defaults to None</span>
<span class="sd">            config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">                credentials. Defaults to &quot;genesys&quot;.</span>
<span class="sd">            verbose (bool, optional): Increase the details of the logs printed on the</span>
<span class="sd">                screen. Defaults to False.</span>
<span class="sd">            environment (str, optional): the domain that appears for Genesys Cloud</span>
<span class="sd">                Environment based on the location of your Genesys Cloud organization.</span>
<span class="sd">                Defaults to &quot;mypurecloud.de&quot;.</span>

<span class="sd">        Examples:</span>
<span class="sd">            genesys = Genesys(</span>
<span class="sd">                credentials=credentials,</span>
<span class="sd">                config_key=config_key,</span>
<span class="sd">                verbose=verbose,</span>
<span class="sd">                environment=environment,</span>
<span class="sd">            )</span>
<span class="sd">            genesys.api_connection(</span>
<span class="sd">                endpoint=endpoint,</span>
<span class="sd">                queues_ids=queues_ids,</span>
<span class="sd">                view_type=view_type,</span>
<span class="sd">                view_type_time_sleep=view_type_time_sleep,</span>
<span class="sd">                post_data_list=post_data_list,</span>
<span class="sd">                normalization_sep=normalization_sep,</span>
<span class="sd">            )</span>
<span class="sd">            data_frame = genesys.to_df(</span>
<span class="sd">                drop_duplicates=drop_duplicates,</span>
<span class="sd">                validate_df_dict=validate_df_dict,</span>
<span class="sd">            )</span>

<span class="sd">        Raises:</span>
<span class="sd">            CredentialError: If credentials are not provided in local_config or directly</span>
<span class="sd">                as a parameter.</span>
<span class="sd">            APIError: When the environment variable is not among the available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
        <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">GenesysCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_report</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span>  <span class="c1"># ???</span>

        <span class="k">if</span> <span class="n">environment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENVIRONMENTS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environment</span> <span class="o">=</span> <span class="n">environment</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Environment &#39;</span><span class="si">{</span><span class="n">environment</span><span class="si">}</span><span class="s2">&#39; not available&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; in Genesys Cloud Environments.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">headers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get request headers.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]: Request headers with token.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;client_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">client_secret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;client_secret&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">authorization</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span>
            <span class="nb">bytes</span><span class="p">(</span><span class="n">client_id</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">client_secret</span><span class="p">,</span> <span class="s2">&quot;ISO-8859-1&quot;</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>
        <span class="n">request_headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Basic </span><span class="si">{</span><span class="n">authorization</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">request_body</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;grant_type&quot;</span><span class="p">:</span> <span class="s2">&quot;client_credentials&quot;</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;https://login.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="si">}</span><span class="s2">/oauth/token&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">request_body</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">request_headers</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Temporary authorization token was generated.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failure: </span><span class="si">{</span><span class="w"> </span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="w"> </span><span class="si">!s}</span><span class="s2"> - </span><span class="si">{</span><span class="w"> </span><span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">response_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="w"> </span><span class="n">response_json</span><span class="p">[</span><span class="s1">&#39;token_type&#39;</span><span class="p">]</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="w"> </span><span class="n">response_json</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_api_call</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">post_data_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time_between_api_call</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;General method to connect to Genesys Cloud API and generate the response.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (str): Final end point to the API.</span>
<span class="sd">            post_data_list (List[str]): List of string templates to generate json body.</span>
<span class="sd">            method (str): Type of connection to the API. Defaults to &quot;POST&quot;.</span>
<span class="sd">            params (Optional[Dict[str, Any]], optional): Parameters to be passed into</span>
<span class="sd">                the POST call. Defaults to None.</span>
<span class="sd">            time_between_api_call (int, optional): The time, in seconds, to sleep the</span>
<span class="sd">                call to the API. Defaults to 0.5.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: There is no current event loop in asyncio thread.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]: Genesys Cloud API response. When the endpoint requires to</span>
<span class="sd">                create a report within Genesys Cloud, the response is just useless</span>
<span class="sd">                information. The useful data must be downloaded from apps.{environment}</span>
<span class="sd">                through another requests.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">limiter</span> <span class="o">=</span> <span class="n">AsyncLimiter</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
        <span class="n">semaphore</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="si">}</span><span class="s2">/api/v2/</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">generate_post</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">data_to_post</span> <span class="ow">in</span> <span class="n">post_data_list</span><span class="p">:</span>
                <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data_to_post</span><span class="p">)</span>

                <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">semaphore</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>

                    <span class="k">async</span> <span class="k">with</span> <span class="n">limiter</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
                            <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                                <span class="n">url</span><span class="p">,</span>
                                <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
                                <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                            <span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
                                <span class="c1"># global new_report</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">new_report</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Generated report export ---&quot;</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                                    <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">.&quot;</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

                                <span class="n">semaphore</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

                        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
                            <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                                <span class="n">url</span><span class="p">,</span>
                                <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
                                <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                            <span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">new_report</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Connecting to Genesys Cloud&quot;</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                                    <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">.&quot;</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

                                <span class="n">semaphore</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">time_between_api_call</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;There is no current event loop in thread&quot;</span><span class="p">):</span>
                <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">new_event_loop</span><span class="p">()</span>
                <span class="n">asyncio</span><span class="o">.</span><span class="n">set_event_loop</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="n">coroutine</span> <span class="o">=</span> <span class="n">generate_post</span><span class="p">()</span>
        <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">coroutine</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_report</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_load_reporting_exports</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Consult the status of the reports created in Genesys Cloud.</span>

<span class="sd">        Args:</span>
<span class="sd">            page_size (int, optional): The number of items on page to print.</span>
<span class="sd">                Defaults to 100.</span>
<span class="sd">            verbose (bool, optional): Switch on/off for logging messages.</span>
<span class="sd">                Defaults to False.</span>

<span class="sd">        Raises:</span>
<span class="sd">            APIError: Failed to loaded the exports from Genesys Cloud.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]: Schedule genesys report.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="si">}</span><span class="s2">/api/v2/&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;analytics/reporting/exports?pageSize=</span><span class="si">{</span><span class="n">page_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">response_ok</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">response_ok</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to loaded all exports. - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed to loaded all exports.&quot;</span>
        <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_reporting_exports_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entities</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Collect all reports created in Genesys Cloud.</span>

<span class="sd">        Args:</span>
<span class="sd">            entities (List[str]): List of dictionaries with all the reports information</span>
<span class="sd">                available in Genesys Cloud.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[List[str]]: A tuple with Lists of IDs and URLs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">status</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span>
            <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;downloadUrl&quot;</span><span class="p">))</span>
            <span class="n">status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="s2">&quot;FAILED&quot;</span> <span class="ow">in</span> <span class="n">status</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Some reports have not been successfully created.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;RUNNING&quot;</span> <span class="ow">in</span> <span class="n">status</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Some reports are still being created and can not be downloaded.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report status:</span><span class="se">\n</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ids</span><span class="p">,</span> <span class="n">urls</span>

    <span class="k">def</span> <span class="nf">_delete_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a particular report in Genesys Cloud.</span>

<span class="sd">        Args:</span>
<span class="sd">            report_id (str): Id of the report to be deleted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">delete_response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="si">}</span><span class="s2">/api/v2/&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;analytics/reporting/exports/</span><span class="si">{</span><span class="n">report_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;DELETE&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Ok-ish responses (includes eg. 204 No Content)</span>
        <span class="n">ok_response_limit</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="k">if</span> <span class="n">delete_response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="n">ok_response_limit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Successfully deleted report &#39;</span><span class="si">{</span><span class="n">report_id</span><span class="si">}</span><span class="s2">&#39; from Genesys API.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to delete report &#39;</span><span class="si">{</span><span class="n">report_id</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;from Genesys API. - </span><span class="si">{</span><span class="n">delete_response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_download_report</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">report_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">drop_duplicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download report from Genesys Cloud.</span>

<span class="sd">        Args:</span>
<span class="sd">            report_url (str): url to report, fetched from json response.</span>
<span class="sd">            drop_duplicates (bool, optional): Decide if drop duplicates.</span>
<span class="sd">                Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Data in a pandas DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>

        <span class="c1"># Ok-ish responses (includes eg. 204 No Content)</span>
        <span class="n">ok_response_limit</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="n">ok_response_limit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Successfully downloaded report from Genesys API (&#39;</span><span class="si">{</span><span class="n">report_url</span><span class="si">}</span><span class="s2">&#39;).&quot;</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Failed to download report from&quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; Genesys API (&#39;</span><span class="si">{</span><span class="n">report_url</span><span class="si">}</span><span class="s2">&#39;). - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">drop_duplicates</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dataframe</span>

    <span class="k">def</span> <span class="nf">_merge_conversations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_to_merge</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>  <span class="c1"># noqa: C901, PLR0912</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge all the conversations data into a single data frame.</span>

<span class="sd">        Args:</span>
<span class="sd">            data_to_merge (list): List with all the conversations in json format.</span>
<span class="sd">            Example for all levels data to merge:</span>
<span class="sd">                {</span>
<span class="sd">                &quot;conversations&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        **** LEVEL 0 data ****</span>
<span class="sd">                        &quot;participants&quot;: [</span>
<span class="sd">                            {</span>
<span class="sd">                                **** LEVEL 1 data ****</span>
<span class="sd">                                &quot;sessions&quot;: [</span>
<span class="sd">                                    {</span>
<span class="sd">                                        &quot;agentBullseyeRing&quot;: 1,</span>
<span class="sd">                                        **** LEVEL 2 data ****</span>
<span class="sd">                                        &quot;mediaEndpointStats&quot;: [</span>
<span class="sd">                                            {</span>
<span class="sd">                                                **** LEVEL 3 data ****</span>
<span class="sd">                                            },</span>
<span class="sd">                                        ],</span>
<span class="sd">                                        &quot;metrics&quot;: [</span>
<span class="sd">                                            {</span>
<span class="sd">                                                **** LEVEL 3 data ****</span>
<span class="sd">                                            },</span>
<span class="sd">                                        ],</span>
<span class="sd">                                        &quot;segments&quot;: [</span>
<span class="sd">                                            {</span>
<span class="sd">                                                **** LEVEL 3 data ****</span>
<span class="sd">                                            },</span>
<span class="sd">                                            {</span>
<span class="sd">                                                **** LEVEL 3 data ****</span>
<span class="sd">                                            },</span>
<span class="sd">                                        ],</span>
<span class="sd">                                    }</span>
<span class="sd">                                ],</span>
<span class="sd">                            },</span>
<span class="sd">                            {</span>
<span class="sd">                                &quot;participantId&quot;: &quot;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&quot;,</span>
<span class="sd">                                **** LEVEL 1 data ****</span>
<span class="sd">                                &quot;sessions&quot;: [</span>
<span class="sd">                                    {</span>
<span class="sd">                                        **** LEVEL 2 data ****</span>
<span class="sd">                                        &quot;mediaEndpointStats&quot;: [</span>
<span class="sd">                                            {</span>
<span class="sd">                                                **** LEVEL 3 data ****</span>
<span class="sd">                                            }</span>
<span class="sd">                                        ],</span>
<span class="sd">                                        &quot;flow&quot;: {</span>
<span class="sd">                                            **** LEVEL 2 data ****</span>
<span class="sd">                                        },</span>
<span class="sd">                                        &quot;metrics&quot;: [</span>
<span class="sd">                                            {</span>
<span class="sd">                                                **** LEVEL 3 data ****</span>
<span class="sd">                                            },</span>
<span class="sd">                                        ],</span>
<span class="sd">                                        &quot;segments&quot;: [</span>
<span class="sd">                                            {</span>
<span class="sd">                                                **** LEVEL 3 data ****</span>
<span class="sd">                                            },</span>
<span class="sd">                                        ],</span>
<span class="sd">                                    }</span>
<span class="sd">                                ],</span>
<span class="sd">                            },</span>
<span class="sd">                        ],</span>
<span class="sd">                    }</span>
<span class="sd">                ],</span>
<span class="sd">                &quot;totalHits&quot;: 100,</span>
<span class="sd">            }</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A single data frame with all the content.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># LEVEL 0</span>
        <span class="n">df0</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">data_to_merge</span><span class="p">)</span>
        <span class="n">df0</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;participants&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># LEVEL 1</span>
        <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span>
            <span class="n">data_to_merge</span><span class="p">,</span>
            <span class="n">record_path</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participants&quot;</span><span class="p">],</span>
            <span class="n">meta</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;conversationId&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">df1</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;sessions&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># LEVEL 2</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span>
            <span class="n">data_to_merge</span><span class="p">,</span>
            <span class="n">record_path</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participants&quot;</span><span class="p">,</span> <span class="s2">&quot;sessions&quot;</span><span class="p">],</span>
            <span class="n">meta</span><span class="o">=</span><span class="p">[</span>
                <span class="p">[</span><span class="s2">&quot;participants&quot;</span><span class="p">,</span> <span class="s2">&quot;externalContactId&quot;</span><span class="p">],</span>
                <span class="p">[</span><span class="s2">&quot;participants&quot;</span><span class="p">,</span> <span class="s2">&quot;participantId&quot;</span><span class="p">],</span>
            <span class="p">],</span>
            <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
            <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Columns that will be the reference for the next LEVEL</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;participants_externalContactId&quot;</span><span class="p">:</span> <span class="s2">&quot;externalContactId&quot;</span><span class="p">,</span>
                <span class="s2">&quot;participants_participantId&quot;</span><span class="p">:</span> <span class="s2">&quot;participantId&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">,</span> <span class="s2">&quot;segments&quot;</span><span class="p">,</span> <span class="s2">&quot;mediaEndpointStats&quot;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">df2</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">key</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2"> not appearing in the response.&quot;</span><span class="p">)</span>

        <span class="c1"># LEVEL 3</span>
        <span class="n">conversations_df</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">conversation</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_to_merge</span><span class="p">):</span>
            <span class="c1"># Not all &quot;sessions&quot; have the same data, and that creates</span>
            <span class="c1">#   problems of standardization</span>
            <span class="c1"># Empty data will be added to columns where there is not to avoid</span>
            <span class="c1">#   future errors.</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">entry_0</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">conversation</span><span class="p">[</span><span class="s2">&quot;participants&quot;</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">entry_0</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;sessions&quot;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">entry_1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">entry_0</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
                            <span class="k">if</span> <span class="s2">&quot;metrics&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">entry_1</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                <span class="n">conversation</span><span class="p">[</span><span class="s2">&quot;participants&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;metrics&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">if</span> <span class="s2">&quot;segments&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">entry_1</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                <span class="n">conversation</span><span class="p">[</span><span class="s2">&quot;participants&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;segments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">if</span> <span class="s2">&quot;mediaEndpointStats&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">entry_1</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                <span class="n">conversation</span><span class="p">[</span><span class="s2">&quot;participants&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="n">k</span><span class="p">][</span>
                                    <span class="s2">&quot;mediaEndpointStats&quot;</span>
                                <span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># LEVEL 3 metrics</span>
            <span class="n">df3_1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span>
                <span class="n">conversation</span><span class="p">,</span>
                <span class="n">record_path</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participants&quot;</span><span class="p">,</span> <span class="s2">&quot;sessions&quot;</span><span class="p">,</span> <span class="s2">&quot;metrics&quot;</span><span class="p">],</span>
                <span class="n">meta</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">[</span><span class="s2">&quot;participants&quot;</span><span class="p">,</span> <span class="s2">&quot;sessions&quot;</span><span class="p">,</span> <span class="s2">&quot;sessionId&quot;</span><span class="p">],</span>
                <span class="p">],</span>
                <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
                <span class="n">record_prefix</span><span class="o">=</span><span class="s2">&quot;metrics_&quot;</span><span class="p">,</span>
                <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">df3_1</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;participants_sessions_sessionId&quot;</span><span class="p">:</span> <span class="s2">&quot;sessionId&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="c1"># LEVEL 3 segments</span>
            <span class="n">df3_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span>
                <span class="n">conversation</span><span class="p">,</span>
                <span class="n">record_path</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participants&quot;</span><span class="p">,</span> <span class="s2">&quot;sessions&quot;</span><span class="p">,</span> <span class="s2">&quot;segments&quot;</span><span class="p">],</span>
                <span class="n">meta</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">[</span><span class="s2">&quot;participants&quot;</span><span class="p">,</span> <span class="s2">&quot;sessions&quot;</span><span class="p">,</span> <span class="s2">&quot;sessionId&quot;</span><span class="p">],</span>
                <span class="p">],</span>
                <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
                <span class="n">record_prefix</span><span class="o">=</span><span class="s2">&quot;segments_&quot;</span><span class="p">,</span>
                <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">df3_2</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;participants_sessions_sessionId&quot;</span><span class="p">:</span> <span class="s2">&quot;sessionId&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="c1"># LEVEL 3 mediaEndpointStats</span>
            <span class="n">df3_3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span>
                <span class="n">conversation</span><span class="p">,</span>
                <span class="n">record_path</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participants&quot;</span><span class="p">,</span> <span class="s2">&quot;sessions&quot;</span><span class="p">,</span> <span class="s2">&quot;mediaEndpointStats&quot;</span><span class="p">],</span>
                <span class="n">meta</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">[</span><span class="s2">&quot;participants&quot;</span><span class="p">,</span> <span class="s2">&quot;sessions&quot;</span><span class="p">,</span> <span class="s2">&quot;sessionId&quot;</span><span class="p">],</span>
                <span class="p">],</span>
                <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
                <span class="n">record_prefix</span><span class="o">=</span><span class="s2">&quot;mediaEndpointStats_&quot;</span><span class="p">,</span>
                <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">df3_3</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;participants_sessions_sessionId&quot;</span><span class="p">:</span> <span class="s2">&quot;sessionId&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="c1"># merging all LEVELs 3 from the same conversation</span>
            <span class="n">dff3_tmp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df3_1</span><span class="p">,</span> <span class="n">df3_2</span><span class="p">])</span>
            <span class="n">dff3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dff3_tmp</span><span class="p">,</span> <span class="n">df3_3</span><span class="p">])</span>

            <span class="n">conversations_df</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="p">:</span> <span class="n">dff3</span><span class="p">})</span>

        <span class="c1"># MERGING ALL LEVELS</span>
        <span class="c1"># LEVELS 3</span>
        <span class="k">for</span> <span class="n">i_3</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">conversations_df</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="k">if</span> <span class="n">i_3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dff3_f</span> <span class="o">=</span> <span class="n">conversations_df</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dff3_f</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dff3_f</span><span class="p">,</span> <span class="n">conversations_df</span><span class="p">[</span><span class="n">key</span><span class="p">]])</span>

        <span class="c1"># LEVEL 3 with LEVEL 2</span>
        <span class="n">dff2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dff3_f</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sessionId&quot;</span><span class="p">])</span>

        <span class="c1"># LEVEL 2 with LEVEL 1</span>
        <span class="n">dff1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">df1</span><span class="p">,</span> <span class="n">dff2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;externalContactId&quot;</span><span class="p">,</span> <span class="s2">&quot;participantId&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># LEVEL 1 with LEVEL 0</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df0</span><span class="p">,</span> <span class="n">dff1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;conversationId&quot;</span><span class="p">])</span>

    <span class="c1"># This is way too complicated for what it&#39;s doing...</span>
    <span class="k">def</span> <span class="nf">api_connection</span><span class="p">(</span>  <span class="c1"># noqa: PLR0912, PLR0915, C901.</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">queues_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">view_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">view_type_time_sleep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">post_data_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time_between_api_call</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">normalization_sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;General method to connect to Genesys Cloud API and generate the response.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (Optional[str], optional): Final end point to the API.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">                Custom endpoints have specific key words, and parameters:</span>
<span class="sd">                Example:</span>
<span class="sd">                    - &quot;routing/queues/{id}/members&quot;: &quot;routing_queues_members&quot;</span>
<span class="sd">                    - members_ids = [&quot;xxxxxxxxx&quot;, &quot;xxxxxxxxx&quot;, ...]</span>
<span class="sd">            queues_ids (Optional[List[str]], optional): List of queues ids to consult</span>
<span class="sd">                the members. Defaults to None.</span>
<span class="sd">            view_type (Optional[str], optional): The type of view export job to be</span>
<span class="sd">                created. Defaults to None.</span>
<span class="sd">            view_type_time_sleep (int, optional): Waiting time to retrieve data from</span>
<span class="sd">                Genesys Cloud API. Defaults to 10.</span>
<span class="sd">            post_data_list (Optional[List[Dict[str, Any]]], optional): List of string</span>
<span class="sd">                templates to generate json body in POST calls to the API.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            time_between_api_call (int, optional): The time, in seconds, to sleep the</span>
<span class="sd">                call to the API. Defaults to 0.5.</span>
<span class="sd">            normalization_sep (str, optional): Nested records will generate names</span>
<span class="sd">                separated by sep. Defaults to &quot;.&quot;.</span>

<span class="sd">        Raises:</span>
<span class="sd">            APIError: Some or No reports were not created.</span>
<span class="sd">            APIError: At different endpoints:</span>
<span class="sd">                - &#39;analytics/conversations/details/query&#39;: only one body must be used.</span>
<span class="sd">                - &#39;routing_queues_members&#39;: extra parameter `queues_ids` must be</span>
<span class="sd">                    included.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Connecting to the Genesys Cloud using the endpoint: </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;analytics/reporting/exports&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
                <span class="n">post_data_list</span><span class="o">=</span><span class="n">post_data_list</span><span class="p">,</span>
                <span class="n">time_between_api_call</span><span class="o">=</span><span class="n">time_between_api_call</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Waiting </span><span class="si">{</span><span class="n">view_type_time_sleep</span><span class="si">}</span><span class="s2"> seconds for&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; caching data from Genesys Cloud API.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">view_type_time_sleep</span><span class="p">)</span>

            <span class="n">request_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_reporting_exports</span><span class="p">()</span>
            <span class="n">entities</span> <span class="o">=</span> <span class="n">request_json</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">ids</span><span class="p">,</span> <span class="n">urls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reporting_exports_url</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">post_data_list</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span><span class="si">}</span><span class="s2"> available reports in Genesys, &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;and where sent </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">post_data_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> reports. &quot;</span>
                        <span class="s2">&quot;Unsed reports will be removed.&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">APIError</span><span class="p">(</span>
                    <span class="s2">&quot;There are no reports to be downloaded.&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;May be </span><span class="si">{</span><span class="n">view_type_time_sleep</span><span class="si">}</span><span class="s2"> should be increased.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># download and delete reports created</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">raise_api_error</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">qid</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">urls</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">df_downloaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_report</span><span class="p">(</span><span class="n">report_url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
                    <span class="c1"># remove resume rows</span>
                    <span class="k">if</span> <span class="n">view_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;queue_performance_detail_view&quot;</span><span class="p">]:</span>
                        <span class="n">criteria</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">df_downloaded</span><span class="p">[</span><span class="s2">&quot;Queue Id&quot;</span><span class="p">]</span>
                            <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">))</span>
                            <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">df_downloaded</span> <span class="o">=</span> <span class="n">df_downloaded</span><span class="p">[</span><span class="n">criteria</span><span class="p">]</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">count</span><span class="p">:</span> <span class="n">df_downloaded</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Report id </span><span class="si">{</span><span class="n">qid</span><span class="si">}</span><span class="s2"> didn&#39;t have time to be created. &quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;Consider increasing the `view_type_time_sleep` parameter &quot;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;&gt;&gt; </span><span class="si">{</span><span class="n">view_type_time_sleep</span><span class="si">}</span><span class="s2"> seconds to allow Genesys Cloud &quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;to conclude the report creation.&quot;</span>
                    <span class="p">)</span>
                    <span class="n">raise_api_error</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_delete_report</span><span class="p">(</span><span class="n">qid</span><span class="p">)</span>

                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># noqa: SIM113</span>

            <span class="k">if</span> <span class="n">raise_api_error</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Some reports creation failed.&quot;</span>
                <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;analytics/conversations/details/query&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">post_data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Not available more than one body for this end-point.&quot;</span>
                <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">stop_loop</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">page_counter</span> <span class="o">=</span> <span class="n">post_data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;paging&quot;</span><span class="p">][</span><span class="s2">&quot;pageNumber&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Restructuring the response in order to be able to insert it into a &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;data frame.</span><span class="se">\n\t</span><span class="s2">This task could take a few minutes.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">stop_loop</span><span class="p">:</span>
                <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span>
                    <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
                    <span class="n">post_data_list</span><span class="o">=</span><span class="n">post_data_list</span><span class="p">,</span>
                    <span class="n">time_between_api_call</span><span class="o">=</span><span class="n">time_between_api_call</span><span class="p">,</span>
                    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">merged_data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_conversations</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;conversations&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">post_data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;paging&quot;</span><span class="p">][</span><span class="s2">&quot;pageNumber&quot;</span><span class="p">])</span>
                        <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">merged_data_frame</span>
                    <span class="p">}</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">page_counter</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">max_calls</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;totalHits&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">page_counter</span> <span class="o">==</span> <span class="n">max_calls</span><span class="p">:</span>
                    <span class="n">stop_loop</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="n">post_data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;paging&quot;</span><span class="p">][</span><span class="s2">&quot;pageNumber&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">page_counter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;routing/queues&quot;</span><span class="p">,</span> <span class="s2">&quot;users&quot;</span><span class="p">]:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Restructuring the response in order to be able to insert it into a &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;data frame.</span><span class="se">\n\t</span><span class="s2">This task could take a few minutes.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;routing/queues&quot;</span><span class="p">:</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pageSize&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;pageNumber&quot;</span><span class="p">:</span> <span class="n">page</span><span class="p">}</span>
                <span class="k">elif</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;users&quot;</span><span class="p">:</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;pageSize&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
                        <span class="s2">&quot;pageNumber&quot;</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span>
                        <span class="s2">&quot;expand&quot;</span><span class="p">:</span> <span class="s2">&quot;presence,dateLastLogin,groups&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;,employerInfo,lasttokenissued&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span>
                    <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
                    <span class="n">post_data_list</span><span class="o">=</span><span class="n">post_data_list</span><span class="p">,</span>
                    <span class="n">time_between_api_call</span><span class="o">=</span><span class="n">time_between_api_call</span><span class="p">,</span>
                    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
                    <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]:</span>
                    <span class="n">df_response</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span>
                        <span class="n">response</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">],</span>
                        <span class="n">sep</span><span class="o">=</span><span class="n">normalization_sep</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">df_response</span><span class="p">})</span>

                    <span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="k">elif</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;routing_queues_members&quot;</span><span class="p">:</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">queues_ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;This endpoint requires `queues_ids` parameter to work.&quot;</span>
                <span class="p">)</span>
                <span class="n">APIError</span><span class="p">(</span><span class="s2">&quot;This endpoint requires `queues_ids` parameter to work.&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">qid</span> <span class="ow">in</span> <span class="n">queues_ids</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading Agents information from Queue: </span><span class="si">{</span><span class="n">qid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span>
                        <span class="n">endpoint</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;routing/queues/</span><span class="si">{</span><span class="n">qid</span><span class="si">}</span><span class="s2">/members&quot;</span><span class="p">,</span>
                        <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pageSize&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;pageNumber&quot;</span><span class="p">:</span> <span class="n">page</span><span class="p">},</span>
                        <span class="n">post_data_list</span><span class="o">=</span><span class="n">post_data_list</span><span class="p">,</span>
                        <span class="n">time_between_api_call</span><span class="o">=</span><span class="n">time_between_api_call</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]:</span>
                        <span class="n">df_response</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">])</span>
                        <span class="c1"># drop personal information</span>
                        <span class="n">columns_to_drop</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;user.addresses&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;user.primaryContactInfo&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;user.images&quot;</span><span class="p">,</span>
                        <span class="p">}</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">df_response</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                        <span class="n">df_response</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
                            <span class="n">columns_to_drop</span><span class="p">,</span>
                            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">counter</span><span class="p">:</span> <span class="n">df_response</span><span class="p">})</span>

                        <span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">break</span>

    <span class="nd">@add_viadot_metadata_columns</span>
    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a pandas DataFrame from self.data_returned.</span>

<span class="sd">        Args:</span>
<span class="sd">            drop_duplicates (bool, optional): Remove duplicates from the DataFrame.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">            validate_df_dict (Optional[Dict[str, Any]], optional): A dictionary with</span>
<span class="sd">                optional list of tests to verify the output dataframe. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.Dataframe: The response data as a pandas DataFrame plus viadot metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">drop_duplicates</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;drop_duplicates&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">validate_df_dict</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;validate_df_dict&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="p">[</span><span class="n">key</span><span class="p">]])</span>

        <span class="k">if</span> <span class="n">drop_duplicates</span><span class="p">:</span>
            <span class="n">data_frame</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">validate_df_dict</span><span class="p">:</span>
            <span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="n">validate_df_dict</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span>
                <span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;The response does not contain any data.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_frame</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="viadot.sources.genesys.Genesys.headers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">headers</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get request headers.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, Any]: Request headers with token.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="viadot.sources.genesys.Genesys.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_key</span><span class="o">=</span><span class="s1">&#39;genesys&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">environment</span><span class="o">=</span><span class="s1">&#39;mypurecloud.de&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Genesys Cloud API connector.</p>
<p>Provides functionalities for connecting to Genesys Cloud API and downloading
generated reports. It includes the following features:</p>
<ul>
<li>Generate reports inside Genesys.</li>
<li>Download the reports previously created.</li>
<li>Direct connection to Genesys Cloud API, via GET method, to retrieve the data
  without any report creation.</li>
<li>Remove any report previously created.</li>
</ul>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>credentials</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="viadot.sources.genesys.GenesysCredentials">GenesysCredentials</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Genesys credentials.
Defaults to None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key in the viadot config holding relevant
credentials. Defaults to "genesys".</p>
              </div>
            </td>
            <td>
                  <code>&#39;genesys&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Increase the details of the logs printed on the
screen. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>environment</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the domain that appears for Genesys Cloud
Environment based on the location of your Genesys Cloud organization.
Defaults to "mypurecloud.de".</p>
              </div>
            </td>
            <td>
                  <code>&#39;mypurecloud.de&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>genesys = Genesys(
    credentials=credentials,
    config_key=config_key,
    verbose=verbose,
    environment=environment,
)
genesys.api_connection(
    endpoint=endpoint,
    queues_ids=queues_ids,
    view_type=view_type,
    view_type_time_sleep=view_type_time_sleep,
    post_data_list=post_data_list,
    normalization_sep=normalization_sep,
)
data_frame = genesys.to_df(
    drop_duplicates=drop_duplicates,
    validate_df_dict=validate_df_dict,
)</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="CredentialError">CredentialError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If credentials are not provided in local_config or directly
as a parameter.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="viadot.exceptions.APIError">APIError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the environment variable is not among the available.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/genesys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="n">GenesysCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;genesys&quot;</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mypurecloud.de&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Genesys Cloud API connector.</span>

<span class="sd">    Provides functionalities for connecting to Genesys Cloud API and downloading</span>
<span class="sd">    generated reports. It includes the following features:</span>

<span class="sd">    - Generate reports inside Genesys.</span>
<span class="sd">    - Download the reports previously created.</span>
<span class="sd">    - Direct connection to Genesys Cloud API, via GET method, to retrieve the data</span>
<span class="sd">      without any report creation.</span>
<span class="sd">    - Remove any report previously created.</span>

<span class="sd">    Args:</span>
<span class="sd">        credentials (Optional[GenesysCredentials], optional): Genesys credentials.</span>
<span class="sd">            Defaults to None</span>
<span class="sd">        config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">            credentials. Defaults to &quot;genesys&quot;.</span>
<span class="sd">        verbose (bool, optional): Increase the details of the logs printed on the</span>
<span class="sd">            screen. Defaults to False.</span>
<span class="sd">        environment (str, optional): the domain that appears for Genesys Cloud</span>
<span class="sd">            Environment based on the location of your Genesys Cloud organization.</span>
<span class="sd">            Defaults to &quot;mypurecloud.de&quot;.</span>

<span class="sd">    Examples:</span>
<span class="sd">        genesys = Genesys(</span>
<span class="sd">            credentials=credentials,</span>
<span class="sd">            config_key=config_key,</span>
<span class="sd">            verbose=verbose,</span>
<span class="sd">            environment=environment,</span>
<span class="sd">        )</span>
<span class="sd">        genesys.api_connection(</span>
<span class="sd">            endpoint=endpoint,</span>
<span class="sd">            queues_ids=queues_ids,</span>
<span class="sd">            view_type=view_type,</span>
<span class="sd">            view_type_time_sleep=view_type_time_sleep,</span>
<span class="sd">            post_data_list=post_data_list,</span>
<span class="sd">            normalization_sep=normalization_sep,</span>
<span class="sd">        )</span>
<span class="sd">        data_frame = genesys.to_df(</span>
<span class="sd">            drop_duplicates=drop_duplicates,</span>
<span class="sd">            validate_df_dict=validate_df_dict,</span>
<span class="sd">        )</span>

<span class="sd">    Raises:</span>
<span class="sd">        CredentialError: If credentials are not provided in local_config or directly</span>
<span class="sd">            as a parameter.</span>
<span class="sd">        APIError: When the environment variable is not among the available.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
    <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">GenesysCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">new_report</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span>  <span class="c1"># ???</span>

    <span class="k">if</span> <span class="n">environment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENVIRONMENTS</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environment</span> <span class="o">=</span> <span class="n">environment</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Environment &#39;</span><span class="si">{</span><span class="n">environment</span><span class="si">}</span><span class="s2">&#39; not available&quot;</span>
            <span class="o">+</span> <span class="s2">&quot; in Genesys Cloud Environments.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.genesys.Genesys.api_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">api_connection</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">queues_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">view_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">view_type_time_sleep</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">post_data_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_between_api_call</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">normalization_sep</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>General method to connect to Genesys Cloud API and generate the response.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>endpoint</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Final end point to the API.
Defaults to None.</p>
<p>Custom endpoints have specific key words, and parameters:
Example:
    - "routing/queues/{id}/members": "routing_queues_members"
    - members_ids = ["xxxxxxxxx", "xxxxxxxxx", ...]</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>queues_ids</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of queues ids to consult
the members. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>view_type</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of view export job to be
created. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>view_type_time_sleep</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Waiting time to retrieve data from
Genesys Cloud API. Defaults to 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>post_data_list</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="List">List</span>[<span title="Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of string
templates to generate json body in POST calls to the API.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_between_api_call</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time, in seconds, to sleep the
call to the API. Defaults to 0.5.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>normalization_sep</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Nested records will generate names
separated by sep. Defaults to ".".</p>
              </div>
            </td>
            <td>
                  <code>&#39;.&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="viadot.exceptions.APIError">APIError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Some or No reports were not created.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="viadot.exceptions.APIError">APIError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>At different endpoints:
- 'analytics/conversations/details/query': only one body must be used.
- 'routing_queues_members': extra parameter <code>queues_ids</code> must be
    included.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/genesys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">api_connection</span><span class="p">(</span>  <span class="c1"># noqa: PLR0912, PLR0915, C901.</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">queues_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">view_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">view_type_time_sleep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">post_data_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">time_between_api_call</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">normalization_sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;General method to connect to Genesys Cloud API and generate the response.</span>

<span class="sd">    Args:</span>
<span class="sd">        endpoint (Optional[str], optional): Final end point to the API.</span>
<span class="sd">            Defaults to None.</span>

<span class="sd">            Custom endpoints have specific key words, and parameters:</span>
<span class="sd">            Example:</span>
<span class="sd">                - &quot;routing/queues/{id}/members&quot;: &quot;routing_queues_members&quot;</span>
<span class="sd">                - members_ids = [&quot;xxxxxxxxx&quot;, &quot;xxxxxxxxx&quot;, ...]</span>
<span class="sd">        queues_ids (Optional[List[str]], optional): List of queues ids to consult</span>
<span class="sd">            the members. Defaults to None.</span>
<span class="sd">        view_type (Optional[str], optional): The type of view export job to be</span>
<span class="sd">            created. Defaults to None.</span>
<span class="sd">        view_type_time_sleep (int, optional): Waiting time to retrieve data from</span>
<span class="sd">            Genesys Cloud API. Defaults to 10.</span>
<span class="sd">        post_data_list (Optional[List[Dict[str, Any]]], optional): List of string</span>
<span class="sd">            templates to generate json body in POST calls to the API.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        time_between_api_call (int, optional): The time, in seconds, to sleep the</span>
<span class="sd">            call to the API. Defaults to 0.5.</span>
<span class="sd">        normalization_sep (str, optional): Nested records will generate names</span>
<span class="sd">            separated by sep. Defaults to &quot;.&quot;.</span>

<span class="sd">    Raises:</span>
<span class="sd">        APIError: Some or No reports were not created.</span>
<span class="sd">        APIError: At different endpoints:</span>
<span class="sd">            - &#39;analytics/conversations/details/query&#39;: only one body must be used.</span>
<span class="sd">            - &#39;routing_queues_members&#39;: extra parameter `queues_ids` must be</span>
<span class="sd">                included.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Connecting to the Genesys Cloud using the endpoint: </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;analytics/reporting/exports&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="n">post_data_list</span><span class="o">=</span><span class="n">post_data_list</span><span class="p">,</span>
            <span class="n">time_between_api_call</span><span class="o">=</span><span class="n">time_between_api_call</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Waiting </span><span class="si">{</span><span class="n">view_type_time_sleep</span><span class="si">}</span><span class="s2"> seconds for&quot;</span>
            <span class="o">+</span> <span class="s2">&quot; caching data from Genesys Cloud API.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">view_type_time_sleep</span><span class="p">)</span>

        <span class="n">request_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_reporting_exports</span><span class="p">()</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="n">request_json</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">ids</span><span class="p">,</span> <span class="n">urls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reporting_exports_url</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">post_data_list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span><span class="si">}</span><span class="s2"> available reports in Genesys, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;and where sent </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">post_data_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> reports. &quot;</span>
                    <span class="s2">&quot;Unsed reports will be removed.&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">APIError</span><span class="p">(</span>
                <span class="s2">&quot;There are no reports to be downloaded.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;May be </span><span class="si">{</span><span class="n">view_type_time_sleep</span><span class="si">}</span><span class="s2"> should be increased.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># download and delete reports created</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">raise_api_error</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">qid</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">urls</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">df_downloaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_report</span><span class="p">(</span><span class="n">report_url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="c1"># remove resume rows</span>
                <span class="k">if</span> <span class="n">view_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;queue_performance_detail_view&quot;</span><span class="p">]:</span>
                    <span class="n">criteria</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">df_downloaded</span><span class="p">[</span><span class="s2">&quot;Queue Id&quot;</span><span class="p">]</span>
                        <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">))</span>
                        <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">df_downloaded</span> <span class="o">=</span> <span class="n">df_downloaded</span><span class="p">[</span><span class="n">criteria</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">count</span><span class="p">:</span> <span class="n">df_downloaded</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Report id </span><span class="si">{</span><span class="n">qid</span><span class="si">}</span><span class="s2"> didn&#39;t have time to be created. &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;Consider increasing the `view_type_time_sleep` parameter &quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;&gt;&gt; </span><span class="si">{</span><span class="n">view_type_time_sleep</span><span class="si">}</span><span class="s2"> seconds to allow Genesys Cloud &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;to conclude the report creation.&quot;</span>
                <span class="p">)</span>
                <span class="n">raise_api_error</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_delete_report</span><span class="p">(</span><span class="n">qid</span><span class="p">)</span>

            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># noqa: SIM113</span>

        <span class="k">if</span> <span class="n">raise_api_error</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Some reports creation failed.&quot;</span>
            <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;analytics/conversations/details/query&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">post_data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Not available more than one body for this end-point.&quot;</span>
            <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">stop_loop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">page_counter</span> <span class="o">=</span> <span class="n">post_data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;paging&quot;</span><span class="p">][</span><span class="s2">&quot;pageNumber&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Restructuring the response in order to be able to insert it into a &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;data frame.</span><span class="se">\n\t</span><span class="s2">This task could take a few minutes.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">stop_loop</span><span class="p">:</span>
            <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
                <span class="n">post_data_list</span><span class="o">=</span><span class="n">post_data_list</span><span class="p">,</span>
                <span class="n">time_between_api_call</span><span class="o">=</span><span class="n">time_between_api_call</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">merged_data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_conversations</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;conversations&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">post_data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;paging&quot;</span><span class="p">][</span><span class="s2">&quot;pageNumber&quot;</span><span class="p">])</span>
                    <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">merged_data_frame</span>
                <span class="p">}</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">page_counter</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">max_calls</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;totalHits&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">page_counter</span> <span class="o">==</span> <span class="n">max_calls</span><span class="p">:</span>
                <span class="n">stop_loop</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">post_data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;paging&quot;</span><span class="p">][</span><span class="s2">&quot;pageNumber&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">page_counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">elif</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;routing/queues&quot;</span><span class="p">,</span> <span class="s2">&quot;users&quot;</span><span class="p">]:</span>
        <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Restructuring the response in order to be able to insert it into a &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;data frame.</span><span class="se">\n\t</span><span class="s2">This task could take a few minutes.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;routing/queues&quot;</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pageSize&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;pageNumber&quot;</span><span class="p">:</span> <span class="n">page</span><span class="p">}</span>
            <span class="k">elif</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;users&quot;</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;pageSize&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
                    <span class="s2">&quot;pageNumber&quot;</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span>
                    <span class="s2">&quot;expand&quot;</span><span class="p">:</span> <span class="s2">&quot;presence,dateLastLogin,groups&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;,employerInfo,lasttokenissued&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
                <span class="n">post_data_list</span><span class="o">=</span><span class="n">post_data_list</span><span class="p">,</span>
                <span class="n">time_between_api_call</span><span class="o">=</span><span class="n">time_between_api_call</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]:</span>
                <span class="n">df_response</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span>
                    <span class="n">response</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">],</span>
                    <span class="n">sep</span><span class="o">=</span><span class="n">normalization_sep</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">df_response</span><span class="p">})</span>

                <span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="k">elif</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;routing_queues_members&quot;</span><span class="p">:</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">queues_ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;This endpoint requires `queues_ids` parameter to work.&quot;</span>
            <span class="p">)</span>
            <span class="n">APIError</span><span class="p">(</span><span class="s2">&quot;This endpoint requires `queues_ids` parameter to work.&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">qid</span> <span class="ow">in</span> <span class="n">queues_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading Agents information from Queue: </span><span class="si">{</span><span class="n">qid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span>
                    <span class="n">endpoint</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;routing/queues/</span><span class="si">{</span><span class="n">qid</span><span class="si">}</span><span class="s2">/members&quot;</span><span class="p">,</span>
                    <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pageSize&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;pageNumber&quot;</span><span class="p">:</span> <span class="n">page</span><span class="p">},</span>
                    <span class="n">post_data_list</span><span class="o">=</span><span class="n">post_data_list</span><span class="p">,</span>
                    <span class="n">time_between_api_call</span><span class="o">=</span><span class="n">time_between_api_call</span><span class="p">,</span>
                    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]:</span>
                    <span class="n">df_response</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">])</span>
                    <span class="c1"># drop personal information</span>
                    <span class="n">columns_to_drop</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;user.addresses&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;user.primaryContactInfo&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;user.images&quot;</span><span class="p">,</span>
                    <span class="p">}</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">df_response</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                    <span class="n">df_response</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
                        <span class="n">columns_to_drop</span><span class="p">,</span>
                        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">counter</span><span class="p">:</span> <span class="n">df_response</span><span class="p">})</span>

                    <span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.genesys.Genesys.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a pandas DataFrame from self.data_returned.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>drop_duplicates</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Remove duplicates from the DataFrame.
Defaults to False.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>validate_df_dict</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with
optional list of tests to verify the output dataframe. Defaults to None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.Dataframe: The response data as a pandas DataFrame plus viadot metadata.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/genesys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_viadot_metadata_columns</span>
<span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a pandas DataFrame from self.data_returned.</span>

<span class="sd">    Args:</span>
<span class="sd">        drop_duplicates (bool, optional): Remove duplicates from the DataFrame.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">        validate_df_dict (Optional[Dict[str, Any]], optional): A dictionary with</span>
<span class="sd">            optional list of tests to verify the output dataframe. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.Dataframe: The response data as a pandas DataFrame plus viadot metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">drop_duplicates</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;drop_duplicates&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">validate_df_dict</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;validate_df_dict&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="p">[</span><span class="n">key</span><span class="p">]])</span>

    <span class="k">if</span> <span class="n">drop_duplicates</span><span class="p">:</span>
        <span class="n">data_frame</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">validate_df_dict</span><span class="p">:</span>
        <span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="n">validate_df_dict</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_returned</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span>
            <span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;The response does not contain any data.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data_frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data_frame</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.hubspot.Hubspot" class="doc doc-heading">
            <code>viadot.sources.hubspot.Hubspot</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>


        <p>A class that connects and extracts data from Hubspot API.</p>


<details class="documentation-is-available-here" open>
  <summary>Documentation is available here</summary>
  <p>https://developers.hubspot.com/docs/api/crm/understanding-the-crm.</p>
</details>

<details class="connector-allows-to-pull-data-in-two-ways" open>
  <summary>Connector allows to pull data in two ways</summary>
  <ul>
<li>using base API for crm schemas as an endpoint
    (eg. "contacts", ""line_items", "deals", ...),</li>
<li>using full url as endpoint.</li>
</ul>
</details>






              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/hubspot.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Hubspot</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class that connects and extracts data from Hubspot API.</span>

<span class="sd">    Documentation is available here:</span>
<span class="sd">        https://developers.hubspot.com/docs/api/crm/understanding-the-crm.</span>

<span class="sd">    Connector allows to pull data in two ways:</span>
<span class="sd">        - using base API for crm schemas as an endpoint</span>
<span class="sd">            (eg. &quot;contacts&quot;, &quot;&quot;line_items&quot;, &quot;deals&quot;, ...),</span>
<span class="sd">        - using full url as endpoint.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">API_URL</span> <span class="o">=</span> <span class="s2">&quot;https://api.hubapi.com&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">HubspotCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hubspot&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an instance of Hubspot.</span>

<span class="sd">        Args:</span>
<span class="sd">            credentials (Optional[HubspotCredentials], optional): Hubspot credentials.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">                credentials. Defaults to &quot;hubspot&quot;.</span>

<span class="sd">        Examples:</span>
<span class="sd">            hubspot = Hubspot(</span>
<span class="sd">                credentials=credentials,</span>
<span class="sd">                config_key=config_key,</span>
<span class="sd">            )</span>
<span class="sd">            hubspot.api_connection(</span>
<span class="sd">                endpoint=endpoint,</span>
<span class="sd">                filters=filters,</span>
<span class="sd">                properties=properties,</span>
<span class="sd">                nrows=nrows,</span>
<span class="sd">            )</span>
<span class="sd">            data_frame = hubspot.to_df()</span>

<span class="sd">        Raises:</span>
<span class="sd">            CredentialError: If credentials are not provided in local_config or</span>
<span class="sd">                directly as a parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
        <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">HubspotCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_date_to_unixtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert date from &quot;yyyy-mm-dd&quot; to Unix Timestamp.</span>

<span class="sd">        (SECONDS SINCE JAN 01 1970. (UTC)). For example:</span>
<span class="sd">                1680774921 SECONDS SINCE JAN 01 1970. (UTC) -&gt; 11:55:49 AM 2023-04-06.</span>

<span class="sd">        Args:</span>
<span class="sd">            date (Optional[str], optional): Input date in format &quot;yyyy-mm-dd&quot;.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Number of seconds that passed since 1970-01-01 until &quot;date&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timestamp</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_api_url</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates full url for Hubspot API given filters and parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (Optional[str], optional): API endpoint for an individual request.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            filters (Optional[Dict[str, Any]], optional): Filters defined for the API</span>
<span class="sd">                body in specific order. Defaults to None.</span>
<span class="sd">            properties (Optional[List[Any]], optional): List of user-defined columns to</span>
<span class="sd">                be pulled from the API. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The final URL API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">API_URL</span> <span class="ow">in</span> <span class="n">endpoint</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">endpoint</span>
        <span class="k">elif</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;hubdb&quot;</span><span class="p">):</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">API_URL</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filters</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">API_URL</span><span class="si">}</span><span class="s2">/crm/v3/objects/</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">/search/?limit=100&amp;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">API_URL</span><span class="si">}</span><span class="s2">/crm/v3/objects/</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">/?limit=100&amp;&quot;</span>

            <span class="k">if</span> <span class="n">properties</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;properties=</span><span class="si">{</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span><span class="si">}</span><span class="s1">&amp;&#39;</span>

        <span class="k">return</span> <span class="n">url</span>

    <span class="k">def</span> <span class="nf">_format_filters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;API body (filters) conversion from a user defined to API language.</span>

<span class="sd">        Note: Right now only converts date to Unix Timestamp.</span>

<span class="sd">        Args:</span>
<span class="sd">            filters (Optional[List[Dict[str, Any]]]): List of filters in JSON format.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[Dict[str, Any]]: List of cleaned filters in JSON format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subitem</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">subitem</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">lookup</span> <span class="o">=</span> <span class="n">subitem</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+-\d+-\d+&quot;</span><span class="p">,</span> <span class="n">lookup</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">regex</span><span class="p">:</span>
                        <span class="n">regex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_date_to_unixtimestamp</span><span class="p">(</span><span class="n">lookup</span><span class="p">)</span>
                        <span class="n">subitem</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">regex</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">filters</span>

    <span class="k">def</span> <span class="nf">_get_api_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean the filters body and converts to a JSON formatted value.</span>

<span class="sd">        Args:</span>
<span class="sd">            filters (List[Dict[str, Any]]): Filters dictionary that will be passed to</span>
<span class="sd">                Hubspot API. Defaults to {}.</span>

<span class="sd">        Example:</span>
<span class="sd">                    filters = {</span>
<span class="sd">                                &quot;filters&quot;: [</span>
<span class="sd">                                    {</span>
<span class="sd">                                    &quot;propertyName&quot;: &quot;createdate&quot;,</span>
<span class="sd">                                    &quot;operator&quot;: &quot;BETWEEN&quot;,</span>
<span class="sd">                                    &quot;highValue&quot;: &quot;2023-03-27&quot;,</span>
<span class="sd">                                    &quot;value&quot;: &quot;2023-03-26&quot;</span>
<span class="sd">                                    }</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                Operators between the min and max value are listed below:</span>
<span class="sd">                [IN, NOT_HAS_PROPERTY, LT, EQ, GT, NOT_IN, GTE, CONTAINS_TOKEN,</span>
<span class="sd">                    HAS_PROPERTY, LTE, NOT_CONTAINS_TOKEN, BETWEEN, NEQ]</span>
<span class="sd">                LT - Less than</span>
<span class="sd">                LTE - Less than or equal to</span>
<span class="sd">                GT - Greater than</span>
<span class="sd">                GTE - Greater than or equal to</span>
<span class="sd">                EQ - Equal to</span>
<span class="sd">                NEQ - Not equal to</span>
<span class="sd">                BETWEEN - Within the specified range. In your request, use key-value</span>
<span class="sd">                    pairs to set highValue and value. Refer to the example above.</span>
<span class="sd">                IN - Included within the specified list. This operator is</span>
<span class="sd">                    case-sensitive, so inputted values must be in lowercase.</span>
<span class="sd">                NOT_IN - Not included within the specified list</span>
<span class="sd">                HAS_PROPERTY - Has a value for the specified property</span>
<span class="sd">                NOT_HAS_PROPERTY - Doesn&#39;t have a value for the specified property</span>
<span class="sd">                CONTAINS_TOKEN - Contains a token. In your request, you can use</span>
<span class="sd">                    wildcards (*) to complete a partial search. For example, use the</span>
<span class="sd">                    value *@hubspot.com to retrieve contacts with a HubSpot email</span>
<span class="sd">                    address.</span>
<span class="sd">                NOT_CONTAINS_TOKEN  -Doesn&#39;t contain a token</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict: Filters with a JSON format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;filterGroups&quot;</span><span class="p">:</span> <span class="n">filters</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">_api_call</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">body</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;General method to connect to Hubspot API and generate the response.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (Optional[str], optional): Hubspot API url. Defaults to None.</span>
<span class="sd">            body (Optional[str], optional): Filters that will be pushed to the API body.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            method (Optional[str], optional): Method of the API call. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            APIError: When the `status_code` is different to 200.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict: API response in JSON format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;token&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span>
        <span class="p">)</span>

        <span class="n">response_ok</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">response_ok</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load response content. - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed to load all exports.&quot;</span>
        <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_offset_from_response</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">api_response</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign offset type/value depending on keys in API response.</span>

<span class="sd">        Args:</span>
<span class="sd">            api_response (Dict[str, Any]): API response in JSON format.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: Tuple in order: (offset_type, offset_value)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;paging&quot;</span> <span class="ow">in</span> <span class="n">api_response</span><span class="p">:</span>
            <span class="n">offset_type</span> <span class="o">=</span> <span class="s2">&quot;after&quot;</span>
            <span class="n">offset_value</span> <span class="o">=</span> <span class="n">api_response</span><span class="p">[</span><span class="s2">&quot;paging&quot;</span><span class="p">][</span><span class="s2">&quot;next&quot;</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">offset_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="k">elif</span> <span class="s2">&quot;offset&quot;</span> <span class="ow">in</span> <span class="n">api_response</span><span class="p">:</span>
            <span class="n">offset_type</span> <span class="o">=</span> <span class="s2">&quot;offset&quot;</span>
            <span class="n">offset_value</span> <span class="o">=</span> <span class="n">api_response</span><span class="p">[</span><span class="s2">&quot;offset&quot;</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset_type</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">offset_value</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">offset_type</span><span class="p">,</span> <span class="n">offset_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">api_connection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nrows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;General method to connect to Hubspot API and generate the response.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (Optional[str], optional): API endpoint for an individual request.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            filters (Optional[List[Dict[str, Any]]], optional): Filters defined for the</span>
<span class="sd">                API body in specific order. Defaults to None.</span>

<span class="sd">        Example:</span>
<span class="sd">                    filters=[</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;filters&quot;: [</span>
<span class="sd">                                {</span>
<span class="sd">                                    &quot;propertyName&quot;: &quot;createdate&quot;,</span>
<span class="sd">                                    &quot;operator&quot;: &quot;BETWEEN&quot;,</span>
<span class="sd">                                    &quot;highValue&quot;: &quot;1642636800000&quot;,</span>
<span class="sd">                                    &quot;value&quot;: &quot;1641995200000&quot;,</span>
<span class="sd">                                },</span>
<span class="sd">                                {</span>
<span class="sd">                                    &quot;propertyName&quot;: &quot;email&quot;,</span>
<span class="sd">                                    &quot;operator&quot;: &quot;CONTAINS_TOKEN&quot;,</span>
<span class="sd">                                    &quot;value&quot;: &quot;*@xxxx.xx&quot;,</span>
<span class="sd">                                },</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    ],</span>
<span class="sd">            properties (Optional[List[Any]], optional): List of user-defined columns to</span>
<span class="sd">                be pulled from the API. Defaults to None.</span>
<span class="sd">            nrows (int, optional): Max number of rows to pull during execution.</span>
<span class="sd">                Defaults to 1000.</span>

<span class="sd">        Raises:</span>
<span class="sd">            APIError: Failed to download data from the endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_api_url</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">filters</span><span class="p">:</span>
            <span class="n">filters_formatted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
            <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_api_body</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">filters_formatted</span><span class="p">)</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;POST&quot;</span>
            <span class="n">partition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span> <span class="o">=</span> <span class="n">partition</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span>

            <span class="k">while</span> <span class="s2">&quot;paging&quot;</span> <span class="ow">in</span> <span class="n">partition</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nrows</span><span class="p">:</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_api_body</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">filters_formatted</span><span class="p">))</span>
                <span class="n">body</span><span class="p">[</span><span class="s2">&quot;after&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">partition</span><span class="p">[</span><span class="s2">&quot;paging&quot;</span><span class="p">][</span><span class="s2">&quot;next&quot;</span><span class="p">][</span><span class="s2">&quot;after&quot;</span><span class="p">]</span>
                <span class="n">partition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">partition</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;GET&quot;</span>
            <span class="n">partition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span> <span class="o">=</span> <span class="n">partition</span><span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">partition</span><span class="o">.</span><span class="n">keys</span><span class="p">()))]</span>

            <span class="n">offset_type</span><span class="p">,</span> <span class="n">offset_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_offset_from_response</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span>

            <span class="k">while</span> <span class="n">offset_value</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nrows</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_api_url</span><span class="p">(</span>
                    <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
                    <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                    <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">offset_type</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">offset_value</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="n">partition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">partition</span><span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">partition</span><span class="o">.</span><span class="n">keys</span><span class="p">()))])</span>

                <span class="n">offset_type</span><span class="p">,</span> <span class="n">offset_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_offset_from_response</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span>

    <span class="nd">@add_viadot_metadata_columns</span>
    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a pandas DataFrame with the data in the Response and metadata.</span>

<span class="sd">        Args:</span>
<span class="sd">            if_empty (str, optional): What to do if a fetch produce no data.</span>
<span class="sd">                Defaults to &quot;warn</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.Dataframe: The response data as a pandas DataFrame plus viadot metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">)</span>

        <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span>
                <span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;The response does not contain any data.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully downloaded data from the Mindful API.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_frame</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.hubspot.Hubspot.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_key</span><span class="o">=</span><span class="s1">&#39;hubspot&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create an instance of Hubspot.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>credentials</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="viadot.sources.hubspot.HubspotCredentials">HubspotCredentials</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hubspot credentials.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key in the viadot config holding relevant
credentials. Defaults to "hubspot".</p>
              </div>
            </td>
            <td>
                  <code>&#39;hubspot&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>hubspot = Hubspot(
    credentials=credentials,
    config_key=config_key,
)
hubspot.api_connection(
    endpoint=endpoint,
    filters=filters,
    properties=properties,
    nrows=nrows,
)
data_frame = hubspot.to_df()</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="CredentialError">CredentialError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If credentials are not provided in local_config or
directly as a parameter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/hubspot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="n">HubspotCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hubspot&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an instance of Hubspot.</span>

<span class="sd">    Args:</span>
<span class="sd">        credentials (Optional[HubspotCredentials], optional): Hubspot credentials.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">            credentials. Defaults to &quot;hubspot&quot;.</span>

<span class="sd">    Examples:</span>
<span class="sd">        hubspot = Hubspot(</span>
<span class="sd">            credentials=credentials,</span>
<span class="sd">            config_key=config_key,</span>
<span class="sd">        )</span>
<span class="sd">        hubspot.api_connection(</span>
<span class="sd">            endpoint=endpoint,</span>
<span class="sd">            filters=filters,</span>
<span class="sd">            properties=properties,</span>
<span class="sd">            nrows=nrows,</span>
<span class="sd">        )</span>
<span class="sd">        data_frame = hubspot.to_df()</span>

<span class="sd">    Raises:</span>
<span class="sd">        CredentialError: If credentials are not provided in local_config or</span>
<span class="sd">            directly as a parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
    <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">HubspotCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.hubspot.Hubspot.api_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">api_connection</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>General method to connect to Hubspot API and generate the response.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>endpoint</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>API endpoint for an individual request.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filters</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="List">List</span>[<span title="Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filters defined for the
API body in specific order. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>filters=[
    {
        "filters": [
            {
                "propertyName": "createdate",
                "operator": "BETWEEN",
                "highValue": "1642636800000",
                "value": "1641995200000",
            },
            {
                "propertyName": "email",
                "operator": "CONTAINS_TOKEN",
                "value": "*@xxxx.xx",
            },
        ]
    }
],</p>
</details>        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>properties (Optional[List[Any]], optional): List of user-defined columns to
    be pulled from the API. Defaults to None.
nrows (int, optional): Max number of rows to pull during execution.
    Defaults to 1000.
</code></pre></div></td></tr></table></div>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="viadot.exceptions.APIError">APIError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Failed to download data from the endpoint.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/hubspot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">api_connection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">properties</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nrows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;General method to connect to Hubspot API and generate the response.</span>

<span class="sd">    Args:</span>
<span class="sd">        endpoint (Optional[str], optional): API endpoint for an individual request.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        filters (Optional[List[Dict[str, Any]]], optional): Filters defined for the</span>
<span class="sd">            API body in specific order. Defaults to None.</span>

<span class="sd">    Example:</span>
<span class="sd">                filters=[</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;filters&quot;: [</span>
<span class="sd">                            {</span>
<span class="sd">                                &quot;propertyName&quot;: &quot;createdate&quot;,</span>
<span class="sd">                                &quot;operator&quot;: &quot;BETWEEN&quot;,</span>
<span class="sd">                                &quot;highValue&quot;: &quot;1642636800000&quot;,</span>
<span class="sd">                                &quot;value&quot;: &quot;1641995200000&quot;,</span>
<span class="sd">                            },</span>
<span class="sd">                            {</span>
<span class="sd">                                &quot;propertyName&quot;: &quot;email&quot;,</span>
<span class="sd">                                &quot;operator&quot;: &quot;CONTAINS_TOKEN&quot;,</span>
<span class="sd">                                &quot;value&quot;: &quot;*@xxxx.xx&quot;,</span>
<span class="sd">                            },</span>
<span class="sd">                        ]</span>
<span class="sd">                    }</span>
<span class="sd">                ],</span>
<span class="sd">        properties (Optional[List[Any]], optional): List of user-defined columns to</span>
<span class="sd">            be pulled from the API. Defaults to None.</span>
<span class="sd">        nrows (int, optional): Max number of rows to pull during execution.</span>
<span class="sd">            Defaults to 1000.</span>

<span class="sd">    Raises:</span>
<span class="sd">        APIError: Failed to download data from the endpoint.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_api_url</span><span class="p">(</span>
        <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
        <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
        <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">filters</span><span class="p">:</span>
        <span class="n">filters_formatted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_api_body</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">filters_formatted</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;POST&quot;</span>
        <span class="n">partition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span> <span class="o">=</span> <span class="n">partition</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span>

        <span class="k">while</span> <span class="s2">&quot;paging&quot;</span> <span class="ow">in</span> <span class="n">partition</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nrows</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_api_body</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">filters_formatted</span><span class="p">))</span>
            <span class="n">body</span><span class="p">[</span><span class="s2">&quot;after&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">partition</span><span class="p">[</span><span class="s2">&quot;paging&quot;</span><span class="p">][</span><span class="s2">&quot;next&quot;</span><span class="p">][</span><span class="s2">&quot;after&quot;</span><span class="p">]</span>
            <span class="n">partition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">partition</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;GET&quot;</span>
        <span class="n">partition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span> <span class="o">=</span> <span class="n">partition</span><span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">partition</span><span class="o">.</span><span class="n">keys</span><span class="p">()))]</span>

        <span class="n">offset_type</span><span class="p">,</span> <span class="n">offset_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_offset_from_response</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">offset_value</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nrows</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_api_url</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
                <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">offset_type</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">offset_value</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">partition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_call</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">partition</span><span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">partition</span><span class="o">.</span><span class="n">keys</span><span class="p">()))])</span>

            <span class="n">offset_type</span><span class="p">,</span> <span class="n">offset_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_offset_from_response</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.hubspot.Hubspot.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a pandas DataFrame with the data in the Response and metadata.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>if_empty</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What to do if a fetch produce no data.
Defaults to "warn</p>
              </div>
            </td>
            <td>
                  <code>&#39;warn&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.Dataframe: The response data as a pandas DataFrame plus viadot metadata.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/hubspot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_viadot_metadata_columns</span>
<span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a pandas DataFrame with the data in the Response and metadata.</span>

<span class="sd">    Args:</span>
<span class="sd">        if_empty (str, optional): What to do if a fetch produce no data.</span>
<span class="sd">            Defaults to &quot;warn</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.Dataframe: The response data as a pandas DataFrame plus viadot metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">)</span>

    <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dataset</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span>
            <span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;The response does not contain any data.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully downloaded data from the Mindful API.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data_frame</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.mediatool.Mediatool" class="doc doc-heading">
            <code>viadot.sources.mediatool.Mediatool</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>


        <p>Class implementing the Mediatool API.</p>
<p>Download data from Mediatool platform. Using Mediatool class user is able to
download organizations, media entries, campaigns, vehicles, and media types data.</p>







              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/mediatool.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Mediatool</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class implementing the Mediatool API.</span>

<span class="sd">    Download data from Mediatool platform. Using Mediatool class user is able to</span>
<span class="sd">    download organizations, media entries, campaigns, vehicles, and media types data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">MediatoolCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an instance of the Mediatool class.</span>

<span class="sd">        Args:</span>
<span class="sd">            credentials (MediatoolCredentials, optional): Meditaool credentials.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">                credentials. Defaults to None.</span>
<span class="sd">            user_id (str, optional): User ID. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">credentials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Missing credentials.&quot;</span>
            <span class="k">raise</span> <span class="n">CredentialError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">MediatoolCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">credentials</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span> <span class="ow">or</span> <span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_organizations</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get organizations data based on the user ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_id (str, optional): User ID. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, str]]: A list of dicts will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
        <span class="n">url_organizations</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.mediatool.com/users/</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">/organizations&quot;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_organizations</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">organizations</span> <span class="o">=</span> <span class="n">response_dict</span><span class="p">[</span><span class="s2">&quot;organizations&quot;</span><span class="p">]</span>

        <span class="n">list_organizations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">org</span> <span class="ow">in</span> <span class="n">organizations</span><span class="p">:</span>
            <span class="n">list_organizations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">org</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_id&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">org</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;abbreviation&quot;</span><span class="p">:</span> <span class="n">org</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;abbreviation&quot;</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">list_organizations</span>

    <span class="k">def</span> <span class="nf">_get_media_entries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">organization_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Data for media entries.</span>

<span class="sd">        Args:</span>
<span class="sd">            organization_id (str): Organization ID.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, str]]: A list of dicts will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;https://api.mediatool.com/searchmediaentries?q=&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">{{</span><span class="s1">&quot;organizationId&quot;: &quot;</span><span class="si">{</span><span class="n">organization_id</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">}}</span><span class="s1">&#39;</span>
        <span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response_dict</span><span class="p">[</span><span class="s2">&quot;mediaEntries&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_vehicles</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">vehicle_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Vehicles data based on the organization IDs.</span>

<span class="sd">        Args:</span>
<span class="sd">            vehicle_ids (list[str]): List of organization IDs.</span>

<span class="sd">        Raises:</span>
<span class="sd">            APIError: Mediatool API does not recognise the vehicle id.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, str]]: A list of dicts will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">missing_vehicles</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">vid</span> <span class="ow">in</span> <span class="n">vehicle_ids</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.mediatool.com/vehicles/</span><span class="si">{</span><span class="n">vid</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">,</span>
                    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">APIError</span><span class="p">:</span>
                <span class="n">missing_vehicles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vid</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">response_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="n">response_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response_dict</span><span class="p">[</span><span class="s2">&quot;vehicle&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">missing_vehicles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vehicle were not found for: </span><span class="si">{</span><span class="n">missing_vehicles</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response_list</span>

    <span class="k">def</span> <span class="nf">_get_campaigns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">organization_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Campaign data based on the organization ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            organization_id (str): Organization ID.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, str]]: A list of dicts will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_campaigns</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;https://api.mediatool.com/organizations/</span><span class="si">{</span><span class="n">organization_id</span><span class="si">}</span><span class="s2">/campaigns&quot;</span>
        <span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_campaigns</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response_dict</span><span class="p">[</span><span class="s2">&quot;campaigns&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_media_types</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">media_type_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Media types data based on the media types ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            media_type_ids (list[str]): List of media type IDs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, str]]: A list of dicts will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_media_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">id_media_type</span> <span class="ow">in</span> <span class="n">media_type_ids</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.mediatool.com/mediatypes/</span><span class="si">{</span><span class="n">id_media_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">response_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">list_media_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mediaType&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_id&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mediaType&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mediaType&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">list_media_types</span>

    <span class="k">def</span> <span class="nf">_to_records</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
            <span class="s2">&quot;organizations&quot;</span><span class="p">,</span> <span class="s2">&quot;media_entries&quot;</span><span class="p">,</span> <span class="s2">&quot;vehicles&quot;</span><span class="p">,</span> <span class="s2">&quot;campaigns&quot;</span><span class="p">,</span> <span class="s2">&quot;media_types&quot;</span>
        <span class="p">],</span>
        <span class="n">organization_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">vehicle_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">media_type_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Connects to the Mediatool API and retrieves data for the specified endpoint.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (Literal[&quot;organizations&quot;, &quot;media_entries&quot;, &quot;vehicles&quot;, &quot;campaigns&quot;,</span>
<span class="sd">                &quot;media_types&quot;]): The API endpoint to fetch data from.</span>
<span class="sd">            organization_id (str, optional): Organization ID. Defaults to None.</span>
<span class="sd">            vehicle_ids (list[str]): List of organization IDs. Defaults to None.</span>
<span class="sd">            media_type_ids (list[str]): List of media type IDs. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, str]]: A list of records containing the retrieved data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;organizations&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_organizations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;media_entries&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_media_entries</span><span class="p">(</span><span class="n">organization_id</span><span class="o">=</span><span class="n">organization_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;vehicles&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_vehicles</span><span class="p">(</span><span class="n">vehicle_ids</span><span class="o">=</span><span class="n">vehicle_ids</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;campaigns&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_campaigns</span><span class="p">(</span><span class="n">organization_id</span><span class="o">=</span><span class="n">organization_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;media_types&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_media_types</span><span class="p">(</span><span class="n">media_type_ids</span><span class="o">=</span><span class="n">media_type_ids</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">fetch_and_transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
            <span class="s2">&quot;organizations&quot;</span><span class="p">,</span> <span class="s2">&quot;media_entries&quot;</span><span class="p">,</span> <span class="s2">&quot;vehicles&quot;</span><span class="p">,</span> <span class="s2">&quot;campaigns&quot;</span><span class="p">,</span> <span class="s2">&quot;media_types&quot;</span>
        <span class="p">],</span>
        <span class="n">organization_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">vehicle_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">media_type_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
        <span class="n">add_endpoint_suffix</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pandas Data Frame with the data in the Response object and metadata.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (Literal[&quot;organizations&quot;, &quot;media_entries&quot;, &quot;vehicles&quot;, &quot;campaigns&quot;,</span>
<span class="sd">                &quot;media_types&quot;]): The API endpoint to fetch data from.</span>
<span class="sd">            organization_id (str, optional): Organization ID. Defaults to None.</span>
<span class="sd">            vehicle_ids (list[str]): List of organization IDs. Defaults to None.</span>
<span class="sd">            media_type_ids (list[str]): List of media type IDs. Defaults to None.</span>
<span class="sd">            columns (list[str], optional): If provided, a list of column names to</span>
<span class="sd">                include in the DataFrame.By default, all columns will be included.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            if_empty (str, optional): What to do if a fetch produce no data.</span>
<span class="sd">                Defaults to &quot;warn</span>
<span class="sd">            add_endpoint_suffix (bool, optional): If True, appends the endpoint name</span>
<span class="sd">                to column names in the format {column_name}_{endpoint} to ensure</span>
<span class="sd">                uniqueness in combined DataFrame from multiple endpoints.</span>
<span class="sd">                Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.Dataframe: The response data as a Pandas Data Frame plus viadot metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_records</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="p">,</span> <span class="n">organization_id</span><span class="p">,</span> <span class="n">vehicle_ids</span><span class="p">,</span> <span class="n">media_type_ids</span>
        <span class="p">)</span>

        <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;campaigns&quot;</span><span class="p">:</span>
            <span class="n">data_frame</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="n">to_replace</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">t|</span><span class="se">\\</span><span class="s2">n|</span><span class="se">\\</span><span class="s2">r&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">|</span><span class="se">\n</span><span class="s2">|</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">],</span>
                <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
                <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">add_endpoint_suffix</span><span class="p">:</span>
            <span class="n">data_frame</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                    <span class="n">column_name</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
                <span class="n">data_frame</span> <span class="o">=</span> <span class="n">data_frame</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Columns &#39;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; are incorrect. &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;Whole dictionary for &#39;mediaEntries&#39; will be returned.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span>
                <span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;The response does not contain any data.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Successfully downloaded data from &quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;the Mediatool API (</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">).&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">data_frame</span>

    <span class="nd">@add_viadot_metadata_columns</span>
    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">organization_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">media_entries_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">if_empty</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;warn&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetches, transforms, and combines data from Mediatool API endpoints.</span>

<span class="sd">        Args:</span>
<span class="sd">            organization_ids (list[str]): List of organization IDs.</span>
<span class="sd">            media_entries_columns (list[str], optional): Columns to get from media</span>
<span class="sd">                entries. Defaults to None.</span>
<span class="sd">            if_empty (Literal[warn, skip, fail], optional): What to do if there is no</span>
<span class="sd">                data. Defaults to &quot;warn&quot;.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Raised when no organizations are defined or an organization ID</span>
<span class="sd">            is not found in the organizations list.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: DataFrame containing the combined data from the specified</span>
<span class="sd">            endpoints.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">organization_ids</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&#39;organization_ids&#39; must be a non-empty list.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="c1"># first method ORGANIZATIONS</span>
        <span class="n">df_organizations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_and_transform</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;organizations&quot;</span><span class="p">)</span>

        <span class="n">list_of_organizations_df</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">organization_id</span> <span class="ow">in</span> <span class="n">organization_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">organization_id</span> <span class="ow">in</span> <span class="n">df_organizations</span><span class="p">[</span><span class="s2">&quot;_id_organizations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading data for: </span><span class="si">{</span><span class="n">organization_id</span><span class="si">}</span><span class="s2"> ...&quot;</span><span class="p">)</span>

                <span class="c1"># extract media entries per organization</span>
                <span class="n">df_media_entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_and_transform</span><span class="p">(</span>
                    <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;media_entries&quot;</span><span class="p">,</span>
                    <span class="n">organization_id</span><span class="o">=</span><span class="n">organization_id</span><span class="p">,</span>
                    <span class="n">columns</span><span class="o">=</span><span class="n">media_entries_columns</span><span class="p">,</span>
                    <span class="n">add_endpoint_suffix</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">unique_vehicle_ids</span> <span class="o">=</span> <span class="n">df_media_entries</span><span class="p">[</span><span class="s2">&quot;vehicleId&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                <span class="n">unique_media_type_ids</span> <span class="o">=</span> <span class="n">df_media_entries</span><span class="p">[</span><span class="s2">&quot;mediaTypeId&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

                <span class="c1"># extract vehicles</span>
                <span class="n">df_vehicles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_and_transform</span><span class="p">(</span>
                    <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;vehicles&quot;</span><span class="p">,</span> <span class="n">vehicle_ids</span><span class="o">=</span><span class="n">unique_vehicle_ids</span>
                <span class="p">)</span>

                <span class="c1"># extract campaigns</span>
                <span class="n">df_campaigns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_and_transform</span><span class="p">(</span>
                    <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;campaigns&quot;</span><span class="p">,</span>
                    <span class="n">organization_id</span><span class="o">=</span><span class="n">organization_id</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># extract media types</span>
                <span class="n">df_media_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_and_transform</span><span class="p">(</span>
                    <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;media_types&quot;</span><span class="p">,</span>
                    <span class="n">media_type_ids</span><span class="o">=</span><span class="n">unique_media_type_ids</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># join media entries &amp; organizations</span>
                <span class="n">df_merged_entries_orgs</span> <span class="o">=</span> <span class="n">join_dfs</span><span class="p">(</span>
                    <span class="n">df_left</span><span class="o">=</span><span class="n">df_media_entries</span><span class="p">,</span>
                    <span class="n">df_right</span><span class="o">=</span><span class="n">df_organizations</span><span class="p">,</span>
                    <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;organizationId&quot;</span><span class="p">,</span>
                    <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;_id_organizations&quot;</span><span class="p">,</span>
                    <span class="n">columns_from_right_df</span><span class="o">=</span><span class="p">[</span>
                        <span class="s2">&quot;_id_organizations&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;name_organizations&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;abbreviation_organizations&quot;</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># join the previous merge &amp; campaigns</span>
                <span class="n">df_merged_campaigns</span> <span class="o">=</span> <span class="n">join_dfs</span><span class="p">(</span>
                    <span class="n">df_left</span><span class="o">=</span><span class="n">df_merged_entries_orgs</span><span class="p">,</span>
                    <span class="n">df_right</span><span class="o">=</span><span class="n">df_campaigns</span><span class="p">,</span>
                    <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;campaignId&quot;</span><span class="p">,</span>
                    <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;_id_campaigns&quot;</span><span class="p">,</span>
                    <span class="n">columns_from_right_df</span><span class="o">=</span><span class="p">[</span>
                        <span class="s2">&quot;_id_campaigns&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;name_campaigns&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;conventionalName_campaigns&quot;</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># join the previous merge &amp; vehicles</span>
                <span class="n">df_merged_vehicles</span> <span class="o">=</span> <span class="n">join_dfs</span><span class="p">(</span>
                    <span class="n">df_left</span><span class="o">=</span><span class="n">df_merged_campaigns</span><span class="p">,</span>
                    <span class="n">df_right</span><span class="o">=</span><span class="n">df_vehicles</span><span class="p">,</span>
                    <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;vehicleId&quot;</span><span class="p">,</span>
                    <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;_id_vehicles&quot;</span><span class="p">,</span>
                    <span class="n">columns_from_right_df</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_id_vehicles&quot;</span><span class="p">,</span> <span class="s2">&quot;name_vehicles&quot;</span><span class="p">],</span>
                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># join the previous merge &amp; media types</span>
                <span class="n">df_merged_media_types</span> <span class="o">=</span> <span class="n">join_dfs</span><span class="p">(</span>
                    <span class="n">df_left</span><span class="o">=</span><span class="n">df_merged_vehicles</span><span class="p">,</span>
                    <span class="n">df_right</span><span class="o">=</span><span class="n">df_media_types</span><span class="p">,</span>
                    <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;mediaTypeId&quot;</span><span class="p">,</span>
                    <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;_id_media_types&quot;</span><span class="p">,</span>
                    <span class="n">columns_from_right_df</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_id_media_types&quot;</span><span class="p">,</span> <span class="s2">&quot;name_media_types&quot;</span><span class="p">],</span>
                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">list_of_organizations_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_merged_media_types</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Organization - </span><span class="si">{</span><span class="n">organization_id</span><span class="si">}</span><span class="s2"> not found in organizations list.&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="n">df_final</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_organizations_df</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df_final</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span><span class="n">if_empty</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df_final</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.mediatool.Mediatool.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create an instance of the Mediatool class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>credentials</code>
            </td>
            <td>
                  <code><span title="viadot.sources.mediatool.MediatoolCredentials">MediatoolCredentials</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Meditaool credentials.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key in the viadot config holding relevant
credentials. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/mediatool.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="n">MediatoolCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an instance of the Mediatool class.</span>

<span class="sd">    Args:</span>
<span class="sd">        credentials (MediatoolCredentials, optional): Meditaool credentials.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">            credentials. Defaults to None.</span>
<span class="sd">        user_id (str, optional): User ID. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">credentials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Missing credentials.&quot;</span>
        <span class="k">raise</span> <span class="n">CredentialError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">MediatoolCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">credentials</span><span class="p">))</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span> <span class="ow">or</span> <span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.mediatool.Mediatool.fetch_and_transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fetch_and_transform</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">organization_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vehicle_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">media_type_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">if_empty</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="n">add_endpoint_suffix</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pandas Data Frame with the data in the Response object and metadata.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>organization_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Organization ID. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vehicle_ids</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of organization IDs. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>media_type_ids</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of media type IDs. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>columns</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If provided, a list of column names to
include in the DataFrame.By default, all columns will be included.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>if_empty</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What to do if a fetch produce no data.
Defaults to "warn</p>
              </div>
            </td>
            <td>
                  <code>&#39;warn&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>add_endpoint_suffix</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, appends the endpoint name
to column names in the format {column_name}_{endpoint} to ensure
uniqueness in combined DataFrame from multiple endpoints.
Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.Dataframe: The response data as a Pandas Data Frame plus viadot metadata.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/mediatool.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fetch_and_transform</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
        <span class="s2">&quot;organizations&quot;</span><span class="p">,</span> <span class="s2">&quot;media_entries&quot;</span><span class="p">,</span> <span class="s2">&quot;vehicles&quot;</span><span class="p">,</span> <span class="s2">&quot;campaigns&quot;</span><span class="p">,</span> <span class="s2">&quot;media_types&quot;</span>
    <span class="p">],</span>
    <span class="n">organization_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vehicle_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">media_type_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
    <span class="n">add_endpoint_suffix</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pandas Data Frame with the data in the Response object and metadata.</span>

<span class="sd">    Args:</span>
<span class="sd">        endpoint (Literal[&quot;organizations&quot;, &quot;media_entries&quot;, &quot;vehicles&quot;, &quot;campaigns&quot;,</span>
<span class="sd">            &quot;media_types&quot;]): The API endpoint to fetch data from.</span>
<span class="sd">        organization_id (str, optional): Organization ID. Defaults to None.</span>
<span class="sd">        vehicle_ids (list[str]): List of organization IDs. Defaults to None.</span>
<span class="sd">        media_type_ids (list[str]): List of media type IDs. Defaults to None.</span>
<span class="sd">        columns (list[str], optional): If provided, a list of column names to</span>
<span class="sd">            include in the DataFrame.By default, all columns will be included.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        if_empty (str, optional): What to do if a fetch produce no data.</span>
<span class="sd">            Defaults to &quot;warn</span>
<span class="sd">        add_endpoint_suffix (bool, optional): If True, appends the endpoint name</span>
<span class="sd">            to column names in the format {column_name}_{endpoint} to ensure</span>
<span class="sd">            uniqueness in combined DataFrame from multiple endpoints.</span>
<span class="sd">            Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.Dataframe: The response data as a Pandas Data Frame plus viadot metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_records</span><span class="p">(</span>
        <span class="n">endpoint</span><span class="p">,</span> <span class="n">organization_id</span><span class="p">,</span> <span class="n">vehicle_ids</span><span class="p">,</span> <span class="n">media_type_ids</span>
    <span class="p">)</span>

    <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;campaigns&quot;</span><span class="p">:</span>
        <span class="n">data_frame</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">to_replace</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">t|</span><span class="se">\\</span><span class="s2">n|</span><span class="se">\\</span><span class="s2">r&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">|</span><span class="se">\n</span><span class="s2">|</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">],</span>
            <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
            <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">add_endpoint_suffix</span><span class="p">:</span>
        <span class="n">data_frame</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                <span class="n">column_name</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
            <span class="n">data_frame</span> <span class="o">=</span> <span class="n">data_frame</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Columns &#39;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; are incorrect. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;Whole dictionary for &#39;mediaEntries&#39; will be returned.&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span>
            <span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;The response does not contain any data.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Successfully downloaded data from &quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;the Mediatool API (</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">).&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">data_frame</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.mediatool.Mediatool.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">organization_ids</span><span class="p">,</span> <span class="n">media_entries_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">if_empty</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fetches, transforms, and combines data from Mediatool API endpoints.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>organization_ids</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of organization IDs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>media_entries_columns</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Columns to get from media
entries. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>if_empty</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[<span title="warn">warn</span>, <span title="skip">skip</span>, <span title="fail">fail</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What to do if there is no
data. Defaults to "warn".</p>
              </div>
            </td>
            <td>
                  <code>&#39;warn&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raised when no organizations are defined or an organization ID</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: DataFrame containing the combined data from the specified</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>endpoints.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/mediatool.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_viadot_metadata_columns</span>
<span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">organization_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">media_entries_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">if_empty</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;warn&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetches, transforms, and combines data from Mediatool API endpoints.</span>

<span class="sd">    Args:</span>
<span class="sd">        organization_ids (list[str]): List of organization IDs.</span>
<span class="sd">        media_entries_columns (list[str], optional): Columns to get from media</span>
<span class="sd">            entries. Defaults to None.</span>
<span class="sd">        if_empty (Literal[warn, skip, fail], optional): What to do if there is no</span>
<span class="sd">            data. Defaults to &quot;warn&quot;.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Raised when no organizations are defined or an organization ID</span>
<span class="sd">        is not found in the organizations list.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: DataFrame containing the combined data from the specified</span>
<span class="sd">        endpoints.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">organization_ids</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&#39;organization_ids&#39; must be a non-empty list.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="c1"># first method ORGANIZATIONS</span>
    <span class="n">df_organizations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_and_transform</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;organizations&quot;</span><span class="p">)</span>

    <span class="n">list_of_organizations_df</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">organization_id</span> <span class="ow">in</span> <span class="n">organization_ids</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">organization_id</span> <span class="ow">in</span> <span class="n">df_organizations</span><span class="p">[</span><span class="s2">&quot;_id_organizations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading data for: </span><span class="si">{</span><span class="n">organization_id</span><span class="si">}</span><span class="s2"> ...&quot;</span><span class="p">)</span>

            <span class="c1"># extract media entries per organization</span>
            <span class="n">df_media_entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_and_transform</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;media_entries&quot;</span><span class="p">,</span>
                <span class="n">organization_id</span><span class="o">=</span><span class="n">organization_id</span><span class="p">,</span>
                <span class="n">columns</span><span class="o">=</span><span class="n">media_entries_columns</span><span class="p">,</span>
                <span class="n">add_endpoint_suffix</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">unique_vehicle_ids</span> <span class="o">=</span> <span class="n">df_media_entries</span><span class="p">[</span><span class="s2">&quot;vehicleId&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="n">unique_media_type_ids</span> <span class="o">=</span> <span class="n">df_media_entries</span><span class="p">[</span><span class="s2">&quot;mediaTypeId&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

            <span class="c1"># extract vehicles</span>
            <span class="n">df_vehicles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_and_transform</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;vehicles&quot;</span><span class="p">,</span> <span class="n">vehicle_ids</span><span class="o">=</span><span class="n">unique_vehicle_ids</span>
            <span class="p">)</span>

            <span class="c1"># extract campaigns</span>
            <span class="n">df_campaigns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_and_transform</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;campaigns&quot;</span><span class="p">,</span>
                <span class="n">organization_id</span><span class="o">=</span><span class="n">organization_id</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># extract media types</span>
            <span class="n">df_media_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_and_transform</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;media_types&quot;</span><span class="p">,</span>
                <span class="n">media_type_ids</span><span class="o">=</span><span class="n">unique_media_type_ids</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># join media entries &amp; organizations</span>
            <span class="n">df_merged_entries_orgs</span> <span class="o">=</span> <span class="n">join_dfs</span><span class="p">(</span>
                <span class="n">df_left</span><span class="o">=</span><span class="n">df_media_entries</span><span class="p">,</span>
                <span class="n">df_right</span><span class="o">=</span><span class="n">df_organizations</span><span class="p">,</span>
                <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;organizationId&quot;</span><span class="p">,</span>
                <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;_id_organizations&quot;</span><span class="p">,</span>
                <span class="n">columns_from_right_df</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;_id_organizations&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;name_organizations&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;abbreviation_organizations&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># join the previous merge &amp; campaigns</span>
            <span class="n">df_merged_campaigns</span> <span class="o">=</span> <span class="n">join_dfs</span><span class="p">(</span>
                <span class="n">df_left</span><span class="o">=</span><span class="n">df_merged_entries_orgs</span><span class="p">,</span>
                <span class="n">df_right</span><span class="o">=</span><span class="n">df_campaigns</span><span class="p">,</span>
                <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;campaignId&quot;</span><span class="p">,</span>
                <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;_id_campaigns&quot;</span><span class="p">,</span>
                <span class="n">columns_from_right_df</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;_id_campaigns&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;name_campaigns&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;conventionalName_campaigns&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># join the previous merge &amp; vehicles</span>
            <span class="n">df_merged_vehicles</span> <span class="o">=</span> <span class="n">join_dfs</span><span class="p">(</span>
                <span class="n">df_left</span><span class="o">=</span><span class="n">df_merged_campaigns</span><span class="p">,</span>
                <span class="n">df_right</span><span class="o">=</span><span class="n">df_vehicles</span><span class="p">,</span>
                <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;vehicleId&quot;</span><span class="p">,</span>
                <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;_id_vehicles&quot;</span><span class="p">,</span>
                <span class="n">columns_from_right_df</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_id_vehicles&quot;</span><span class="p">,</span> <span class="s2">&quot;name_vehicles&quot;</span><span class="p">],</span>
                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># join the previous merge &amp; media types</span>
            <span class="n">df_merged_media_types</span> <span class="o">=</span> <span class="n">join_dfs</span><span class="p">(</span>
                <span class="n">df_left</span><span class="o">=</span><span class="n">df_merged_vehicles</span><span class="p">,</span>
                <span class="n">df_right</span><span class="o">=</span><span class="n">df_media_types</span><span class="p">,</span>
                <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;mediaTypeId&quot;</span><span class="p">,</span>
                <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;_id_media_types&quot;</span><span class="p">,</span>
                <span class="n">columns_from_right_df</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_id_media_types&quot;</span><span class="p">,</span> <span class="s2">&quot;name_media_types&quot;</span><span class="p">],</span>
                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">list_of_organizations_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_merged_media_types</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Organization - </span><span class="si">{</span><span class="n">organization_id</span><span class="si">}</span><span class="s2"> not found in organizations list.&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="n">df_final</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_organizations_df</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">df_final</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span><span class="n">if_empty</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_final</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.mindful.Mindful" class="doc doc-heading">
            <code>viadot.sources.mindful.Mindful</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>


        <p>Class implementing the Mindful API.</p>
<p>Documentation for this API is available at: https://apidocs.surveydynamix.com/.</p>







              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/mindful.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Mindful</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class implementing the Mindful API.</span>

<span class="sd">    Documentation for this API is available at: https://apidocs.surveydynamix.com/.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ENDPOINTS</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;interactions&quot;</span><span class="p">,</span> <span class="s2">&quot;responses&quot;</span><span class="p">,</span> <span class="s2">&quot;surveys&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">MindfulCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mindful&quot;</span><span class="p">,</span>
        <span class="n">region</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;us1&quot;</span><span class="p">,</span> <span class="s2">&quot;us2&quot;</span><span class="p">,</span> <span class="s2">&quot;us3&quot;</span><span class="p">,</span> <span class="s2">&quot;ca1&quot;</span><span class="p">,</span> <span class="s2">&quot;eu1&quot;</span><span class="p">,</span> <span class="s2">&quot;au1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;eu1&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Mindful instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            credentials (Optional[MindfulCredentials], optional): Mindful credentials.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">                credentials. Defaults to &quot;mindful&quot;.</span>
<span class="sd">            region (Literal[us1, us2, us3, ca1, eu1, au1], optional): Survey Dynamix</span>
<span class="sd">                region from where to interact with the mindful API. Defaults to &quot;eu1&quot;</span>
<span class="sd">                English (United Kingdom).</span>

<span class="sd">        Examples:</span>
<span class="sd">            mindful = Mindful(</span>
<span class="sd">                credentials=credentials,</span>
<span class="sd">                config_key=config_key,</span>
<span class="sd">                region=region,</span>
<span class="sd">            )</span>
<span class="sd">            mindful.api_connection(</span>
<span class="sd">                endpoint=endpoint,</span>
<span class="sd">                date_interval=date_interval,</span>
<span class="sd">                limit=limit,</span>
<span class="sd">            )</span>
<span class="sd">            data_frame = mindful.to_df()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">credentials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Missing credentials.&quot;</span>
            <span class="k">raise</span> <span class="n">CredentialError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">MindfulCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">credentials</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="p">(</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;customer_uuid&quot;</span><span class="p">],</span> <span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;auth_token&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">region</span> <span class="o">!=</span> <span class="s2">&quot;us1&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_mindful_api_response</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call to Mindful API given an endpoint.</span>

<span class="sd">        Args:</span>
<span class="sd">            params (Optional[Dict[str, Any]], optional): Parameters to be passed into</span>
<span class="sd">                the request. Defaults to None.</span>
<span class="sd">            endpoint (str, optional): API endpoint for an individual request.</span>
<span class="sd">                Defaults to &quot;&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: request object with the response from the Mindful API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">handle_api_response</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">surveydynamix.com/api/</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">auth</span><span class="o">=</span><span class="n">HTTPBasicAuth</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">auth</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">api_connection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;interactions&quot;</span><span class="p">,</span> <span class="s2">&quot;responses&quot;</span><span class="p">,</span> <span class="s2">&quot;surveys&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;surveys&quot;</span><span class="p">,</span>
        <span class="n">date_interval</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;General method to connect to Survey Dynamix API and generate the response.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (Literal[&quot;interactions&quot;, &quot;responses&quot;, &quot;surveys&quot;], optional): API</span>
<span class="sd">                endpoint for an individual request. Defaults to &quot;surveys&quot;.</span>
<span class="sd">            date_interval (Optional[List[date]], optional): Date time range detailing</span>
<span class="sd">                the starting date and the ending date. If no range is passed, one day of</span>
<span class="sd">                data since this moment will be retrieved. Defaults to None.</span>
<span class="sd">            limit (int, optional): The number of matching interactions to return.</span>
<span class="sd">                Defaults to 1000.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Not available endpoint.</span>
<span class="sd">            APIError: Failed to download data from the endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENDPOINTS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Survey Dynamix endpoint: &#39;</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&#39;,&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; is not available through Mindful viadot connector.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">date_interval</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">,</span> <span class="n">date_interval</span><span class="p">,</span> <span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">date_interval</span><span class="p">))))</span>
            <span class="ow">is</span> <span class="kc">False</span>
        <span class="p">):</span>
            <span class="n">reference_date</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
            <span class="n">date_interval</span> <span class="o">=</span> <span class="p">[</span><span class="n">reference_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">reference_date</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;No `date_interval` parameter was defined, or was erroneously &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;defined. `date_interval` parameter must have the folloing &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;structure:</span><span class="se">\n\t</span><span class="s2">[`date_0`, `date_1`], having that `date_1` &gt; &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;`date_0`.</span><span class="se">\n</span><span class="s2">By default, one day of data, from &quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> to &quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">, will be obtained.&quot;</span>
            <span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;_limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
            <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;surveys&quot;</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mindful_api_response</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response_ok</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="n">no_data_code</span> <span class="o">=</span> <span class="mi">204</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">response_ok</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Successfully downloaded &#39;</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&#39; data from mindful API.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">no_data_code</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;There are not &#39;</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&#39; data to download from&quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">date_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">date_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to downloaded &#39;</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&#39; data. - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to downloaded &#39;</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&#39; data.&quot;</span>
            <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="nd">@add_viadot_metadata_columns</span>
    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download the data to a pandas DataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            if_empty (str, optional): What to do if a fetch produce no data.</span>
<span class="sd">                Defaults to &quot;warn</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.Dataframe: The response data as a pandas DataFrame plus viadot metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">)</span>

        <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span>
                <span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;The response does not contain any data.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully downloaded data from the Mindful API.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_frame</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.mindful.Mindful.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_key</span><span class="o">=</span><span class="s1">&#39;mindful&#39;</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="s1">&#39;eu1&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a Mindful instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>credentials</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="viadot.sources.mindful.MindfulCredentials">MindfulCredentials</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mindful credentials.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key in the viadot config holding relevant
credentials. Defaults to "mindful".</p>
              </div>
            </td>
            <td>
                  <code>&#39;mindful&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>region</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[<span title="us1">us1</span>, <span title="us2">us2</span>, <span title="us3">us3</span>, <span title="ca1">ca1</span>, <span title="eu1">eu1</span>, <span title="au1">au1</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Survey Dynamix
region from where to interact with the mindful API. Defaults to "eu1"
English (United Kingdom).</p>
              </div>
            </td>
            <td>
                  <code>&#39;eu1&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>mindful = Mindful(
    credentials=credentials,
    config_key=config_key,
    region=region,
)
mindful.api_connection(
    endpoint=endpoint,
    date_interval=date_interval,
    limit=limit,
)
data_frame = mindful.to_df()</p>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/mindful.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="n">MindfulCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mindful&quot;</span><span class="p">,</span>
    <span class="n">region</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;us1&quot;</span><span class="p">,</span> <span class="s2">&quot;us2&quot;</span><span class="p">,</span> <span class="s2">&quot;us3&quot;</span><span class="p">,</span> <span class="s2">&quot;ca1&quot;</span><span class="p">,</span> <span class="s2">&quot;eu1&quot;</span><span class="p">,</span> <span class="s2">&quot;au1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;eu1&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Mindful instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        credentials (Optional[MindfulCredentials], optional): Mindful credentials.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">            credentials. Defaults to &quot;mindful&quot;.</span>
<span class="sd">        region (Literal[us1, us2, us3, ca1, eu1, au1], optional): Survey Dynamix</span>
<span class="sd">            region from where to interact with the mindful API. Defaults to &quot;eu1&quot;</span>
<span class="sd">            English (United Kingdom).</span>

<span class="sd">    Examples:</span>
<span class="sd">        mindful = Mindful(</span>
<span class="sd">            credentials=credentials,</span>
<span class="sd">            config_key=config_key,</span>
<span class="sd">            region=region,</span>
<span class="sd">        )</span>
<span class="sd">        mindful.api_connection(</span>
<span class="sd">            endpoint=endpoint,</span>
<span class="sd">            date_interval=date_interval,</span>
<span class="sd">            limit=limit,</span>
<span class="sd">        )</span>
<span class="sd">        data_frame = mindful.to_df()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">credentials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Missing credentials.&quot;</span>
        <span class="k">raise</span> <span class="n">CredentialError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">MindfulCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">credentials</span><span class="p">))</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="p">(</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;customer_uuid&quot;</span><span class="p">],</span> <span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;auth_token&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">region</span> <span class="o">!=</span> <span class="s2">&quot;us1&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s2">.&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.mindful.Mindful.api_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">api_connection</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="s1">&#39;surveys&#39;</span><span class="p">,</span> <span class="n">date_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>General method to connect to Survey Dynamix API and generate the response.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>endpoint</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;interactions&#39;, &#39;responses&#39;, &#39;surveys&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>API
endpoint for an individual request. Defaults to "surveys".</p>
              </div>
            </td>
            <td>
                  <code>&#39;surveys&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>date_interval</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="List">List</span>[<span title="datetime.date">date</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Date time range detailing
the starting date and the ending date. If no range is passed, one day of
data since this moment will be retrieved. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of matching interactions to return.
Defaults to 1000.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Not available endpoint.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="viadot.exceptions.APIError">APIError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Failed to download data from the endpoint.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/mindful.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">api_connection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;interactions&quot;</span><span class="p">,</span> <span class="s2">&quot;responses&quot;</span><span class="p">,</span> <span class="s2">&quot;surveys&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;surveys&quot;</span><span class="p">,</span>
    <span class="n">date_interval</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;General method to connect to Survey Dynamix API and generate the response.</span>

<span class="sd">    Args:</span>
<span class="sd">        endpoint (Literal[&quot;interactions&quot;, &quot;responses&quot;, &quot;surveys&quot;], optional): API</span>
<span class="sd">            endpoint for an individual request. Defaults to &quot;surveys&quot;.</span>
<span class="sd">        date_interval (Optional[List[date]], optional): Date time range detailing</span>
<span class="sd">            the starting date and the ending date. If no range is passed, one day of</span>
<span class="sd">            data since this moment will be retrieved. Defaults to None.</span>
<span class="sd">        limit (int, optional): The number of matching interactions to return.</span>
<span class="sd">            Defaults to 1000.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Not available endpoint.</span>
<span class="sd">        APIError: Failed to download data from the endpoint.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENDPOINTS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Survey Dynamix endpoint: &#39;</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&#39;,&quot;</span>
            <span class="o">+</span> <span class="s2">&quot; is not available through Mindful viadot connector.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="n">date_interval</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">,</span> <span class="n">date_interval</span><span class="p">,</span> <span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">date_interval</span><span class="p">))))</span>
        <span class="ow">is</span> <span class="kc">False</span>
    <span class="p">):</span>
        <span class="n">reference_date</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
        <span class="n">date_interval</span> <span class="o">=</span> <span class="p">[</span><span class="n">reference_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">reference_date</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;No `date_interval` parameter was defined, or was erroneously &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;defined. `date_interval` parameter must have the folloing &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;structure:</span><span class="se">\n\t</span><span class="s2">[`date_0`, `date_1`], having that `date_1` &gt; &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;`date_0`.</span><span class="se">\n</span><span class="s2">By default, one day of data, from &quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> to &quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">, will be obtained.&quot;</span>
        <span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;_limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
        <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;surveys&quot;</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span>

    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mindful_api_response</span><span class="p">(</span>
        <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">response_ok</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">no_data_code</span> <span class="o">=</span> <span class="mi">204</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">response_ok</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Successfully downloaded &#39;</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&#39; data from mindful API.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">no_data_code</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;There are not &#39;</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&#39; data to download from&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">date_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">date_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to downloaded &#39;</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&#39; data. - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to downloaded &#39;</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&#39; data.&quot;</span>
        <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.mindful.Mindful.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download the data to a pandas DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>if_empty</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What to do if a fetch produce no data.
Defaults to "warn</p>
              </div>
            </td>
            <td>
                  <code>&#39;warn&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.Dataframe: The response data as a pandas DataFrame plus viadot metadata.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/mindful.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_viadot_metadata_columns</span>
<span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download the data to a pandas DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        if_empty (str, optional): What to do if a fetch produce no data.</span>
<span class="sd">            Defaults to &quot;warn</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.Dataframe: The response data as a pandas DataFrame plus viadot metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">)</span>

    <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span>
            <span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;The response does not contain any data.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully downloaded data from the Mindful API.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data_frame</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources._minio.MinIO" class="doc doc-heading">
            <code>viadot.sources._minio.MinIO</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>








              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/_minio.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MinIO</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">MinIOCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A class for interacting with MinIO.</span>

<span class="sd">        Interact with MinIO in a more Pythonic, user-friendly, and robust way than the</span>
<span class="sd">        official minio client.</span>

<span class="sd">        Args:</span>
<span class="sd">        credentials (MinIOCredentials): MinIO credentials.</span>
<span class="sd">        config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">            credentials.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">validated_creds</span> <span class="o">=</span> <span class="n">MinIOCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">)</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span>
            <span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>  <span class="c1"># validate the credentials</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;endpoint&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;access_key&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;secret_key&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bucket&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;secure&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verify&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">http_scheme</span> <span class="o">=</span> <span class="s2">&quot;https&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="s2">&quot;http&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">Minio</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="n">access_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">access_key</span><span class="p">,</span>
            <span class="n">secret_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span>
            <span class="n">secure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secure</span><span class="p">,</span>
            <span class="n">http_client</span><span class="o">=</span><span class="n">urllib3</span><span class="o">.</span><span class="n">PoolManager</span><span class="p">(</span>
                <span class="n">timeout</span><span class="o">=</span><span class="n">urllib3</span><span class="o">.</span><span class="n">Timeout</span><span class="o">.</span><span class="n">DEFAULT_TIMEOUT</span><span class="p">,</span>
                <span class="n">retries</span><span class="o">=</span><span class="n">urllib3</span><span class="o">.</span><span class="n">Retry</span><span class="p">(</span>
                    <span class="n">connect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">read</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                    <span class="n">total</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">backoff_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">status_forcelist</span><span class="o">=</span><span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">],</span>
                <span class="p">),</span>
                <span class="n">cert_reqs</span><span class="o">=</span><span class="s2">&quot;CERT_REQUIRED&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify</span> <span class="k">else</span> <span class="s2">&quot;CERT_NONE&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">storage_options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_key</span><span class="p">,</span>
            <span class="s2">&quot;secret&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span>
            <span class="s2">&quot;client_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;endpoint_url&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">http_scheme</span><span class="si">}</span><span class="s2">://&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
                <span class="s2">&quot;use_ssl&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure</span><span class="p">,</span>
                <span class="s2">&quot;verify&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">s3fs</span><span class="o">.</span><span class="n">S3FileSystem</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_options</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">],</span>
            <span class="n">secret</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_options</span><span class="p">[</span><span class="s2">&quot;secret&quot;</span><span class="p">],</span>
            <span class="n">client_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_options</span><span class="p">[</span><span class="s2">&quot;client_kwargs&quot;</span><span class="p">],</span>
            <span class="n">anon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_arrow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">table</span><span class="p">:</span> <span class="n">pa</span><span class="o">.</span><span class="n">Table</span><span class="p">,</span>
        <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">basename_template</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">partition_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">if_exists</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;delete_matching&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite_or_ignore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Parquet dataset on MinIO from a PyArrow Table.</span>

<span class="sd">        Uses multi-part upload to upload the table in chunks, speeding up the</span>
<span class="sd">        process by using multithreading and avoiding upload size limits.</span>

<span class="sd">        Either both `schema_name` and `table_name` or only `path` must be provided.</span>

<span class="sd">        `path` allows specifying an arbitrary path, while `schema_name` and `table_name`</span>
<span class="sd">        provide a shortcut for creating a data lakehouse-like structure of</span>
<span class="sd">        `s3://&lt;bucket&gt;/&lt;schema_name&gt;/&lt;table_name&gt;/&lt;table_name&gt;.parquet`.</span>

<span class="sd">        For more information on partitioning, see</span>
<span class="sd">        https://arrow.apache.org/docs/python/generated/pyarrow.parquet.write_to_dataset.html#pyarrow-parquet-write-to-dataset</span>

<span class="sd">        Args:</span>
<span class="sd">            table (pa.Table): The table to upload.</span>
<span class="sd">            schema_name (str, optional): The name of the schema directory. Defaults to</span>
<span class="sd">                None.</span>
<span class="sd">            table_name (str, optional): The name of the table directory. Defaults to</span>
<span class="sd">                None.</span>
<span class="sd">            path (str | Path, optional): The path to the destination file. Defaults to</span>
<span class="sd">                None.</span>
<span class="sd">            basename_template (str, optional): A template string used to generate</span>
<span class="sd">                basenames of written data files. The token &#39;{i}&#39; will be replaced with</span>
<span class="sd">                an automatically incremented integer. Defaults to None.</span>
<span class="sd">            partition_cols (list[str], optional): The columns to partition by. Defaults</span>
<span class="sd">                to None.</span>
<span class="sd">            if_exists (Literal[&quot;error&quot;, &quot;delete_matching&quot;, &quot;overwrite_or_ignore&quot;],</span>
<span class="sd">                optional): What to do if the dataset already exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fqn_or_path</span> <span class="o">=</span> <span class="p">(</span><span class="n">schema_name</span> <span class="ow">and</span> <span class="n">table_name</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">path</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">schema_name</span> <span class="ow">or</span> <span class="n">table_name</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fqn_or_path</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Either both `schema_name` and `table_name` or only `path` must be provided.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># We need to create the dirs here as PyArrow also tries to create the bucket,</span>
        <span class="c1"># which shouldn&#39;t be allowed for whomever is executing this code.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating directory for table </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Directory has been created successfully.&quot;</span><span class="p">)</span>

        <span class="c1"># Write the data.</span>
        <span class="n">pq</span><span class="o">.</span><span class="n">write_to_dataset</span><span class="p">(</span>
            <span class="n">table</span><span class="p">,</span>
            <span class="n">root_path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
            <span class="n">partition_cols</span><span class="o">=</span><span class="n">partition_cols</span><span class="p">,</span>
            <span class="n">existing_data_behavior</span><span class="o">=</span><span class="n">if_exists</span><span class="p">,</span>
            <span class="n">basename_template</span><span class="o">=</span><span class="n">basename_template</span><span class="p">,</span>
            <span class="n">filesystem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span>
            <span class="n">max_rows_per_file</span><span class="o">=</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
            <span class="n">create_dir</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Required as Arrow attempts to create the bucket, too.</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">basename_template</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">partition_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">if_exists</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;delete_matching&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite_or_ignore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Parquet dataset on MinIO from a PyArrow Table.</span>

<span class="sd">        Uses multi-part upload to upload the table in chunks, speeding up the</span>
<span class="sd">        process by using multithreading and avoiding upload size limits.</span>

<span class="sd">        Either both `schema_name` and `table_name` or only `path` must be provided.</span>

<span class="sd">        `path` allows specifying an arbitrary path, while `schema_name` and `table_name`</span>
<span class="sd">        provide a shortcut for creating a data lakehouse-like structure of</span>
<span class="sd">        `s3://&lt;bucket&gt;/&lt;schema_name&gt;/&lt;table_name&gt;/&lt;table_name&gt;.parquet`.</span>

<span class="sd">        For more information on partitioning, see</span>
<span class="sd">        https://arrow.apache.org/docs/python/generated/pyarrow.parquet.write_to_dataset.html#pyarrow-parquet-write-to-dataset</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pd.DataFrame): The DataFrame to upload.</span>
<span class="sd">            schema_name (str, optional): The name of the schema directory. Defaults to</span>
<span class="sd">                None.</span>
<span class="sd">            table_name (str, optional): The name of the table directory. Defaults to</span>
<span class="sd">                None.</span>
<span class="sd">            path (str | Path, optional): The path to the destination file. Defaults to</span>
<span class="sd">                None.</span>
<span class="sd">            basename_template (str, optional): A template string used to generate</span>
<span class="sd">                basenames of written data files. The token &#39;{i}&#39; will be replaced with</span>
<span class="sd">                an automatically incremented integer. Defaults to None.</span>
<span class="sd">            partition_cols (list[str], optional): The columns to partition by. Defaults</span>
<span class="sd">                to None.</span>
<span class="sd">            if_exists (Literal[&quot;error&quot;, &quot;delete_matching&quot;, &quot;overwrite_or_ignore&quot;],</span>
<span class="sd">                optional): What to do if the dataset already exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_arrow</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">,</span>
            <span class="n">schema_name</span><span class="o">=</span><span class="n">schema_name</span><span class="p">,</span>
            <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
            <span class="n">basename_template</span><span class="o">=</span><span class="n">basename_template</span><span class="p">,</span>
            <span class="n">partition_cols</span><span class="o">=</span><span class="n">partition_cols</span><span class="p">,</span>
            <span class="n">if_exists</span><span class="o">=</span><span class="n">if_exists</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List files and directories under `path`.</span>

<span class="sd">        List operation can be slow if there are a lot of objects, hence using a</span>
<span class="sd">        generator.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): The path which contents should be listed.</span>

<span class="sd">        Yields:</span>
<span class="sd">            Generator[str, None, None]: Contents (files and directories) of `path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">obj</span><span class="o">.</span><span class="n">object_name</span>

    <span class="k">def</span> <span class="nf">rm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a file or directory from MinIO.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): The path to the file to remove.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="n">bucket</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">:])</span>
            <span class="n">objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">remove_object</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">object_name</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">remove_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_if_file_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">stat_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">S3Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Object does not exist&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">check_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify connectivity to the MinIO endpoint.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bucket_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NewConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Connection to MinIO endpoint &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&#39; failed with error: </span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Please check your credentials and try again.&quot;</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Connection to MinIO endpoint &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&#39; failed with error: </span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connection successful!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources._minio.MinIO.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A class for interacting with MinIO.</p>
<p>Interact with MinIO in a more Pythonic, user-friendly, and robust way than the
official minio client.</p>
<p>Args:
credentials (MinIOCredentials): MinIO credentials.
config_key (str, optional): The key in the viadot config holding relevant
    credentials.</p>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/_minio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="n">MinIOCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class for interacting with MinIO.</span>

<span class="sd">    Interact with MinIO in a more Pythonic, user-friendly, and robust way than the</span>
<span class="sd">    official minio client.</span>

<span class="sd">    Args:</span>
<span class="sd">    credentials (MinIOCredentials): MinIO credentials.</span>
<span class="sd">    config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">        credentials.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">validated_creds</span> <span class="o">=</span> <span class="n">MinIOCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">)</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span>
        <span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>  <span class="c1"># validate the credentials</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;endpoint&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">access_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;access_key&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;secret_key&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bucket&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">secure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;secure&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verify&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">http_scheme</span> <span class="o">=</span> <span class="s2">&quot;https&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="s2">&quot;http&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">Minio</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
        <span class="n">access_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">access_key</span><span class="p">,</span>
        <span class="n">secret_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span>
        <span class="n">secure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secure</span><span class="p">,</span>
        <span class="n">http_client</span><span class="o">=</span><span class="n">urllib3</span><span class="o">.</span><span class="n">PoolManager</span><span class="p">(</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">urllib3</span><span class="o">.</span><span class="n">Timeout</span><span class="o">.</span><span class="n">DEFAULT_TIMEOUT</span><span class="p">,</span>
            <span class="n">retries</span><span class="o">=</span><span class="n">urllib3</span><span class="o">.</span><span class="n">Retry</span><span class="p">(</span>
                <span class="n">connect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">read</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                <span class="n">total</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">backoff_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">status_forcelist</span><span class="o">=</span><span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">],</span>
            <span class="p">),</span>
            <span class="n">cert_reqs</span><span class="o">=</span><span class="s2">&quot;CERT_REQUIRED&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify</span> <span class="k">else</span> <span class="s2">&quot;CERT_NONE&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">storage_options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_key</span><span class="p">,</span>
        <span class="s2">&quot;secret&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span>
        <span class="s2">&quot;client_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;endpoint_url&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">http_scheme</span><span class="si">}</span><span class="s2">://&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="s2">&quot;use_ssl&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure</span><span class="p">,</span>
            <span class="s2">&quot;verify&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">s3fs</span><span class="o">.</span><span class="n">S3FileSystem</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_options</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">],</span>
        <span class="n">secret</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_options</span><span class="p">[</span><span class="s2">&quot;secret&quot;</span><span class="p">],</span>
        <span class="n">client_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_options</span><span class="p">[</span><span class="s2">&quot;client_kwargs&quot;</span><span class="p">],</span>
        <span class="n">anon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources._minio.MinIO.check_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_connection</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Verify connectivity to the MinIO endpoint.</p>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/_minio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Verify connectivity to the MinIO endpoint.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bucket_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">NewConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Connection to MinIO endpoint &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&#39; failed with error: </span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Please check your credentials and try again.&quot;</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Connection to MinIO endpoint &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&#39; failed with error: </span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connection successful!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources._minio.MinIO.from_arrow" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_arrow</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">schema_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">basename_template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">partition_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a Parquet dataset on MinIO from a PyArrow Table.</p>
<p>Uses multi-part upload to upload the table in chunks, speeding up the
process by using multithreading and avoiding upload size limits.</p>
<p>Either both <code>schema_name</code> and <code>table_name</code> or only <code>path</code> must be provided.</p>
<p><code>path</code> allows specifying an arbitrary path, while <code>schema_name</code> and <code>table_name</code>
provide a shortcut for creating a data lakehouse-like structure of
<code>s3://&lt;bucket&gt;/&lt;schema_name&gt;/&lt;table_name&gt;/&lt;table_name&gt;.parquet</code>.</p>
<p>For more information on partitioning, see
https://arrow.apache.org/docs/python/generated/pyarrow.parquet.write_to_dataset.html#pyarrow-parquet-write-to-dataset</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="pyarrow.Table">Table</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The table to upload.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>schema_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the schema directory. Defaults to
None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>table_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the table directory. Defaults to
None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the destination file. Defaults to
None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>basename_template</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A template string used to generate
basenames of written data files. The token '{i}' will be replaced with
an automatically incremented integer. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>partition_cols</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The columns to partition by. Defaults
to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/_minio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">from_arrow</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">pa</span><span class="o">.</span><span class="n">Table</span><span class="p">,</span>
    <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">basename_template</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">partition_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">if_exists</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;delete_matching&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite_or_ignore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Parquet dataset on MinIO from a PyArrow Table.</span>

<span class="sd">    Uses multi-part upload to upload the table in chunks, speeding up the</span>
<span class="sd">    process by using multithreading and avoiding upload size limits.</span>

<span class="sd">    Either both `schema_name` and `table_name` or only `path` must be provided.</span>

<span class="sd">    `path` allows specifying an arbitrary path, while `schema_name` and `table_name`</span>
<span class="sd">    provide a shortcut for creating a data lakehouse-like structure of</span>
<span class="sd">    `s3://&lt;bucket&gt;/&lt;schema_name&gt;/&lt;table_name&gt;/&lt;table_name&gt;.parquet`.</span>

<span class="sd">    For more information on partitioning, see</span>
<span class="sd">    https://arrow.apache.org/docs/python/generated/pyarrow.parquet.write_to_dataset.html#pyarrow-parquet-write-to-dataset</span>

<span class="sd">    Args:</span>
<span class="sd">        table (pa.Table): The table to upload.</span>
<span class="sd">        schema_name (str, optional): The name of the schema directory. Defaults to</span>
<span class="sd">            None.</span>
<span class="sd">        table_name (str, optional): The name of the table directory. Defaults to</span>
<span class="sd">            None.</span>
<span class="sd">        path (str | Path, optional): The path to the destination file. Defaults to</span>
<span class="sd">            None.</span>
<span class="sd">        basename_template (str, optional): A template string used to generate</span>
<span class="sd">            basenames of written data files. The token &#39;{i}&#39; will be replaced with</span>
<span class="sd">            an automatically incremented integer. Defaults to None.</span>
<span class="sd">        partition_cols (list[str], optional): The columns to partition by. Defaults</span>
<span class="sd">            to None.</span>
<span class="sd">        if_exists (Literal[&quot;error&quot;, &quot;delete_matching&quot;, &quot;overwrite_or_ignore&quot;],</span>
<span class="sd">            optional): What to do if the dataset already exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fqn_or_path</span> <span class="o">=</span> <span class="p">(</span><span class="n">schema_name</span> <span class="ow">and</span> <span class="n">table_name</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">path</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">schema_name</span> <span class="ow">or</span> <span class="n">table_name</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fqn_or_path</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Either both `schema_name` and `table_name` or only `path` must be provided.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># We need to create the dirs here as PyArrow also tries to create the bucket,</span>
    <span class="c1"># which shouldn&#39;t be allowed for whomever is executing this code.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating directory for table </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Directory has been created successfully.&quot;</span><span class="p">)</span>

    <span class="c1"># Write the data.</span>
    <span class="n">pq</span><span class="o">.</span><span class="n">write_to_dataset</span><span class="p">(</span>
        <span class="n">table</span><span class="p">,</span>
        <span class="n">root_path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
        <span class="n">partition_cols</span><span class="o">=</span><span class="n">partition_cols</span><span class="p">,</span>
        <span class="n">existing_data_behavior</span><span class="o">=</span><span class="n">if_exists</span><span class="p">,</span>
        <span class="n">basename_template</span><span class="o">=</span><span class="n">basename_template</span><span class="p">,</span>
        <span class="n">filesystem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span>
        <span class="n">max_rows_per_file</span><span class="o">=</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
        <span class="n">create_dir</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Required as Arrow attempts to create the bucket, too.</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources._minio.MinIO.from_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">schema_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">basename_template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">partition_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a Parquet dataset on MinIO from a PyArrow Table.</p>
<p>Uses multi-part upload to upload the table in chunks, speeding up the
process by using multithreading and avoiding upload size limits.</p>
<p>Either both <code>schema_name</code> and <code>table_name</code> or only <code>path</code> must be provided.</p>
<p><code>path</code> allows specifying an arbitrary path, while <code>schema_name</code> and <code>table_name</code>
provide a shortcut for creating a data lakehouse-like structure of
<code>s3://&lt;bucket&gt;/&lt;schema_name&gt;/&lt;table_name&gt;/&lt;table_name&gt;.parquet</code>.</p>
<p>For more information on partitioning, see
https://arrow.apache.org/docs/python/generated/pyarrow.parquet.write_to_dataset.html#pyarrow-parquet-write-to-dataset</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The DataFrame to upload.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>schema_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the schema directory. Defaults to
None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>table_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the table directory. Defaults to
None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the destination file. Defaults to
None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>basename_template</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A template string used to generate
basenames of written data files. The token '{i}' will be replaced with
an automatically incremented integer. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>partition_cols</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The columns to partition by. Defaults
to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/_minio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">from_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">basename_template</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">partition_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">if_exists</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;delete_matching&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite_or_ignore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Parquet dataset on MinIO from a PyArrow Table.</span>

<span class="sd">    Uses multi-part upload to upload the table in chunks, speeding up the</span>
<span class="sd">    process by using multithreading and avoiding upload size limits.</span>

<span class="sd">    Either both `schema_name` and `table_name` or only `path` must be provided.</span>

<span class="sd">    `path` allows specifying an arbitrary path, while `schema_name` and `table_name`</span>
<span class="sd">    provide a shortcut for creating a data lakehouse-like structure of</span>
<span class="sd">    `s3://&lt;bucket&gt;/&lt;schema_name&gt;/&lt;table_name&gt;/&lt;table_name&gt;.parquet`.</span>

<span class="sd">    For more information on partitioning, see</span>
<span class="sd">    https://arrow.apache.org/docs/python/generated/pyarrow.parquet.write_to_dataset.html#pyarrow-parquet-write-to-dataset</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): The DataFrame to upload.</span>
<span class="sd">        schema_name (str, optional): The name of the schema directory. Defaults to</span>
<span class="sd">            None.</span>
<span class="sd">        table_name (str, optional): The name of the table directory. Defaults to</span>
<span class="sd">            None.</span>
<span class="sd">        path (str | Path, optional): The path to the destination file. Defaults to</span>
<span class="sd">            None.</span>
<span class="sd">        basename_template (str, optional): A template string used to generate</span>
<span class="sd">            basenames of written data files. The token &#39;{i}&#39; will be replaced with</span>
<span class="sd">            an automatically incremented integer. Defaults to None.</span>
<span class="sd">        partition_cols (list[str], optional): The columns to partition by. Defaults</span>
<span class="sd">            to None.</span>
<span class="sd">        if_exists (Literal[&quot;error&quot;, &quot;delete_matching&quot;, &quot;overwrite_or_ignore&quot;],</span>
<span class="sd">            optional): What to do if the dataset already exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_arrow</span><span class="p">(</span>
        <span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">,</span>
        <span class="n">schema_name</span><span class="o">=</span><span class="n">schema_name</span><span class="p">,</span>
        <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
        <span class="n">basename_template</span><span class="o">=</span><span class="n">basename_template</span><span class="p">,</span>
        <span class="n">partition_cols</span><span class="o">=</span><span class="n">partition_cols</span><span class="p">,</span>
        <span class="n">if_exists</span><span class="o">=</span><span class="n">if_exists</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources._minio.MinIO.ls" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ls</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>List files and directories under <code>path</code>.</p>
<p>List operation can be slow if there are a lot of objects, hence using a
generator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path which contents should be listed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generator[str, None, None]: Contents (files and directories) of <code>path</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/_minio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List files and directories under `path`.</span>

<span class="sd">    List operation can be slow if there are a lot of objects, hence using a</span>
<span class="sd">    generator.</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str): The path which contents should be listed.</span>

<span class="sd">    Yields:</span>
<span class="sd">        Generator[str, None, None]: Contents (files and directories) of `path`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">obj</span><span class="o">.</span><span class="n">object_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources._minio.MinIO.rm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rm</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Remove a file or directory from MinIO.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the file to remove.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/_minio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a file or directory from MinIO.</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str): The path to the file to remove.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
        <span class="n">bucket</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">:])</span>
        <span class="n">objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">remove_object</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">object_name</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">remove_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.outlook.Outlook" class="doc doc-heading">
            <code>viadot.sources.outlook.Outlook</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>


        <p>Class implementing the Outlook API.</p>


<details class="documentation-for-this-api-is-available-at" open>
  <summary>Documentation for this API is available at</summary>
  <p>https://o365.github.io/python-o365/latest/getting_started.html.</p>
</details>






              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/outlook.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Outlook</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class implementing the Outlook API.</span>

<span class="sd">    Documentation for this API is available at:</span>
<span class="sd">        https://o365.github.io/python-o365/latest/getting_started.html.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">UTC</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;outlook&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Outlook connector build for fetching Outlook API source.</span>

<span class="sd">        Data are fetched from start to end date range. If start or end date are not</span>
<span class="sd">        provided then flow fetched data from yesterday by default.</span>

<span class="sd">        Args:</span>
<span class="sd">            credentials (Optional[OutlookCredentials], optional): Outlook credentials.</span>
<span class="sd">                Defaults to None</span>
<span class="sd">            config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">                credentials. Defaults to &quot;outlook&quot;.</span>

<span class="sd">        Examples:</span>
<span class="sd">            outlook = Outlook(</span>
<span class="sd">                config_key=config_key,</span>
<span class="sd">            )</span>
<span class="sd">            outlook.api_connection(</span>
<span class="sd">                mailbox_name=mailbox_name,</span>
<span class="sd">                request_retries=request_retries,</span>
<span class="sd">                start_date=start_date,</span>
<span class="sd">                end_date=end_date,</span>
<span class="sd">                limit=limit,</span>
<span class="sd">                address_limit=address_limit,</span>
<span class="sd">                outbox_list=outbox_list,</span>
<span class="sd">            )</span>
<span class="sd">            data_frame = outlook.to_df()</span>

<span class="sd">        Raises:</span>
<span class="sd">            CredentialError: If credentials are not provided in local_config or</span>
<span class="sd">                directly as a parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
        <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">OutlookCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_subfolders</span><span class="p">(</span>
        <span class="n">folder_structure</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">folder</span><span class="p">:</span> <span class="n">MailBox</span><span class="p">,</span>
        <span class="n">key_concat</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve all the subfolder in a MailBox folder.</span>

<span class="sd">        Args:</span>
<span class="sd">            folder_structure (dict): Dictionary where to save the data.</span>
<span class="sd">            folder (MailBox): The MailBox folder from where to extract the subfolders.</span>
<span class="sd">            key_concat (str, optional) Previous Mailbox folder structure to add to</span>
<span class="sd">                the actual subfolder. Defaults to &quot;&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, List]: `folder_structure` dictionary is returned once</span>
<span class="sd">                it is updated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key_concat</span><span class="p">:</span>
            <span class="n">tmp_key</span> <span class="o">=</span> <span class="n">key_concat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
            <span class="n">key_concat</span> <span class="o">=</span> <span class="n">key_concat</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;|</span><span class="si">{</span><span class="n">tmp_key</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">subfolder</span> <span class="ow">in</span> <span class="n">folder</span><span class="o">.</span><span class="n">get_folders</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">subfolder</span><span class="p">:</span>
                <span class="n">folder_structure</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">key_concat</span><span class="p">,</span> <span class="n">folder</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">subfolder</span><span class="o">.</span><span class="n">name</span><span class="p">])</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span>
                            <span class="s2">&quot;|&quot;</span>
                        <span class="p">):</span> <span class="n">subfolder</span>
                    <span class="p">}</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">folder_structure</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">folder_structure</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_all_folders</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mailbox</span><span class="p">:</span> <span class="n">MailBox</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To retrieve all folders from a Mailbox object.</span>

<span class="sd">        Args:</span>
<span class="sd">            mailbox (MailBox): Outlook Mailbox object from where to extract all</span>
<span class="sd">                folder structure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Every single folder and subfolder is returned as</span>
<span class="sd">                &quot;parent (sub)folder|(sub)folder&quot;: Mailbox.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_folders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_subfolders</span><span class="p">({},</span> <span class="n">mailbox</span><span class="p">)</span>
        <span class="n">final_dict_folders</span> <span class="o">=</span> <span class="n">dict_folders</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Get all subfolders.</span>
        <span class="n">while_dict_folders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">}</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">while_dict_folders</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">while_dict_folders</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_folders</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">tmp_dict_folders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_subfolders</span><span class="p">({},</span> <span class="n">value</span><span class="p">,</span> <span class="n">key_concat</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tmp_dict_folders</span><span class="p">:</span>
                    <span class="n">final_dict_folders</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp_dict_folders</span><span class="p">)</span>
                    <span class="n">while_dict_folders</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp_dict_folders</span><span class="p">)</span>

            <span class="n">dict_folders</span> <span class="o">=</span> <span class="n">while_dict_folders</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">final_dict_folders</span>

    <span class="c1"># TODO: should be refactored.</span>
    <span class="k">def</span> <span class="nf">_get_messages_from_mailbox</span><span class="p">(</span>  <span class="c1"># noqa: C901, PLR0912</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mailbox_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">dict_folder</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">date_range_start_time</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">date_range_end_time</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
        <span class="n">address_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>
        <span class="n">outbox_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To retrieve all messages from all the mailboxes passed in the dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            mailbox_name (str): Mailbox name.</span>
<span class="sd">            dict_folder (dict): Mailboxes dictionary holder, with the following</span>
<span class="sd">                structure: &quot;parent (sub)folder|(sub)folder&quot;: Mailbox.</span>
<span class="sd">            date_range_start_time (datetime): Start date from where to stract data.</span>
<span class="sd">            date_range_end_time (datetime): End data up to where to stract data.</span>
<span class="sd">            limit (int, optional): Number of fetched top messages. Defaults to 10000.</span>
<span class="sd">            address_limit (int, optional): The maximum number of accepted characters in</span>
<span class="sd">                the sum of all email names. Defaults to 8000.</span>
<span class="sd">            outbox_list (List[str], optional): List of outbox folders to differenciate</span>
<span class="sd">                between Inboxes and Outboxes. Defaults to [&quot;Sent Items&quot;].</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list with all messages from all Mailboxes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">outbox_list</span><span class="p">:</span>
            <span class="n">outbox_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Sent Items&quot;</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_folder</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">get_messages</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">):</span>
                <span class="n">received_time</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">received</span>
                <span class="n">date_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">received_time</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">date_range_start_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">UTC</span><span class="p">)</span>
                    <span class="o">&lt;</span> <span class="n">date_obj</span>
                    <span class="o">&lt;</span> <span class="n">date_range_end_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">UTC</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">fetched</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">to_api_data</span><span class="p">()</span>
                    <span class="n">sender_mail</span> <span class="o">=</span> <span class="n">fetched</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;from&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sender_mail</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">sender_mail</span> <span class="o">=</span> <span class="n">fetched</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">][</span><span class="s2">&quot;emailAddress&quot;</span><span class="p">][</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>
                    <span class="n">recivers_list</span> <span class="o">=</span> <span class="n">fetched</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;toRecipients&quot;</span><span class="p">)</span>
                    <span class="n">recivers</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span>

                    <span class="k">if</span> <span class="n">recivers_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">reciver</span> <span class="ow">in</span> <span class="n">recivers_list</span><span class="p">:</span>
                            <span class="n">add_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;, </span><span class="si">{</span><span class="n">reciver</span><span class="p">[</span><span class="s1">&#39;emailAddress&#39;</span><span class="p">][</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="p">[</span><span class="n">recivers</span><span class="p">,</span> <span class="n">add_string</span><span class="p">])))</span>
                                <span class="o">&gt;=</span> <span class="n">address_limit</span>
                            <span class="p">):</span>
                                <span class="k">break</span>

                            <span class="n">recivers</span> <span class="o">+=</span> <span class="n">add_string</span>

                    <span class="n">categories</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span>
                    <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">categories</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">categories</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="n">categories</span> <span class="k">for</span> <span class="n">categories</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">categories</span>
                        <span class="p">)</span>

                    <span class="n">conversation_index</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span>
                    <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">conversation_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">conversation_index</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">conversation_index</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">subject</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">subject</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">subject</span>

                    <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;(sub)folder&quot;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="s2">&quot;conversation ID&quot;</span><span class="p">:</span> <span class="n">fetched</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;conversationId&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;conversation index&quot;</span><span class="p">:</span> <span class="n">conversation_index</span><span class="p">,</span>
                        <span class="s2">&quot;categories&quot;</span><span class="p">:</span> <span class="n">categories</span><span class="p">,</span>
                        <span class="s2">&quot;sender&quot;</span><span class="p">:</span> <span class="n">sender_mail</span><span class="p">,</span>
                        <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="n">subject</span><span class="p">,</span>
                        <span class="s2">&quot;recivers&quot;</span><span class="p">:</span> <span class="n">recivers</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">),</span>
                        <span class="s2">&quot;received_time&quot;</span><span class="p">:</span> <span class="n">fetched</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;receivedDateTime&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;mail_adress&quot;</span><span class="p">:</span> <span class="n">mailbox_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">),</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outbox_list</span><span class="p">):</span>
                        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Inbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Inbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;folder: </span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">76</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">  messages: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">api_connection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mailbox_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">request_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
        <span class="n">address_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>
        <span class="n">outbox_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download all the messages stored in a MailBox folder and subfolders.</span>

<span class="sd">        Args:</span>
<span class="sd">            mailbox_name (Optional[str], optional): Mailbox name. Defaults to None.</span>
<span class="sd">            request_retries (int, optional): How many times retries to authorizate.</span>
<span class="sd">                Defaults to 10.</span>
<span class="sd">            start_date (Optional[str], optional): A filtering start date parameter e.g.</span>
<span class="sd">                &quot;2022-01-01&quot;. Defaults to None.</span>
<span class="sd">            end_date (Optional[str], optional): A filtering end date parameter e.g.</span>
<span class="sd">                &quot;2022-01-02&quot;. Defaults to None.</span>
<span class="sd">            limit (int, optional): Number of fetched top messages. Defaults to 10000.</span>
<span class="sd">            address_limit (int, optional): The maximum number of accepted characters in</span>
<span class="sd">                the sum of all email names. Defaults to 8000.</span>
<span class="sd">            outbox_list (List[str], optional): List of outbox folders to differentiate</span>
<span class="sd">                between Inboxes and Outboxes. Defaults to [&quot;Sent Items&quot;].</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: All messages are stored in a pandas framework.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">outbox_list</span><span class="p">:</span>
            <span class="n">outbox_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Sent Items&quot;</span><span class="p">]</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;client_id&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;client_secret&quot;</span><span class="p">]),</span>
            <span class="n">auth_flow_type</span><span class="o">=</span><span class="s2">&quot;credentials&quot;</span><span class="p">,</span>
            <span class="n">tenant_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;tenant_id&quot;</span><span class="p">],</span>
            <span class="n">main_resource</span><span class="o">=</span><span class="n">mailbox_name</span><span class="p">,</span>
            <span class="n">request_retries</span><span class="o">=</span><span class="n">request_retries</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">account</span><span class="o">.</span><span class="n">authenticate</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mailbox_name</span><span class="si">}</span><span class="s2"> Authenticated!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed to authenticate.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">mailbox_obj</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">mailbox</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date_range_end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">date_range_start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">date_range_start_time</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">date_range_end_time</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>

            <span class="n">min_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">date_range_end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date_range_end_time</span><span class="p">,</span> <span class="n">min_time</span><span class="p">)</span>
            <span class="n">date_range_start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date_range_start_time</span><span class="p">,</span> <span class="n">min_time</span><span class="p">)</span>

        <span class="n">final_dict_folders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_folders</span><span class="p">(</span><span class="n">mailbox_obj</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_messages_from_mailbox</span><span class="p">(</span>
            <span class="n">mailbox_name</span><span class="o">=</span><span class="n">mailbox_name</span><span class="p">,</span>
            <span class="n">dict_folder</span><span class="o">=</span><span class="n">final_dict_folders</span><span class="p">,</span>
            <span class="n">date_range_start_time</span><span class="o">=</span><span class="n">date_range_start_time</span><span class="p">,</span>
            <span class="n">date_range_end_time</span><span class="o">=</span><span class="n">date_range_end_time</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">address_limit</span><span class="o">=</span><span class="n">address_limit</span><span class="p">,</span>
            <span class="n">outbox_list</span><span class="o">=</span><span class="n">outbox_list</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@add_viadot_metadata_columns</span>
    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a pandas DataFrame with the data.</span>

<span class="sd">        Args:</span>
<span class="sd">            if_empty (str, optional): What to do if a fetch produce no data.</span>
<span class="sd">                Defaults to &quot;warn</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.Dataframe: The response data as a pandas DataFrame plus viadot metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">)</span>

        <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span>
                <span class="n">if_empty</span><span class="o">=</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No data was got from the Mail Box for those days&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully downloaded data from the Mindful API.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_frame</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.outlook.Outlook.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_key</span><span class="o">=</span><span class="s1">&#39;outlook&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Outlook connector build for fetching Outlook API source.</p>
<p>Data are fetched from start to end date range. If start or end date are not
provided then flow fetched data from yesterday by default.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>credentials</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="viadot.sources.outlook.OutlookCredentials">OutlookCredentials</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Outlook credentials.
Defaults to None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key in the viadot config holding relevant
credentials. Defaults to "outlook".</p>
              </div>
            </td>
            <td>
                  <code>&#39;outlook&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>outlook = Outlook(
    config_key=config_key,
)
outlook.api_connection(
    mailbox_name=mailbox_name,
    request_retries=request_retries,
    start_date=start_date,
    end_date=end_date,
    limit=limit,
    address_limit=address_limit,
    outbox_list=outbox_list,
)
data_frame = outlook.to_df()</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="CredentialError">CredentialError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If credentials are not provided in local_config or
directly as a parameter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/outlook.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;outlook&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Outlook connector build for fetching Outlook API source.</span>

<span class="sd">    Data are fetched from start to end date range. If start or end date are not</span>
<span class="sd">    provided then flow fetched data from yesterday by default.</span>

<span class="sd">    Args:</span>
<span class="sd">        credentials (Optional[OutlookCredentials], optional): Outlook credentials.</span>
<span class="sd">            Defaults to None</span>
<span class="sd">        config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">            credentials. Defaults to &quot;outlook&quot;.</span>

<span class="sd">    Examples:</span>
<span class="sd">        outlook = Outlook(</span>
<span class="sd">            config_key=config_key,</span>
<span class="sd">        )</span>
<span class="sd">        outlook.api_connection(</span>
<span class="sd">            mailbox_name=mailbox_name,</span>
<span class="sd">            request_retries=request_retries,</span>
<span class="sd">            start_date=start_date,</span>
<span class="sd">            end_date=end_date,</span>
<span class="sd">            limit=limit,</span>
<span class="sd">            address_limit=address_limit,</span>
<span class="sd">            outbox_list=outbox_list,</span>
<span class="sd">        )</span>
<span class="sd">        data_frame = outlook.to_df()</span>

<span class="sd">    Raises:</span>
<span class="sd">        CredentialError: If credentials are not provided in local_config or</span>
<span class="sd">            directly as a parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
    <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">OutlookCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.outlook.Outlook.api_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">api_connection</span><span class="p">(</span><span class="n">mailbox_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">request_retries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">address_limit</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">outbox_list</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download all the messages stored in a MailBox folder and subfolders.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mailbox_name</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mailbox name. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>request_retries</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many times retries to authorizate.
Defaults to 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_date</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A filtering start date parameter e.g.
"2022-01-01". Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A filtering end date parameter e.g.
"2022-01-02". Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of fetched top messages. Defaults to 10000.</p>
              </div>
            </td>
            <td>
                  <code>10000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>address_limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of accepted characters in
the sum of all email names. Defaults to 8000.</p>
              </div>
            </td>
            <td>
                  <code>8000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>outbox_list</code>
            </td>
            <td>
                  <code><span title="List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of outbox folders to differentiate
between Inboxes and Outboxes. Defaults to ["Sent Items"].</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: All messages are stored in a pandas framework.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/outlook.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">api_connection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">mailbox_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">request_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="n">address_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>
    <span class="n">outbox_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download all the messages stored in a MailBox folder and subfolders.</span>

<span class="sd">    Args:</span>
<span class="sd">        mailbox_name (Optional[str], optional): Mailbox name. Defaults to None.</span>
<span class="sd">        request_retries (int, optional): How many times retries to authorizate.</span>
<span class="sd">            Defaults to 10.</span>
<span class="sd">        start_date (Optional[str], optional): A filtering start date parameter e.g.</span>
<span class="sd">            &quot;2022-01-01&quot;. Defaults to None.</span>
<span class="sd">        end_date (Optional[str], optional): A filtering end date parameter e.g.</span>
<span class="sd">            &quot;2022-01-02&quot;. Defaults to None.</span>
<span class="sd">        limit (int, optional): Number of fetched top messages. Defaults to 10000.</span>
<span class="sd">        address_limit (int, optional): The maximum number of accepted characters in</span>
<span class="sd">            the sum of all email names. Defaults to 8000.</span>
<span class="sd">        outbox_list (List[str], optional): List of outbox folders to differentiate</span>
<span class="sd">            between Inboxes and Outboxes. Defaults to [&quot;Sent Items&quot;].</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: All messages are stored in a pandas framework.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">outbox_list</span><span class="p">:</span>
        <span class="n">outbox_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Sent Items&quot;</span><span class="p">]</span>
    <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;client_id&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;client_secret&quot;</span><span class="p">]),</span>
        <span class="n">auth_flow_type</span><span class="o">=</span><span class="s2">&quot;credentials&quot;</span><span class="p">,</span>
        <span class="n">tenant_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;tenant_id&quot;</span><span class="p">],</span>
        <span class="n">main_resource</span><span class="o">=</span><span class="n">mailbox_name</span><span class="p">,</span>
        <span class="n">request_retries</span><span class="o">=</span><span class="n">request_retries</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">account</span><span class="o">.</span><span class="n">authenticate</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mailbox_name</span><span class="si">}</span><span class="s2"> Authenticated!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed to authenticate.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">mailbox_obj</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">mailbox</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">date_range_end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">date_range_start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">date_range_start_time</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">date_range_end_time</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>

        <span class="n">min_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">date_range_end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date_range_end_time</span><span class="p">,</span> <span class="n">min_time</span><span class="p">)</span>
        <span class="n">date_range_start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date_range_start_time</span><span class="p">,</span> <span class="n">min_time</span><span class="p">)</span>

    <span class="n">final_dict_folders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_folders</span><span class="p">(</span><span class="n">mailbox_obj</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_messages_from_mailbox</span><span class="p">(</span>
        <span class="n">mailbox_name</span><span class="o">=</span><span class="n">mailbox_name</span><span class="p">,</span>
        <span class="n">dict_folder</span><span class="o">=</span><span class="n">final_dict_folders</span><span class="p">,</span>
        <span class="n">date_range_start_time</span><span class="o">=</span><span class="n">date_range_start_time</span><span class="p">,</span>
        <span class="n">date_range_end_time</span><span class="o">=</span><span class="n">date_range_end_time</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
        <span class="n">address_limit</span><span class="o">=</span><span class="n">address_limit</span><span class="p">,</span>
        <span class="n">outbox_list</span><span class="o">=</span><span class="n">outbox_list</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.outlook.Outlook.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a pandas DataFrame with the data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>if_empty</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What to do if a fetch produce no data.
Defaults to "warn</p>
              </div>
            </td>
            <td>
                  <code>&#39;warn&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.Dataframe: The response data as a pandas DataFrame plus viadot metadata.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/outlook.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_viadot_metadata_columns</span>
<span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a pandas DataFrame with the data.</span>

<span class="sd">    Args:</span>
<span class="sd">        if_empty (str, optional): What to do if a fetch produce no data.</span>
<span class="sd">            Defaults to &quot;warn</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.Dataframe: The response data as a pandas DataFrame plus viadot metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">)</span>

    <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span>
            <span class="n">if_empty</span><span class="o">=</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No data was got from the Mail Box for those days&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully downloaded data from the Mindful API.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data_frame</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.salesforce.Salesforce" class="doc doc-heading">
            <code>viadot.sources.salesforce.Salesforce</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>


        <p>Class implementing the Salesforce API.</p>


<details class="documentation-for-this-api-is-available-at" open>
  <summary>Documentation for this API is available at</summary>
  <p>https://developer.salesforce.com/docs/apis.</p>
</details>






              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/salesforce.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Salesforce</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class implementing the Salesforce API.</span>

<span class="sd">    Documentation for this API is available at:</span>
<span class="sd">        https://developer.salesforce.com/docs/apis.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">SalesforceCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;salesforce&quot;</span><span class="p">,</span>
        <span class="n">env</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;DEV&quot;</span><span class="p">,</span> <span class="s2">&quot;QA&quot;</span><span class="p">,</span> <span class="s2">&quot;PROD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DEV&quot;</span><span class="p">,</span>
        <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
        <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;viadot&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A class for downloading data from Salesforce.</span>

<span class="sd">        Args:</span>
<span class="sd">            credentials (dict(str, any), optional): Salesforce credentials as a</span>
<span class="sd">                dictionary. Defaults to None.</span>
<span class="sd">            config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">                credentials. Defaults to &quot;salesforce&quot;.</span>
<span class="sd">            env (Literal[&quot;DEV&quot;, &quot;QA&quot;, &quot;PROD&quot;], optional): Environment information,</span>
<span class="sd">                provides information about credential and connection configuration.</span>
<span class="sd">                Defaults to &#39;DEV&#39;.</span>
<span class="sd">            domain (str, optional): Domain of a connection. Defaults to &#39;test&#39;</span>
<span class="sd">                (sandbox). Can only be added if a username/password/security token</span>
<span class="sd">                is provided.</span>
<span class="sd">            client_id (str, optional): Client id, keep track of API calls.</span>
<span class="sd">                Defaults to &#39;viadot&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;token&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&#39;username&#39;, &#39;password&#39; and &#39;token&#39; credentials are required.&quot;</span>
            <span class="k">raise</span> <span class="n">CredentialError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">SalesforceCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">credentials</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;DEV&quot;</span> <span class="ow">or</span> <span class="n">env</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;QA&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">salesforce</span> <span class="o">=</span> <span class="n">SimpleSalesforce</span><span class="p">(</span>
                <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">],</span>
                <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">],</span>
                <span class="n">security_token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;token&quot;</span><span class="p">],</span>
                <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
                <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">env</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PROD&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">salesforce</span> <span class="o">=</span> <span class="n">SimpleSalesforce</span><span class="p">(</span>
                <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">],</span>
                <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">],</span>
                <span class="n">security_token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;token&quot;</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;The only available environments are DEV, QA, and PROD.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="nd">@add_viadot_metadata_columns</span>
    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">if_empty</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Downloads data from Salesforce API and returns the DataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            if_empty (str, optional): What to do if a fetch produce no data.</span>
<span class="sd">                Defaults to &quot;warn</span>
<span class="sd">            query (str, optional): The query to be used to download the data.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            table (str, optional): Table name. Defaults to None.</span>
<span class="sd">            columns (list[str], optional): List of required columns. Requires `table`</span>
<span class="sd">                to be specified. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Selected rows from Salesforce.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span><span class="p">:</span>
            <span class="n">columns_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="k">if</span> <span class="n">columns</span> <span class="k">else</span> <span class="s2">&quot;FIELDS(STANDARD)&quot;</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT </span><span class="si">{</span><span class="n">columns_str</span><span class="si">}</span><span class="s2"> FROM </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># noqa: S608</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salesforce</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>

        <span class="c1"># Remove metadata from the data</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span>
                <span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;The response does not contain any data.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully downloaded data from the Salesforce API.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">upsert</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">external_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">raise_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Upsert data into Salesforce.</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pd.DataFrame): Selected rows from Salesforce.</span>
<span class="sd">            table (str): Table name.</span>
<span class="sd">            external_id (str, optional): External ID. Defaults to None.</span>
<span class="sd">            raise_on_error (bool, optional): Whether to raise on error.</span>
<span class="sd">                Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if all records where processed successfully. None when df empty.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the external_id is provided but not found in the DataFrame.</span>
<span class="sd">            ValueError: If upserting a record fails and raise_on_error is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">external_id</span> <span class="ow">and</span> <span class="n">external_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Passed DataFrame does not contain column &#39;</span><span class="si">{</span><span class="n">external_id</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">table_to_upsert</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salesforce</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
        <span class="n">records</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
        <span class="n">records_cp</span> <span class="o">=</span> <span class="n">records</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records_cp</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">external_id</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">record</span><span class="p">[</span><span class="n">external_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">merge_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">external_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">record</span><span class="p">[</span><span class="n">external_id</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">record</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">external_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">merge_key</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;Id&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">table_to_upsert</span><span class="o">.</span><span class="n">upsert</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">record</span><span class="p">,</span> <span class="n">record_id</span><span class="o">=</span><span class="n">merge_key</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">SalesforceMalformedRequest</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Upsert of record </span><span class="si">{</span><span class="n">merge_key</span><span class="si">}</span><span class="s2"> failed.&quot;</span>
                <span class="k">if</span> <span class="n">raise_on_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">codes</span> <span class="o">=</span> <span class="p">{</span><span class="mi">200</span><span class="p">:</span> <span class="s2">&quot;updated&quot;</span><span class="p">,</span> <span class="mi">201</span><span class="p">:</span> <span class="s2">&quot;created&quot;</span><span class="p">,</span> <span class="mi">204</span><span class="p">:</span> <span class="s2">&quot;updated&quot;</span><span class="p">}</span>

            <span class="k">if</span> <span class="n">response</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Upsert failed for record: </span><span class="se">\n</span><span class="si">{</span><span class="n">record</span><span class="si">}</span><span class="s2"> with response </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">raise_on_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully </span><span class="si">{</span><span class="n">codes</span><span class="p">[</span><span class="n">response</span><span class="p">]</span><span class="si">}</span><span class="s2"> record </span><span class="si">{</span><span class="n">merge_key</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Successfully upserted </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span><span class="si">}</span><span class="s2"> records into table &#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.salesforce.Salesforce.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_key</span><span class="o">=</span><span class="s1">&#39;salesforce&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="s1">&#39;DEV&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="s1">&#39;viadot&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A class for downloading data from Salesforce.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>credentials</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>(<span title="str">str</span>, <span title="any">any</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Salesforce credentials as a
dictionary. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key in the viadot config holding relevant
credentials. Defaults to "salesforce".</p>
              </div>
            </td>
            <td>
                  <code>&#39;salesforce&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>env</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;DEV&#39;, &#39;QA&#39;, &#39;PROD&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment information,
provides information about credential and connection configuration.
Defaults to 'DEV'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;DEV&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>domain</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Domain of a connection. Defaults to 'test'
(sandbox). Can only be added if a username/password/security token
is provided.</p>
              </div>
            </td>
            <td>
                  <code>&#39;test&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Client id, keep track of API calls.
Defaults to 'viadot'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;viadot&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/salesforce.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="n">SalesforceCredentials</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;salesforce&quot;</span><span class="p">,</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;DEV&quot;</span><span class="p">,</span> <span class="s2">&quot;QA&quot;</span><span class="p">,</span> <span class="s2">&quot;PROD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DEV&quot;</span><span class="p">,</span>
    <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
    <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;viadot&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class for downloading data from Salesforce.</span>

<span class="sd">    Args:</span>
<span class="sd">        credentials (dict(str, any), optional): Salesforce credentials as a</span>
<span class="sd">            dictionary. Defaults to None.</span>
<span class="sd">        config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">            credentials. Defaults to &quot;salesforce&quot;.</span>
<span class="sd">        env (Literal[&quot;DEV&quot;, &quot;QA&quot;, &quot;PROD&quot;], optional): Environment information,</span>
<span class="sd">            provides information about credential and connection configuration.</span>
<span class="sd">            Defaults to &#39;DEV&#39;.</span>
<span class="sd">        domain (str, optional): Domain of a connection. Defaults to &#39;test&#39;</span>
<span class="sd">            (sandbox). Can only be added if a username/password/security token</span>
<span class="sd">            is provided.</span>
<span class="sd">        client_id (str, optional): Client id, keep track of API calls.</span>
<span class="sd">            Defaults to &#39;viadot&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
        <span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;token&quot;</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&#39;username&#39;, &#39;password&#39; and &#39;token&#39; credentials are required.&quot;</span>
        <span class="k">raise</span> <span class="n">CredentialError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">SalesforceCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">credentials</span><span class="p">))</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;DEV&quot;</span> <span class="ow">or</span> <span class="n">env</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;QA&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">salesforce</span> <span class="o">=</span> <span class="n">SimpleSalesforce</span><span class="p">(</span>
            <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">],</span>
            <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">],</span>
            <span class="n">security_token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;token&quot;</span><span class="p">],</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
            <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">env</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PROD&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">salesforce</span> <span class="o">=</span> <span class="n">SimpleSalesforce</span><span class="p">(</span>
            <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">],</span>
            <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">],</span>
            <span class="n">security_token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;token&quot;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;The only available environments are DEV, QA, and PROD.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.salesforce.Salesforce.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">if_empty</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Downloads data from Salesforce API and returns the DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>if_empty</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What to do if a fetch produce no data.
Defaults to "warn</p>
              </div>
            </td>
            <td>
                  <code>&#39;warn&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The query to be used to download the data.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table name. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>columns</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of required columns. Requires <code>table</code>
to be specified. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Selected rows from Salesforce.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/salesforce.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_viadot_metadata_columns</span>
<span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">if_empty</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Downloads data from Salesforce API and returns the DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        if_empty (str, optional): What to do if a fetch produce no data.</span>
<span class="sd">            Defaults to &quot;warn</span>
<span class="sd">        query (str, optional): The query to be used to download the data.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        table (str, optional): Table name. Defaults to None.</span>
<span class="sd">        columns (list[str], optional): List of required columns. Requires `table`</span>
<span class="sd">            to be specified. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Selected rows from Salesforce.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span><span class="p">:</span>
        <span class="n">columns_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="k">if</span> <span class="n">columns</span> <span class="k">else</span> <span class="s2">&quot;FIELDS(STANDARD)&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT </span><span class="si">{</span><span class="n">columns_str</span><span class="si">}</span><span class="s2"> FROM </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># noqa: S608</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salesforce</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>

    <span class="c1"># Remove metadata from the data</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">record</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span>
            <span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;The response does not contain any data.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully downloaded data from the Salesforce API.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.salesforce.Salesforce.upsert" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upsert</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">external_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raise_on_error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Upsert data into Salesforce.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Selected rows from Salesforce.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>external_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>External ID. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raise_on_error</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to raise on error.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if all records where processed successfully. None when df empty.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the external_id is provided but not found in the DataFrame.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If upserting a record fails and raise_on_error is True.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/salesforce.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">upsert</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">external_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">raise_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Upsert data into Salesforce.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): Selected rows from Salesforce.</span>
<span class="sd">        table (str): Table name.</span>
<span class="sd">        external_id (str, optional): External ID. Defaults to None.</span>
<span class="sd">        raise_on_error (bool, optional): Whether to raise on error.</span>
<span class="sd">            Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if all records where processed successfully. None when df empty.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the external_id is provided but not found in the DataFrame.</span>
<span class="sd">        ValueError: If upserting a record fails and raise_on_error is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">external_id</span> <span class="ow">and</span> <span class="n">external_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Passed DataFrame does not contain column &#39;</span><span class="si">{</span><span class="n">external_id</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">table_to_upsert</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salesforce</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
    <span class="n">records</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
    <span class="n">records_cp</span> <span class="o">=</span> <span class="n">records</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records_cp</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">external_id</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">record</span><span class="p">[</span><span class="n">external_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">merge_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">external_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">record</span><span class="p">[</span><span class="n">external_id</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">record</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">external_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">merge_key</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;Id&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">table_to_upsert</span><span class="o">.</span><span class="n">upsert</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">record</span><span class="p">,</span> <span class="n">record_id</span><span class="o">=</span><span class="n">merge_key</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">SalesforceMalformedRequest</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Upsert of record </span><span class="si">{</span><span class="n">merge_key</span><span class="si">}</span><span class="s2"> failed.&quot;</span>
            <span class="k">if</span> <span class="n">raise_on_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">codes</span> <span class="o">=</span> <span class="p">{</span><span class="mi">200</span><span class="p">:</span> <span class="s2">&quot;updated&quot;</span><span class="p">,</span> <span class="mi">201</span><span class="p">:</span> <span class="s2">&quot;created&quot;</span><span class="p">,</span> <span class="mi">204</span><span class="p">:</span> <span class="s2">&quot;updated&quot;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">response</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Upsert failed for record: </span><span class="se">\n</span><span class="si">{</span><span class="n">record</span><span class="si">}</span><span class="s2"> with response </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">raise_on_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully </span><span class="si">{</span><span class="n">codes</span><span class="p">[</span><span class="n">response</span><span class="p">]</span><span class="si">}</span><span class="s2"> record </span><span class="si">{</span><span class="n">merge_key</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Successfully upserted </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span><span class="si">}</span><span class="s2"> records into table &#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.sharepoint.Sharepoint" class="doc doc-heading">
            <code>viadot.sources.sharepoint.Sharepoint</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>








              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/sharepoint.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Sharepoint</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
    <span class="n">DEFAULT_NA_VALUES</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">STR_NA_VALUES</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">SharepointCredentials</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download Excel files from Sharepoint.</span>

<span class="sd">        Args:</span>
<span class="sd">        credentials (SharepointCredentials): Sharepoint credentials.</span>
<span class="sd">        config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">            credentials.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">SharepointCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sharepy</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">SharePointSession</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Establishe a connection to SharePoint.</span>

<span class="sd">        Returns:</span>
<span class="sd">            sharepy.session.SharePointSession: A session object representing</span>
<span class="sd">                the authenticated connection.</span>

<span class="sd">        Raises:</span>
<span class="sd">            CredentialError: If authentication to SharePoint fails due to incorrect</span>
<span class="sd">                credentials.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="n">sharepy</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">site</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;site&quot;</span><span class="p">),</span>
                <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">),</span>
                <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">AuthError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">site</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;site&quot;</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Could not authenticate to </span><span class="si">{</span><span class="n">site</span><span class="si">}</span><span class="s2"> with provided credentials.&quot;</span>
            <span class="k">raise</span> <span class="n">CredentialError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="k">return</span> <span class="n">connection</span>

    <span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">to_path</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download a file from Sharepoint to specific location.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): The URL of the file to be downloaded.</span>
<span class="sd">            to_path (str): Where to download the file.</span>

<span class="sd">        Example:</span>
<span class="sd">            download_file(</span>
<span class="sd">                url=&quot;https://{tenant_name}.sharepoint.com/sites/{directory}/Shared%20Documents/Dashboard/file&quot;,</span>
<span class="sd">                to_path=&quot;file.xlsx&quot;</span>
<span class="sd">            )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">to_path</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">scan_sharepoint_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Scan Sharepoint folder to get all file URLs of all files within it.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): The URL of the folder to scan.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the provided URL does not contain the expected &#39;/sites/&#39;</span>
<span class="sd">                segment.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: List of URLs pointing to each file within the specified</span>
<span class="sd">                SharePoint folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span>

        <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">path_parts</span> <span class="o">=</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;sites&quot;</span> <span class="ow">in</span> <span class="n">path_parts</span><span class="p">:</span>
            <span class="n">site_index</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">path_parts</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;sites&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="p">)</span>  <span class="c1"># +2 to include &#39;sites&#39; and the next segment</span>
            <span class="n">site_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span><span class="si">}{</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_parts</span><span class="p">[:</span><span class="n">site_index</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">library</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_parts</span><span class="p">[</span><span class="n">site_index</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;URL does not contain &#39;/sites/&#39; segment.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="c1"># -&gt; site_url = company.sharepoint.com/sites/site_name/</span>
        <span class="c1"># -&gt; library = /shared_documents/folder/sub_folder/final_folder</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">site_url</span><span class="si">}</span><span class="s2">/_api/web/GetFolderByServerRelativeUrl(&#39;</span><span class="si">{</span><span class="n">library</span><span class="si">}</span><span class="s2">&#39;)/Files&quot;</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">site_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">library</span><span class="si">}{</span><span class="n">file</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_file_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the file extension from a given URL.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            url (str): The URL from which to extract the file extension.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The file extension, including the leading dot (e.g., &#39;.xlsx&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Parse the URL to get the path</span>
        <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span>

    <span class="k">def</span> <span class="nf">_download_file_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download the contents of a file from SharePoint.</span>

<span class="sd">        Returns the data as an in-memory byte stream.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): The URL of the file to download.</span>

<span class="sd">        Returns:</span>
<span class="sd">            io.BytesIO: An in-memory byte stream containing the file content.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;nrows&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Parameter &#39;nrows&#39; is not supported.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading data from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Raise an exception for HTTP errors</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">FORBIDDEN</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access denied to file: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HTTP error when accessing </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to download file: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="n">bytes_stream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="n">bytes_stream</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid Excel file: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">_is_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determines whether a provided URL points to a file based on its structure.</span>

<span class="sd">        This function uses a regular expression to check if the URL ends with a</span>
<span class="sd">        common file extension. It does not make any network requests and purely</span>
<span class="sd">        relies on the URL structure for its determination.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        url (str): The URL to be checked.</span>

<span class="sd">        Returns:</span>
<span class="sd">        bool: True if the URL is identified as a file based on its extension,</span>
<span class="sd">            False otherwise.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; _is_file(&quot;https://example.com/file.xlsx&quot;)</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; _is_file(&quot;https://example.com/folder/&quot;)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; _is_file(&quot;https://example.com/folder&quot;)</span>
<span class="sd">        False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Regular expression for matching file extensions</span>
        <span class="n">file_extension_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\.[a-zA-Z0-9]+$&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">file_extension_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_handle_multiple_files</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">file_sheet_mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">na_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle downloading and parsing multiple Excel files from a SharePoint folder.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): The base URL of the SharePoint folder containing the files.</span>
<span class="sd">            file_sheet_mapping (dict): A dictionary mapping file names to sheet names</span>
<span class="sd">                or indexes. The keys are file names, and the values are sheet</span>
<span class="sd">                names/indices.</span>
<span class="sd">            na_values (Optional[list[str]]): Additional strings to recognize as NA/NaN.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A concatenated DataFrame containing the data from all</span>
<span class="sd">                specified files and sheets.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the file extension is not supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file</span><span class="p">,</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="n">file_sheet_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">file_url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="n">file</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_and_parse</span><span class="p">(</span>
                    <span class="n">file_url</span><span class="o">=</span><span class="n">file_url</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="n">na_values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>
                <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load file: </span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dfs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No valid Excel files were loaded.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">validate_and_reorder_dfs_columns</span><span class="p">(</span><span class="n">dfs</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_load_and_parse</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">file_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">sheet_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">na_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads and parses an Excel file from a URL.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_url (str): The URL of the file to download and parse.</span>
<span class="sd">            sheet_name (Optional[Union[str, list[str]]]): The name(s) or index(es) of</span>
<span class="sd">                the sheet(s) to parse. If None, all sheets are parsed.</span>
<span class="sd">            na_values (Optional[list[str]]): Additional strings to recognize as NA/NaN.</span>
<span class="sd">            **kwargs: Additional keyword arguments to pass to the pandas read function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: The parsed data as a pandas DataFrame.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the file extension is not supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_extension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_file_extension</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_extension</span> <span class="o">!=</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unsupported file extension: </span><span class="si">{</span><span class="n">file_extension</span><span class="si">}</span><span class="s2"> for file: </span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Only Excel (.xlsx) files are supported.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">file_stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_file_stream</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_excel</span><span class="p">(</span><span class="n">file_stream</span><span class="p">,</span> <span class="n">sheet_name</span><span class="p">,</span> <span class="n">na_values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_excel</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">excel_file</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">,</span>
        <span class="n">sheet_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">na_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parses an Excel file into a DataFrame. Casts all columns to string.</span>

<span class="sd">        Args:</span>
<span class="sd">            excel_file: An ExcelFile object containing the data to parse.</span>
<span class="sd">            sheet_name (Optional[Union[str, list[str]]]): The name(s) or index(es) of</span>
<span class="sd">                the sheet(s) to parse. If None, all sheets are parsed.</span>
<span class="sd">            na_values (Optional[list[str]]): Additional strings to recognize as NA/NaN.</span>
<span class="sd">            **kwargs: Additional keyword arguments to pass to the pandas read function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: The parsed data as a pandas DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">excel_file</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
                    <span class="n">sheet</span><span class="p">,</span>
                    <span class="n">keep_default_na</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">na_values</span><span class="o">=</span><span class="n">na_values</span> <span class="ow">or</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_NA_VALUES</span><span class="p">),</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>  <span class="c1"># Ensure all columns are read as strings</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="p">([</span><span class="n">sheet_name</span><span class="p">]</span> <span class="k">if</span> <span class="n">sheet_name</span> <span class="k">else</span> <span class="n">excel_file</span><span class="o">.</span><span class="n">sheet_names</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="nd">@add_viadot_metadata_columns</span>
    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">sheet_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">if_empty</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
        <span class="n">tests</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">file_sheet_mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">na_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load an Excel file or files from a SharePoint URL into a pandas DataFrame.</span>

<span class="sd">        This method handles downloading the file(s), parsing the content, and converting</span>
<span class="sd">        it into a pandas DataFrame. It supports both single file URLs and folder URLs</span>
<span class="sd">        with multiple files.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): The URL of the file to be downloaded.</span>
<span class="sd">            sheet_name (Optional[Union[str, list, int]], optional): Strings are used for</span>
<span class="sd">                sheet names. Integers are used in zero-indexed sheet positions (chart</span>
<span class="sd">                sheets do not count as a sheet position). Lists of strings/integers are</span>
<span class="sd">                used to request multiple sheets. Specify None to get all worksheets.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            if_empty (Literal[&quot;warn&quot;, &quot;skip&quot;, &quot;fail&quot;], optional): Action to take if</span>
<span class="sd">                the DataFrame is empty.</span>
<span class="sd">                - &quot;warn&quot;: Logs a warning.</span>
<span class="sd">                - &quot;skip&quot;: Skips the operation.</span>
<span class="sd">                - &quot;fail&quot;: Raises an error.</span>
<span class="sd">                Defaults to &quot;warn&quot;.</span>
<span class="sd">            tests (Dict[str, Any], optional): A dictionary with optional list of tests</span>
<span class="sd">                to verify the output dataframe. If defined, triggers the `validate`</span>
<span class="sd">                function from utils. Defaults to None.</span>
<span class="sd">            file_sheet_mapping (dict[str, Union[str, int, list[str]]], optional):</span>
<span class="sd">                Mapping of file names to sheet names or indices. The keys are file names</span>
<span class="sd">                and the values are sheet names/indices. Used when multiple files are</span>
<span class="sd">                involved. Defaults to None.</span>
<span class="sd">            na_values (list[str], optional): Additional strings to recognize as NA/NaN.</span>
<span class="sd">                If list passed, the specific NA values for each column will be</span>
<span class="sd">                recognized. Defaults to None.</span>
<span class="sd">            kwargs (dict[str, Any], optional): Keyword arguments to pass to</span>
<span class="sd">                pd.ExcelFile.parse(). Note that `nrows` is not supported.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: The resulting data as a pandas DataFrame.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the file extension is not supported or if `if_empty` is set</span>
<span class="sd">                to &quot;fail&quot; and the DataFrame is empty.</span>
<span class="sd">            SKIP: If `if_empty` is set to &quot;skip&quot; and the DataFrame is empty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_file</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_and_parse</span><span class="p">(</span>
                <span class="n">file_url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="n">na_values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">file_sheet_mapping</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_multiple_files</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                <span class="n">file_sheet_mapping</span><span class="o">=</span><span class="n">file_sheet_mapping</span><span class="p">,</span>
                <span class="n">na_values</span><span class="o">=</span><span class="n">na_values</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">list_of_urls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_sharepoint_folder</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">excel_urls</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">file_url</span>
                <span class="k">for</span> <span class="n">file_url</span> <span class="ow">in</span> <span class="n">list_of_urls</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_file_extension</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;.xlsx&quot;</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">excel_urls</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No Excel files found in folder: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_load_and_parse</span><span class="p">(</span>
                    <span class="n">file_url</span><span class="o">=</span><span class="n">file_url</span><span class="p">,</span>
                    <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">,</span>
                    <span class="n">na_values</span><span class="o">=</span><span class="n">na_values</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">file_url</span> <span class="ow">in</span> <span class="n">excel_urls</span>
            <span class="p">]</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">validate_and_reorder_dfs_columns</span><span class="p">(</span><span class="n">dfs</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span><span class="n">if_empty</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">SKIP</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully downloaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows of data.&quot;</span><span class="p">)</span>

        <span class="n">df_clean</span> <span class="o">=</span> <span class="n">cleanup_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tests</span><span class="p">:</span>
            <span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df_clean</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="n">tests</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df_clean</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.sharepoint.Sharepoint.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download Excel files from Sharepoint.</p>
<p>Args:
credentials (SharepointCredentials): Sharepoint credentials.
config_key (str, optional): The key in the viadot config holding relevant
    credentials.</p>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/sharepoint.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="n">SharepointCredentials</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download Excel files from Sharepoint.</span>

<span class="sd">    Args:</span>
<span class="sd">    credentials (SharepointCredentials): Sharepoint credentials.</span>
<span class="sd">    config_key (str, optional): The key in the viadot config holding relevant</span>
<span class="sd">        credentials.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">SharepointCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.sharepoint.Sharepoint.download_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">to_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download a file from Sharepoint to specific location.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL of the file to be downloaded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where to download the file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>download_file(
    url="https://{tenant_name}.sharepoint.com/sites/{directory}/Shared%20Documents/Dashboard/file",
    to_path="file.xlsx"
)</p>
</details>

            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/sharepoint.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">to_path</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download a file from Sharepoint to specific location.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): The URL of the file to be downloaded.</span>
<span class="sd">        to_path (str): Where to download the file.</span>

<span class="sd">    Example:</span>
<span class="sd">        download_file(</span>
<span class="sd">            url=&quot;https://{tenant_name}.sharepoint.com/sites/{directory}/Shared%20Documents/Dashboard/file&quot;,</span>
<span class="sd">            to_path=&quot;file.xlsx&quot;</span>
<span class="sd">        )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">to_path</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.sharepoint.Sharepoint.get_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_connection</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Establishe a connection to SharePoint.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="sharepy.session.SharePointSession">SharePointSession</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>sharepy.session.SharePointSession: A session object representing
the authenticated connection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="viadot.exceptions.CredentialError">CredentialError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If authentication to SharePoint fails due to incorrect
credentials.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/sharepoint.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sharepy</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">SharePointSession</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Establishe a connection to SharePoint.</span>

<span class="sd">    Returns:</span>
<span class="sd">        sharepy.session.SharePointSession: A session object representing</span>
<span class="sd">            the authenticated connection.</span>

<span class="sd">    Raises:</span>
<span class="sd">        CredentialError: If authentication to SharePoint fails due to incorrect</span>
<span class="sd">            credentials.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">sharepy</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">site</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;site&quot;</span><span class="p">),</span>
            <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">),</span>
            <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">AuthError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">site</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;site&quot;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Could not authenticate to </span><span class="si">{</span><span class="n">site</span><span class="si">}</span><span class="s2"> with provided credentials.&quot;</span>
        <span class="k">raise</span> <span class="n">CredentialError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
    <span class="k">return</span> <span class="n">connection</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.sharepoint.Sharepoint.scan_sharepoint_folder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scan_sharepoint_folder</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Scan Sharepoint folder to get all file URLs of all files within it.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL of the folder to scan.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the provided URL does not contain the expected '/sites/'
segment.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[str]: List of URLs pointing to each file within the specified
SharePoint folder.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/sharepoint.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">scan_sharepoint_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scan Sharepoint folder to get all file URLs of all files within it.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): The URL of the folder to scan.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the provided URL does not contain the expected &#39;/sites/&#39;</span>
<span class="sd">            segment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[str]: List of URLs pointing to each file within the specified</span>
<span class="sd">            SharePoint folder.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span>

    <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">path_parts</span> <span class="o">=</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;sites&quot;</span> <span class="ow">in</span> <span class="n">path_parts</span><span class="p">:</span>
        <span class="n">site_index</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">path_parts</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;sites&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="p">)</span>  <span class="c1"># +2 to include &#39;sites&#39; and the next segment</span>
        <span class="n">site_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span><span class="si">}{</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_parts</span><span class="p">[:</span><span class="n">site_index</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">library</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_parts</span><span class="p">[</span><span class="n">site_index</span><span class="p">:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;URL does not contain &#39;/sites/&#39; segment.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="c1"># -&gt; site_url = company.sharepoint.com/sites/site_name/</span>
    <span class="c1"># -&gt; library = /shared_documents/folder/sub_folder/final_folder</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">site_url</span><span class="si">}</span><span class="s2">/_api/web/GetFolderByServerRelativeUrl(&#39;</span><span class="si">{</span><span class="n">library</span><span class="si">}</span><span class="s2">&#39;)/Files&quot;</span>
    <span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="p">[])</span>

    <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">site_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">library</span><span class="si">}{</span><span class="n">file</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.sharepoint.Sharepoint.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">if_empty</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_sheet_mapping</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load an Excel file or files from a SharePoint URL into a pandas DataFrame.</p>
<p>This method handles downloading the file(s), parsing the content, and converting
it into a pandas DataFrame. It supports both single file URLs and folder URLs
with multiple files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL of the file to be downloaded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sheet_name</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="Union">Union</span>[<span title="str">str</span>, <span title="list">list</span>, <span title="int">int</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Strings are used for
sheet names. Integers are used in zero-indexed sheet positions (chart
sheets do not count as a sheet position). Lists of strings/integers are
used to request multiple sheets. Specify None to get all worksheets.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>if_empty</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;warn&#39;, &#39;skip&#39;, &#39;fail&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action to take if
the DataFrame is empty.
- "warn": Logs a warning.
- "skip": Skips the operation.
- "fail": Raises an error.
Defaults to "warn".</p>
              </div>
            </td>
            <td>
                  <code>&#39;warn&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tests</code>
            </td>
            <td>
                  <code><span title="Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with optional list of tests
to verify the output dataframe. If defined, triggers the <code>validate</code>
function from utils. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_sheet_mapping</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="Union">Union</span>[<span title="str">str</span>, <span title="int">int</span>, <span title="list">list</span>[<span title="str">str</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping of file names to sheet names or indices. The keys are file names
and the values are sheet names/indices. Used when multiple files are
involved. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>na_values</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional strings to recognize as NA/NaN.
If list passed, the specific NA values for each column will be
recognized. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments to pass to
pd.ExcelFile.parse(). Note that <code>nrows</code> is not supported.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: The resulting data as a pandas DataFrame.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file extension is not supported or if <code>if_empty</code> is set
to "fail" and the DataFrame is empty.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="viadot.signals.SKIP">SKIP</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>if_empty</code> is set to "skip" and the DataFrame is empty.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/sharepoint.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_viadot_metadata_columns</span>
<span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sheet_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">if_empty</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
    <span class="n">tests</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">file_sheet_mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">na_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load an Excel file or files from a SharePoint URL into a pandas DataFrame.</span>

<span class="sd">    This method handles downloading the file(s), parsing the content, and converting</span>
<span class="sd">    it into a pandas DataFrame. It supports both single file URLs and folder URLs</span>
<span class="sd">    with multiple files.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): The URL of the file to be downloaded.</span>
<span class="sd">        sheet_name (Optional[Union[str, list, int]], optional): Strings are used for</span>
<span class="sd">            sheet names. Integers are used in zero-indexed sheet positions (chart</span>
<span class="sd">            sheets do not count as a sheet position). Lists of strings/integers are</span>
<span class="sd">            used to request multiple sheets. Specify None to get all worksheets.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        if_empty (Literal[&quot;warn&quot;, &quot;skip&quot;, &quot;fail&quot;], optional): Action to take if</span>
<span class="sd">            the DataFrame is empty.</span>
<span class="sd">            - &quot;warn&quot;: Logs a warning.</span>
<span class="sd">            - &quot;skip&quot;: Skips the operation.</span>
<span class="sd">            - &quot;fail&quot;: Raises an error.</span>
<span class="sd">            Defaults to &quot;warn&quot;.</span>
<span class="sd">        tests (Dict[str, Any], optional): A dictionary with optional list of tests</span>
<span class="sd">            to verify the output dataframe. If defined, triggers the `validate`</span>
<span class="sd">            function from utils. Defaults to None.</span>
<span class="sd">        file_sheet_mapping (dict[str, Union[str, int, list[str]]], optional):</span>
<span class="sd">            Mapping of file names to sheet names or indices. The keys are file names</span>
<span class="sd">            and the values are sheet names/indices. Used when multiple files are</span>
<span class="sd">            involved. Defaults to None.</span>
<span class="sd">        na_values (list[str], optional): Additional strings to recognize as NA/NaN.</span>
<span class="sd">            If list passed, the specific NA values for each column will be</span>
<span class="sd">            recognized. Defaults to None.</span>
<span class="sd">        kwargs (dict[str, Any], optional): Keyword arguments to pass to</span>
<span class="sd">            pd.ExcelFile.parse(). Note that `nrows` is not supported.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: The resulting data as a pandas DataFrame.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the file extension is not supported or if `if_empty` is set</span>
<span class="sd">            to &quot;fail&quot; and the DataFrame is empty.</span>
<span class="sd">        SKIP: If `if_empty` is set to &quot;skip&quot; and the DataFrame is empty.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_file</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_and_parse</span><span class="p">(</span>
            <span class="n">file_url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="n">na_values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">file_sheet_mapping</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_multiple_files</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">file_sheet_mapping</span><span class="o">=</span><span class="n">file_sheet_mapping</span><span class="p">,</span>
            <span class="n">na_values</span><span class="o">=</span><span class="n">na_values</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">list_of_urls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_sharepoint_folder</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">excel_urls</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">file_url</span>
            <span class="k">for</span> <span class="n">file_url</span> <span class="ow">in</span> <span class="n">list_of_urls</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_file_extension</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;.xlsx&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">excel_urls</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No Excel files found in folder: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_and_parse</span><span class="p">(</span>
                <span class="n">file_url</span><span class="o">=</span><span class="n">file_url</span><span class="p">,</span>
                <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">,</span>
                <span class="n">na_values</span><span class="o">=</span><span class="n">na_values</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">file_url</span> <span class="ow">in</span> <span class="n">excel_urls</span>
        <span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">validate_and_reorder_dfs_columns</span><span class="p">(</span><span class="n">dfs</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span><span class="n">if_empty</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">SKIP</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully downloaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows of data.&quot;</span><span class="p">)</span>

    <span class="n">df_clean</span> <span class="o">=</span> <span class="n">cleanup_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tests</span><span class="p">:</span>
        <span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df_clean</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="n">tests</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_clean</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.supermetrics.Supermetrics" class="doc doc-heading">
            <code>viadot.sources.supermetrics.Supermetrics</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>


        <p>Implements methods for querying and interacting with the Supermetrics API.</p>
<p>This class provides functionality to query data from the Supermetrics API,
which is a tool used for accessing data from various data sources. The API
documentation can be found at:
https://supermetrics.com/docs/product-api-getting-started/. For information
on usage limits, please refer to:
https://supermetrics.com/docs/product-api-usage-limits/.</p>
        <hr />
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code>config_key (str, optional):
    The key in the viadot configuration that holds the relevant credentials
    for the API. Defaults to None.
credentials (dict of str to any, optional):
    A dictionary containing the credentials needed for the API connection
    configuration, specifically `api_key` and `user`. Defaults to None.
query_params (dict of str to any, optional):
    A dictionary containing the parameters to pass to the GET query.
    These parameters define the specifics of the data request. Defaults to None.
    For a full specification of possible parameters, see:
    https://supermetrics.com/docs/product-api-get-data/.
</code></pre></div></td></tr></table></div>







              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/supermetrics.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Supermetrics</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implements methods for querying and interacting with the Supermetrics API.</span>

<span class="sd">    This class provides functionality to query data from the Supermetrics API,</span>
<span class="sd">    which is a tool used for accessing data from various data sources. The API</span>
<span class="sd">    documentation can be found at:</span>
<span class="sd">    https://supermetrics.com/docs/product-api-getting-started/. For information</span>
<span class="sd">    on usage limits, please refer to:</span>
<span class="sd">    https://supermetrics.com/docs/product-api-usage-limits/.</span>

<span class="sd">    Args:</span>
<span class="sd">    ----</span>
<span class="sd">        config_key (str, optional):</span>
<span class="sd">            The key in the viadot configuration that holds the relevant credentials</span>
<span class="sd">            for the API. Defaults to None.</span>
<span class="sd">        credentials (dict of str to any, optional):</span>
<span class="sd">            A dictionary containing the credentials needed for the API connection</span>
<span class="sd">            configuration, specifically `api_key` and `user`. Defaults to None.</span>
<span class="sd">        query_params (dict of str to any, optional):</span>
<span class="sd">            A dictionary containing the parameters to pass to the GET query.</span>
<span class="sd">            These parameters define the specifics of the data request. Defaults to None.</span>
<span class="sd">            For a full specification of possible parameters, see:</span>
<span class="sd">            https://supermetrics.com/docs/product-api-get-data/.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">BASE_URL</span> <span class="o">=</span> <span class="s2">&quot;https://api.supermetrics.com/enterprise/v2/query/data/json&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">query_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Supermetrics object.</span>

<span class="sd">        This constructor sets up the necessary components to interact with the</span>
<span class="sd">        Supermetrics API, including the credentials and any query parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">        ----</span>
<span class="sd">            credentials (SupermetricsCredentials, optional):</span>
<span class="sd">                An instance of `SupermetricsCredentials` containing the API key and</span>
<span class="sd">                user email for authentication. Defaults to None.</span>
<span class="sd">            config_key (str, optional):</span>
<span class="sd">                The key in the viadot configuration that holds the relevant credentials</span>
<span class="sd">                for the API. Defaults to None.</span>
<span class="sd">            query_params (dict of str to any, optional):</span>
<span class="sd">                A dictionary containing the parameters to pass to the GET query. These</span>
<span class="sd">                parameters define the specifics of the data request. Defaults to None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
        <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">SupermetricsCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">query_params</span> <span class="o">=</span> <span class="n">query_params</span>

    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.05</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">30</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download query results to a dictionary.</span>

<span class="sd">        This method executes the query against the Supermetrics API and retrieves</span>
<span class="sd">        the results as a JSON dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">        ----</span>
<span class="sd">            timeout (tuple of float, optional):</span>
<span class="sd">                A tuple specifying the timeout values for the request. The first value</span>
<span class="sd">                is the timeout for connection issues, and the second value is</span>
<span class="sd">                the timeout for query execution. Defaults to (3.05, 1800), which</span>
<span class="sd">                provides a short timeout for connection issues and a longer timeout</span>
<span class="sd">                for the query execution.</span>

<span class="sd">        Returns:</span>
<span class="sd">        -------</span>
<span class="sd">            dict:</span>
<span class="sd">                The response from the Supermetrics API, returned as a JSON dictionary.</span>

<span class="sd">        Raises:</span>
<span class="sd">        ------</span>
<span class="sd">            ValueError:</span>
<span class="sd">                Raised if the query parameters are not set before calling this method.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_params</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please build the query first&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;json&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_params</span><span class="p">)}</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;api_key&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">Supermetrics</span><span class="o">.</span><span class="n">BASE_URL</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_col_names_google_analytics</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">response</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get column names from Google Analytics data.</span>

<span class="sd">        This method extracts the column names from the JSON response received</span>
<span class="sd">        from a Google Analytics API call.</span>

<span class="sd">        Args:</span>
<span class="sd">        ----</span>
<span class="sd">            response (dict):</span>
<span class="sd">                A dictionary containing the JSON response from the API call.</span>

<span class="sd">        Returns:</span>
<span class="sd">        -------</span>
<span class="sd">            list of str:</span>
<span class="sd">                A list of column names extracted from the Google Analytics data.</span>

<span class="sd">        Raises:</span>
<span class="sd">        ------</span>
<span class="sd">            ValueError:</span>
<span class="sd">                Raised if no data is returned in the response or if the column names</span>
<span class="sd">                cannot be determined.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_pivoted</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">field</span><span class="p">[</span><span class="s2">&quot;field_split&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;column&quot;</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">][</span><span class="s2">&quot;query&quot;</span><span class="p">][</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">is_pivoted</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Couldn&#39;t find column names as query returned no data.&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cols_meta</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">][</span><span class="s2">&quot;query&quot;</span><span class="p">][</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_meta</span><span class="p">[</span><span class="s2">&quot;field_name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">col_meta</span> <span class="ow">in</span> <span class="n">cols_meta</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">columns</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_col_names_other</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get column names from non-Google Analytics data.</span>

<span class="sd">        This method extracts the column names from the JSON response received</span>
<span class="sd">        from an API call that is not related to Google Analytics.</span>

<span class="sd">        Args:</span>
<span class="sd">        ----</span>
<span class="sd">            response (dict):</span>
<span class="sd">                A dictionary containing the JSON response from the API call.</span>

<span class="sd">        Returns:</span>
<span class="sd">        -------</span>
<span class="sd">            list of str:</span>
<span class="sd">                A list of column names extracted from the non-Google Analytics data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cols_meta</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">][</span><span class="s2">&quot;query&quot;</span><span class="p">][</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">col_meta</span><span class="p">[</span><span class="s2">&quot;field_name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">col_meta</span> <span class="ow">in</span> <span class="n">cols_meta</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_col_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get column names based on the data type.</span>

<span class="sd">        This method determines the appropriate column names for the data based</span>
<span class="sd">        on its type, whether it&#39;s Google Analytics data or another type.</span>

<span class="sd">        Returns:</span>
<span class="sd">        -------</span>
<span class="sd">            list of str:</span>
<span class="sd">                A list of column names based on the data type.</span>

<span class="sd">        Raises:</span>
<span class="sd">        ------</span>
<span class="sd">            ValueError:</span>
<span class="sd">                Raised if the column names cannot be determined.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;ds_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;GA&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Supermetrics</span><span class="o">.</span><span class="n">_get_col_names_google_analytics</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Supermetrics</span><span class="o">.</span><span class="n">_get_col_names_other</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="nd">@add_viadot_metadata_columns</span>
    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
        <span class="n">query_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download data into a pandas DataFrame.</span>

<span class="sd">        This method retrieves data from the Supermetrics API and loads it into</span>
<span class="sd">        a pandas DataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">        ----</span>
<span class="sd">            if_empty (str, optional):</span>
<span class="sd">                Specifies the action to take if the query returns no data.</span>
<span class="sd">                Options include &quot;fail&quot; to raise an error or &quot;ignore&quot; to return</span>
<span class="sd">                an empty DataFrame. Defaults to &quot;fail&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">        -------</span>
<span class="sd">            pd.DataFrame:</span>
<span class="sd">                A pandas DataFrame containing the JSON data retrieved from the API.</span>

<span class="sd">        Raises:</span>
<span class="sd">        ------</span>
<span class="sd">            ValueError:</span>
<span class="sd">                Raised if the DataFrame is empty and `if_empty` is set to &quot;fail&quot;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Use provided query_params or default to the instance&#39;s query_params</span>
        <span class="k">if</span> <span class="n">query_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">query_params</span> <span class="o">=</span> <span class="n">query_params</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_params</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Query parameters are required to fetch data.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;api_key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_col_names</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_json</span><span class="p">()[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span><span class="n">if_empty</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.supermetrics.Supermetrics.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the Supermetrics object.</p>
<p>This constructor sets up the necessary components to interact with the
Supermetrics API, including the credentials and any query parameters.</p>
        <hr />
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code>credentials (SupermetricsCredentials, optional):
    An instance of `SupermetricsCredentials` containing the API key and
    user email for authentication. Defaults to None.
config_key (str, optional):
    The key in the viadot configuration that holds the relevant credentials
    for the API. Defaults to None.
query_params (dict of str to any, optional):
    A dictionary containing the parameters to pass to the GET query. These
    parameters define the specifics of the data request. Defaults to None.
</code></pre></div></td></tr></table></div>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/supermetrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">query_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the Supermetrics object.</span>

<span class="sd">    This constructor sets up the necessary components to interact with the</span>
<span class="sd">    Supermetrics API, including the credentials and any query parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">    ----</span>
<span class="sd">        credentials (SupermetricsCredentials, optional):</span>
<span class="sd">            An instance of `SupermetricsCredentials` containing the API key and</span>
<span class="sd">            user email for authentication. Defaults to None.</span>
<span class="sd">        config_key (str, optional):</span>
<span class="sd">            The key in the viadot configuration that holds the relevant credentials</span>
<span class="sd">            for the API. Defaults to None.</span>
<span class="sd">        query_params (dict of str to any, optional):</span>
<span class="sd">            A dictionary containing the parameters to pass to the GET query. These</span>
<span class="sd">            parameters define the specifics of the data request. Defaults to None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">raw_creds</span> <span class="o">=</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">get_source_credentials</span><span class="p">(</span><span class="n">config_key</span><span class="p">)</span>
    <span class="n">validated_creds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">SupermetricsCredentials</span><span class="p">(</span><span class="o">**</span><span class="n">raw_creds</span><span class="p">))</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">validated_creds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">query_params</span> <span class="o">=</span> <span class="n">query_params</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.supermetrics.Supermetrics.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download data into a pandas DataFrame.</p>
<p>This method retrieves data from the Supermetrics API and loads it into
a pandas DataFrame.</p>
        <hr />
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>if_empty (str, optional):
    Specifies the action to take if the query returns no data.
    Options include &quot;fail&quot; to raise an error or &quot;ignore&quot; to return
    an empty DataFrame. Defaults to &quot;fail&quot;.
</code></pre></div></td></tr></table></div>
        <hr />
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>pd.DataFrame:
    A pandas DataFrame containing the JSON data retrieved from the API.
</code></pre></div></td></tr></table></div>
        <hr />
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>ValueError:
    Raised if the DataFrame is empty and `if_empty` is set to &quot;fail&quot;.
</code></pre></div></td></tr></table></div>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/supermetrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_viadot_metadata_columns</span>
<span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
    <span class="n">query_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download data into a pandas DataFrame.</span>

<span class="sd">    This method retrieves data from the Supermetrics API and loads it into</span>
<span class="sd">    a pandas DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">    ----</span>
<span class="sd">        if_empty (str, optional):</span>
<span class="sd">            Specifies the action to take if the query returns no data.</span>
<span class="sd">            Options include &quot;fail&quot; to raise an error or &quot;ignore&quot; to return</span>
<span class="sd">            an empty DataFrame. Defaults to &quot;fail&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">        pd.DataFrame:</span>
<span class="sd">            A pandas DataFrame containing the JSON data retrieved from the API.</span>

<span class="sd">    Raises:</span>
<span class="sd">    ------</span>
<span class="sd">        ValueError:</span>
<span class="sd">            Raised if the DataFrame is empty and `if_empty` is set to &quot;fail&quot;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Use provided query_params or default to the instance&#39;s query_params</span>
    <span class="k">if</span> <span class="n">query_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_params</span> <span class="o">=</span> <span class="n">query_params</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_params</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Query parameters are required to fetch data.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;api_key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_col_names</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_json</span><span class="p">()[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span><span class="n">if_empty</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.supermetrics.Supermetrics.to_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_json</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="mf">3.05</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">30</span><span class="p">))</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download query results to a dictionary.</p>
<p>This method executes the query against the Supermetrics API and retrieves
the results as a JSON dictionary.</p>
        <hr />
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code>timeout (tuple of float, optional):
    A tuple specifying the timeout values for the request. The first value
    is the timeout for connection issues, and the second value is
    the timeout for query execution. Defaults to (3.05, 1800), which
    provides a short timeout for connection issues and a longer timeout
    for the query execution.
</code></pre></div></td></tr></table></div>
        <hr />
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>dict:
    The response from the Supermetrics API, returned as a JSON dictionary.
</code></pre></div></td></tr></table></div>
        <hr />
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>ValueError:
    Raised if the query parameters are not set before calling this method.
</code></pre></div></td></tr></table></div>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/supermetrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.05</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">30</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download query results to a dictionary.</span>

<span class="sd">    This method executes the query against the Supermetrics API and retrieves</span>
<span class="sd">    the results as a JSON dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">    ----</span>
<span class="sd">        timeout (tuple of float, optional):</span>
<span class="sd">            A tuple specifying the timeout values for the request. The first value</span>
<span class="sd">            is the timeout for connection issues, and the second value is</span>
<span class="sd">            the timeout for query execution. Defaults to (3.05, 1800), which</span>
<span class="sd">            provides a short timeout for connection issues and a longer timeout</span>
<span class="sd">            for the query execution.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">        dict:</span>
<span class="sd">            The response from the Supermetrics API, returned as a JSON dictionary.</span>

<span class="sd">    Raises:</span>
<span class="sd">    ------</span>
<span class="sd">        ValueError:</span>
<span class="sd">            Raised if the query parameters are not set before calling this method.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_params</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please build the query first&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;json&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_params</span><span class="p">)}</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;api_key&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">Supermetrics</span><span class="o">.</span><span class="n">BASE_URL</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.uk_carbon_intensity.UKCarbonIntensity" class="doc doc-heading">
            <code>viadot.sources.uk_carbon_intensity.UKCarbonIntensity</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>








              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/uk_carbon_intensity.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">UKCarbonIntensity</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">api_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch data of Carbon Intensity of the UK Power Grid.</span>

<span class="sd">        Documentation for this source API is located</span>
<span class="sd">        at: https://carbon-intensity.github.io/api-definitions/#carbon-intensity-api-v2-0-0</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        api_url : str, optional</span>
<span class="sd">        The URL endpoint to call, by default None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="n">api_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">API_ENDPOINT</span> <span class="o">=</span> <span class="s2">&quot;https://api.carbonintensity.org.uk&quot;</span>

    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates json file.&quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">API_ENDPOINT</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">api_url</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{},</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">raise</span> <span class="sa">f</span><span class="s2">&quot;Error </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@add_viadot_metadata_columns</span>
    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a pandas DataFrame with flattened data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pandas.DataFrame: A Pandas DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">from_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">to</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">max_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">average</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">min_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">json_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span><span class="n">if_empty</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
            <span class="n">from_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">])</span>
            <span class="n">to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;to&quot;</span><span class="p">])</span>
            <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">][</span><span class="s2">&quot;index&quot;</span><span class="p">])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">forecast</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">][</span><span class="s2">&quot;forecast&quot;</span><span class="p">])</span>
                <span class="n">actual</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">][</span><span class="s2">&quot;actual&quot;</span><span class="p">])</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">from_</span><span class="p">,</span>
                        <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="n">to</span><span class="p">,</span>
                        <span class="s2">&quot;forecast&quot;</span><span class="p">:</span> <span class="n">forecast</span><span class="p">,</span>
                        <span class="s2">&quot;actual&quot;</span><span class="p">:</span> <span class="n">actual</span><span class="p">,</span>
                        <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">max_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">][</span><span class="s2">&quot;max&quot;</span><span class="p">])</span>
                <span class="n">average</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">][</span><span class="s2">&quot;average&quot;</span><span class="p">])</span>
                <span class="n">min_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">][</span><span class="s2">&quot;min&quot;</span><span class="p">])</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">from_</span><span class="p">,</span>
                        <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="n">to</span><span class="p">,</span>
                        <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">max_</span><span class="p">,</span>
                        <span class="s2">&quot;average&quot;</span><span class="p">:</span> <span class="n">average</span><span class="p">,</span>
                        <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">min_</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Queries the API.&quot;&quot;&quot;</span>
        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.uk_carbon_intensity.UKCarbonIntensity.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">api_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fetch data of Carbon Intensity of the UK Power Grid.</p>
<p>Documentation for this source API is located
at: https://carbon-intensity.github.io/api-definitions/#carbon-intensity-api-v2-0-0</p>
<h5 id="viadot.sources.uk_carbon_intensity.UKCarbonIntensity.__init__--parameters">Parameters</h5>
<p>api_url : str, optional
The URL endpoint to call, by default None</p>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/uk_carbon_intensity.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">api_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch data of Carbon Intensity of the UK Power Grid.</span>

<span class="sd">    Documentation for this source API is located</span>
<span class="sd">    at: https://carbon-intensity.github.io/api-definitions/#carbon-intensity-api-v2-0-0</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    api_url : str, optional</span>
<span class="sd">    The URL endpoint to call, by default None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="n">api_url</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">API_ENDPOINT</span> <span class="o">=</span> <span class="s2">&quot;https://api.carbonintensity.org.uk&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.uk_carbon_intensity.UKCarbonIntensity.query" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">query</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Queries the API.</p>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/uk_carbon_intensity.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Queries the API.&quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.uk_carbon_intensity.UKCarbonIntensity.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns a pandas DataFrame with flattened data.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pandas.DataFrame: A Pandas DataFrame</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/uk_carbon_intensity.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@add_viadot_metadata_columns</span>
<span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">if_empty</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a pandas DataFrame with flattened data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pandas.DataFrame: A Pandas DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">from_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">to</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">forecast</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">max_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">average</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">min_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">json_data</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span><span class="n">if_empty</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
        <span class="n">from_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">])</span>
        <span class="n">to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;to&quot;</span><span class="p">])</span>
        <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">][</span><span class="s2">&quot;index&quot;</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">forecast</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">][</span><span class="s2">&quot;forecast&quot;</span><span class="p">])</span>
            <span class="n">actual</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">][</span><span class="s2">&quot;actual&quot;</span><span class="p">])</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">from_</span><span class="p">,</span>
                    <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="n">to</span><span class="p">,</span>
                    <span class="s2">&quot;forecast&quot;</span><span class="p">:</span> <span class="n">forecast</span><span class="p">,</span>
                    <span class="s2">&quot;actual&quot;</span><span class="p">:</span> <span class="n">actual</span><span class="p">,</span>
                    <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">max_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">][</span><span class="s2">&quot;max&quot;</span><span class="p">])</span>
            <span class="n">average</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">][</span><span class="s2">&quot;average&quot;</span><span class="p">])</span>
            <span class="n">min_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">][</span><span class="s2">&quot;min&quot;</span><span class="p">])</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">from_</span><span class="p">,</span>
                    <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="n">to</span><span class="p">,</span>
                    <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">max_</span><span class="p">,</span>
                    <span class="s2">&quot;average&quot;</span><span class="p">:</span> <span class="n">average</span><span class="p">,</span>
                    <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">min_</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.uk_carbon_intensity.UKCarbonIntensity.to_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_json</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates json file.</p>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/uk_carbon_intensity.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates json file.&quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">API_ENDPOINT</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">api_url</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{},</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">raise</span> <span class="sa">f</span><span class="s2">&quot;Error </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="viadot.sources.vid_club.VidClub" class="doc doc-heading">
            <code>viadot.sources.vid_club.VidClub</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;viadot.sources.base.Source&lt;/code&gt;" href="../database/#viadot.sources.base.Source">Source</a></code></p>


        <p>A class implementing the Vid Club API.</p>
<p>Documentation for this API is located at: https://evps01.envoo.net/vipapi/
There are 4 endpoints where to get the data.</p>







              <details class="quote">
                <summary>Source code in <code>src/viadot/sources/vid_club.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">VidClub</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class implementing the Vid Club API.</span>

<span class="sd">    Documentation for this API is located at: https://evps01.envoo.net/vipapi/</span>
<span class="sd">    There are 4 endpoints where to get the data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">,</span> <span class="s2">&quot;survey&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">from_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2022-03-22&quot;</span><span class="p">,</span>
        <span class="n">to_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">items_per_page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">region</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;bg&quot;</span><span class="p">,</span> <span class="s2">&quot;hu&quot;</span><span class="p">,</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span> <span class="s2">&quot;pl&quot;</span><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="s2">&quot;si&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">days_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
        <span class="n">cols_to_drop</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">vid_club_credentials</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">validate_df_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an instance of VidClub.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (Literal[&quot;jobs&quot;, &quot;product&quot;, &quot;company&quot;, &quot;survey&quot;], optional): The</span>
<span class="sd">                endpoint source to be accessed. Defaults to None.</span>
<span class="sd">            from_date (str, optional): Start date for the query, by default is the</span>
<span class="sd">                oldest date in the data 2022-03-22.</span>
<span class="sd">            to_date (str, optional): End date for the query. By default None,</span>
<span class="sd">                which will be executed as datetime.today().strftime(&quot;%Y-%m-%d&quot;) in code.</span>
<span class="sd">            items_per_page (int, optional): Number of entries per page. Defaults to 100.</span>
<span class="sd">            region (Literal[&quot;bg&quot;, &quot;hu&quot;, &quot;hr&quot;, &quot;pl&quot;, &quot;ro&quot;, &quot;si&quot;, &quot;all&quot;], optional):</span>
<span class="sd">                Region filter for the query. Defaults to None</span>
<span class="sd">                (parameter is not used in url). [December 2023 status: value &#39;all&#39;</span>
<span class="sd">                does not work for company and jobs]</span>
<span class="sd">            days_interval (int, optional): Days specified in date range per API call</span>
<span class="sd">                (test showed that 30-40 is optimal for performance). Defaults to 30.</span>
<span class="sd">            cols_to_drop (List[str], optional): List of columns to drop.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            vid_club_credentials (Dict[str, Any], optional): Stores the credentials</span>
<span class="sd">                information. Defaults to None.</span>
<span class="sd">            validate_df_dict (dict, optional): A dictionary with optional list of tests</span>
<span class="sd">                to verify the output</span>
<span class="sd">                dataframe. If defined, triggers the `validate_df` task from task_utils.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            timeout (int, optional): The time (in seconds) to wait while running this</span>
<span class="sd">                task before a timeout occurs. Defaults to 3600.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_date</span> <span class="o">=</span> <span class="n">from_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="n">to_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items_per_page</span> <span class="o">=</span> <span class="n">items_per_page</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="n">region</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">days_interval</span> <span class="o">=</span> <span class="n">days_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cols_to_drop</span> <span class="o">=</span> <span class="n">cols_to_drop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vid_club_credentials</span> <span class="o">=</span> <span class="n">vid_club_credentials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_df_dict</span> <span class="o">=</span> <span class="n">validate_df_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="n">vid_club_credentials</span><span class="p">[</span><span class="s2">&quot;token&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">credentials</span><span class="o">=</span><span class="n">vid_club_credentials</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># noqa: B026</span>

    <span class="k">def</span> <span class="nf">build_query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">from_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">to_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">api_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">items_per_page</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">,</span> <span class="s2">&quot;survey&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">region</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;bg&quot;</span><span class="p">,</span> <span class="s2">&quot;hu&quot;</span><span class="p">,</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span> <span class="s2">&quot;pl&quot;</span><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="s2">&quot;si&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds the query from the inputs.</span>

<span class="sd">        Args:</span>
<span class="sd">            from_date (str): Start date for the query.</span>
<span class="sd">            to_date (str): End date for the query, if empty, will be executed as</span>
<span class="sd">                datetime.today().strftime(&quot;%Y-%m-%d&quot;).</span>
<span class="sd">            api_url (str): Generic part of the URL to Vid Club API.</span>
<span class="sd">            items_per_page (int): number of entries per page.</span>
<span class="sd">            endpoint (Literal[&quot;jobs&quot;, &quot;product&quot;, &quot;company&quot;, &quot;survey&quot;], optional):</span>
<span class="sd">                The endpoint source to be accessed. Defaults to None.</span>
<span class="sd">            region (Literal[&quot;bg&quot;, &quot;hu&quot;, &quot;hr&quot;, &quot;pl&quot;, &quot;ro&quot;, &quot;si&quot;, &quot;all&quot;], optional):</span>
<span class="sd">                Region filter for the query. Defaults to None</span>
<span class="sd">                (parameter is not used in url). [December 2023 status: value &#39;all&#39;</span>
<span class="sd">                does not work for company and jobs]</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Final query with all filters added.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If any source different than the ones in the list are used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">]:</span>
            <span class="n">region_url_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;region=</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">region</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="n">api_url</span><span class="si">}{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">?from=</span><span class="si">{</span><span class="n">from_date</span><span class="si">}</span><span class="s2">&amp;to=</span><span class="si">{</span><span class="n">to_date</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="n">region_url_string</span><span class="si">}</span><span class="s2">&amp;limit=</span><span class="si">{</span><span class="n">items_per_page</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;survey&quot;</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_url</span><span class="si">}{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">?language=en&amp;type=question&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Pick one these sources: jobs, product, company, survey&quot;</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">url</span>

    <span class="k">def</span> <span class="nf">intervals</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">from_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">to_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">days_interval</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Breaks dates range into smaller by provided days interval.</span>

<span class="sd">        Args:</span>
<span class="sd">            from_date (str): Start date for the query in &quot;%Y-%m-%d&quot; format.</span>
<span class="sd">            to_date (str): End date for the query, if empty, will be executed as</span>
<span class="sd">                datetime.today().strftime(&quot;%Y-%m-%d&quot;).</span>
<span class="sd">            days_interval (int): Days specified in date range per api call</span>
<span class="sd">                (test showed that 30-40 is optimal for performance).</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str], List[str]: Starts and Ends lists that contains information</span>
<span class="sd">                about date ranges for specific period and time interval.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If the final date of the query is before the start date.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">to_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">to_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">to_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">from_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

        <span class="n">from_date_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">from_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">to_date_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">to_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">to_date_obj</span> <span class="o">-</span> <span class="n">from_date_obj</span>

        <span class="k">if</span> <span class="n">delta</span><span class="o">.</span><span class="n">days</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;to_date cannot be earlier than from_date.&quot;</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">interval</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_interval</span><span class="p">)</span>
        <span class="n">starts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ends</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">period_start</span> <span class="o">=</span> <span class="n">start_date</span>
        <span class="k">while</span> <span class="n">period_start</span> <span class="o">&lt;</span> <span class="n">end_date</span><span class="p">:</span>
            <span class="n">period_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">period_start</span> <span class="o">+</span> <span class="n">interval</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
            <span class="n">starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">period_start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">ends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">period_end</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">period_start</span> <span class="o">=</span> <span class="n">period_end</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">starts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ends</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">from_date</span><span class="p">)</span>
            <span class="n">ends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">to_date</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">starts</span><span class="p">,</span> <span class="n">ends</span>

    <span class="k">def</span> <span class="nf">check_connection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">,</span> <span class="s2">&quot;survey&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">from_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2022-03-22&quot;</span><span class="p">,</span>
        <span class="n">to_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">items_per_page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">region</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;bg&quot;</span><span class="p">,</span> <span class="s2">&quot;hu&quot;</span><span class="p">,</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span> <span class="s2">&quot;pl&quot;</span><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="s2">&quot;si&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initiate first connection to API to retrieve piece of data.</span>

<span class="sd">        With information about type of pagination in API URL.</span>
<span class="sd">        This option is added because type of pagination for endpoints is being changed</span>
<span class="sd">        in the future from page number to &#39;next&#39; id.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (Literal[&quot;jobs&quot;, &quot;product&quot;, &quot;company&quot;, &quot;survey&quot;], optional):</span>
<span class="sd">                The endpoint source to be accessed. Defaults to None.</span>
<span class="sd">            from_date (str, optional): Start date for the query, by default is the</span>
<span class="sd">                oldest date in the data 2022-03-22.</span>
<span class="sd">            to_date (str, optional): End date for the query. By default None,</span>
<span class="sd">                which will be executed as datetime.today().strftime(&quot;%Y-%m-%d&quot;) in code.</span>
<span class="sd">            items_per_page (int, optional): Number of entries per page.</span>
<span class="sd">                100 entries by default.</span>
<span class="sd">            region (Literal[&quot;bg&quot;, &quot;hu&quot;, &quot;hr&quot;, &quot;pl&quot;, &quot;ro&quot;, &quot;si&quot;, &quot;all&quot;], optional):</span>
<span class="sd">                Region filter for the query. Defaults to None</span>
<span class="sd">                (parameter is not used in url). [December 2023 status: value &#39;all&#39;</span>
<span class="sd">                does not work for company and jobs]</span>
<span class="sd">            url (str, optional): Generic part of the URL to Vid Club API.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[Dict[str, Any], str]: Dictionary with first response from API with</span>
<span class="sd">                JSON containing data and used URL string.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If from_date is earlier than 2022-03-22.</span>
<span class="sd">            ValidationError: If to_date is earlier than from_date.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">from_date</span> <span class="o">&lt;</span> <span class="s2">&quot;2022-03-22&quot;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;from_date cannot be earlier than 2022-03-22.&quot;</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">to_date</span> <span class="o">&lt;</span> <span class="n">from_date</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;to_date cannot be earlier than from_date.&quot;</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>

        <span class="n">first_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_query</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="n">from_date</span><span class="o">=</span><span class="n">from_date</span><span class="p">,</span>
            <span class="n">to_date</span><span class="o">=</span><span class="n">to_date</span><span class="p">,</span>
            <span class="n">api_url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">items_per_page</span><span class="o">=</span><span class="n">items_per_page</span><span class="p">,</span>
            <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">first_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">first_url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_response</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">,</span> <span class="s2">&quot;survey&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">from_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2022-03-22&quot;</span><span class="p">,</span>
        <span class="n">to_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">items_per_page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">region</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;bg&quot;</span><span class="p">,</span> <span class="s2">&quot;hu&quot;</span><span class="p">,</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span> <span class="s2">&quot;pl&quot;</span><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="s2">&quot;si&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Basing on the pagination type retrieved using check_connection function.</span>

<span class="sd">        It gets the response from the API queried and transforms it into DataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (Literal[&quot;jobs&quot;, &quot;product&quot;, &quot;company&quot;, &quot;survey&quot;], optional):</span>
<span class="sd">                The endpoint source to be accessed. Defaults to None.</span>
<span class="sd">            from_date (str, optional): Start date for the query, by default is the</span>
<span class="sd">                oldest date in the data 2022-03-22.</span>
<span class="sd">            to_date (str, optional): End date for the query. By default None,</span>
<span class="sd">                which will be executed as datetime.today().strftime(&quot;%Y-%m-%d&quot;) in code.</span>
<span class="sd">            items_per_page (int, optional): Number of entries per page.</span>
<span class="sd">                100 entries by default.</span>
<span class="sd">            region (Literal[&quot;bg&quot;, &quot;hu&quot;, &quot;hr&quot;, &quot;pl&quot;, &quot;ro&quot;, &quot;si&quot;, &quot;all&quot;], optional):</span>
<span class="sd">                Region filter for the query. Defaults to None</span>
<span class="sd">                (parameter is not used in url). [December 2023 status: value &#39;all&#39;</span>
<span class="sd">                does not work for company and jobs]</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Table of the data carried in the response.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If any source different than the ones in the list are used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span>
        <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">,</span> <span class="s2">&quot;survey&quot;</span><span class="p">]:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The source has to be: jobs, product, company or survey&quot;</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">to_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">to_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span><span class="p">,</span> <span class="n">first_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_connection</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="n">from_date</span><span class="o">=</span><span class="n">from_date</span><span class="p">,</span>
            <span class="n">to_date</span><span class="o">=</span><span class="n">to_date</span><span class="p">,</span>
            <span class="n">items_per_page</span><span class="o">=</span><span class="n">items_per_page</span><span class="p">,</span>
            <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">keys_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">keys_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keys_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">ind</span> <span class="o">=</span> <span class="s2">&quot;next&quot;</span> <span class="ow">in</span> <span class="n">keys_list</span>

        <span class="k">if</span> <span class="s2">&quot;data&quot;</span> <span class="ow">in</span> <span class="n">keys_list</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="k">while</span> <span class="n">length</span> <span class="o">==</span> <span class="n">items_per_page</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ind</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">next_page</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;next&quot;</span><span class="p">]</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_url</span><span class="si">}</span><span class="s2">&amp;next=</span><span class="si">{</span><span class="n">next_page</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_url</span><span class="si">}</span><span class="s2">&amp;page=</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">response_api</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span>
                <span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">response_api</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">df_page</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
                <span class="n">df_page</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_page</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;product&quot;</span><span class="p">:</span>
                    <span class="n">df_page</span> <span class="o">=</span> <span class="n">df_page</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">df_page</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">df</span><span class="p">,</span> <span class="n">df_page</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">if_empty</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Looping get_response and iterating by date ranges defined in intervals.</span>

<span class="sd">        Stores outputs as DataFrames in a list. At the end, daframes are concatenated</span>
<span class="sd">        in one and dropped duplicates that would appear when quering.</span>

<span class="sd">        Args:</span>
<span class="sd">            if_empty (Literal[&quot;warn&quot;, &quot;skip&quot;, &quot;fail&quot;], optional): What to do if a fetch</span>
<span class="sd">                produce no data. Defaults to &quot;warn</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Dataframe of the concatanated data carried in the responses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">starts</span><span class="p">,</span> <span class="n">ends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">(</span>
            <span class="n">from_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="p">,</span>
            <span class="n">to_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">to_date</span><span class="p">,</span>
            <span class="n">days_interval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">days_interval</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">dfs_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">starts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ends</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ingesting data for dates [</span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2">]-[</span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">]...&quot;</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span>
                    <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
                    <span class="n">from_date</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                    <span class="n">to_date</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
                    <span class="n">items_per_page</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">items_per_page</span><span class="p">,</span>
                    <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">dfs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfs_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dfs_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
                <span class="n">from_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="p">,</span>
                <span class="n">to_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">to_date</span><span class="p">,</span>
                <span class="n">items_per_page</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">items_per_page</span><span class="p">,</span>
                <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">list_columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span><span class="o">.</span><span class="n">any</span><span class="p">()]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_columns</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols_to_drop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_to_drop</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Dropping following columns: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_to_drop</span><span class="si">}</span><span class="s2">...&quot;</span>
                    <span class="p">)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Column(s): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_to_drop</span><span class="si">}</span><span class="s2"> don&#39;t exist in the DataFrame.</span>
<span class="s2">                        No columns were dropped. Returning full DataFrame...&quot;&quot;&quot;</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Existing columns: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Provide columns to drop in a List.&quot;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="viadot.sources.vid_club.VidClub.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_date</span><span class="o">=</span><span class="s1">&#39;2022-03-22&#39;</span><span class="p">,</span> <span class="n">to_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">items_per_page</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">days_interval</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cols_to_drop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vid_club_credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate_df_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create an instance of VidClub.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>endpoint</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;jobs&#39;, &#39;product&#39;, &#39;company&#39;, &#39;survey&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The
endpoint source to be accessed. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>from_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date for the query, by default is the
oldest date in the data 2022-03-22.</p>
              </div>
            </td>
            <td>
                  <code>&#39;2022-03-22&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date for the query. By default None,
which will be executed as datetime.today().strftime("%Y-%m-%d") in code.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>items_per_page</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of entries per page. Defaults to 100.</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>region</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;bg&#39;, &#39;hu&#39;, &#39;hr&#39;, &#39;pl&#39;, &#39;ro&#39;, &#39;si&#39;, &#39;all&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Region filter for the query. Defaults to None
(parameter is not used in url). [December 2023 status: value 'all'
does not work for company and jobs]</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>days_interval</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Days specified in date range per API call
(test showed that 30-40 is optimal for performance). Defaults to 30.</p>
              </div>
            </td>
            <td>
                  <code>30</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cols_to_drop</code>
            </td>
            <td>
                  <code><span title="List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns to drop.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vid_club_credentials</code>
            </td>
            <td>
                  <code><span title="Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stores the credentials
information. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>validate_df_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with optional list of tests
to verify the output
dataframe. If defined, triggers the <code>validate_df</code> task from task_utils.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time (in seconds) to wait while running this
task before a timeout occurs. Defaults to 3600.</p>
              </div>
            </td>
            <td>
                  <code>3600</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/vid_club.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">,</span> <span class="s2">&quot;survey&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">from_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2022-03-22&quot;</span><span class="p">,</span>
    <span class="n">to_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">items_per_page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">region</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;bg&quot;</span><span class="p">,</span> <span class="s2">&quot;hu&quot;</span><span class="p">,</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span> <span class="s2">&quot;pl&quot;</span><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="s2">&quot;si&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">days_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">cols_to_drop</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vid_club_credentials</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">validate_df_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an instance of VidClub.</span>

<span class="sd">    Args:</span>
<span class="sd">        endpoint (Literal[&quot;jobs&quot;, &quot;product&quot;, &quot;company&quot;, &quot;survey&quot;], optional): The</span>
<span class="sd">            endpoint source to be accessed. Defaults to None.</span>
<span class="sd">        from_date (str, optional): Start date for the query, by default is the</span>
<span class="sd">            oldest date in the data 2022-03-22.</span>
<span class="sd">        to_date (str, optional): End date for the query. By default None,</span>
<span class="sd">            which will be executed as datetime.today().strftime(&quot;%Y-%m-%d&quot;) in code.</span>
<span class="sd">        items_per_page (int, optional): Number of entries per page. Defaults to 100.</span>
<span class="sd">        region (Literal[&quot;bg&quot;, &quot;hu&quot;, &quot;hr&quot;, &quot;pl&quot;, &quot;ro&quot;, &quot;si&quot;, &quot;all&quot;], optional):</span>
<span class="sd">            Region filter for the query. Defaults to None</span>
<span class="sd">            (parameter is not used in url). [December 2023 status: value &#39;all&#39;</span>
<span class="sd">            does not work for company and jobs]</span>
<span class="sd">        days_interval (int, optional): Days specified in date range per API call</span>
<span class="sd">            (test showed that 30-40 is optimal for performance). Defaults to 30.</span>
<span class="sd">        cols_to_drop (List[str], optional): List of columns to drop.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        vid_club_credentials (Dict[str, Any], optional): Stores the credentials</span>
<span class="sd">            information. Defaults to None.</span>
<span class="sd">        validate_df_dict (dict, optional): A dictionary with optional list of tests</span>
<span class="sd">            to verify the output</span>
<span class="sd">            dataframe. If defined, triggers the `validate_df` task from task_utils.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        timeout (int, optional): The time (in seconds) to wait while running this</span>
<span class="sd">            task before a timeout occurs. Defaults to 3600.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoint</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">from_date</span> <span class="o">=</span> <span class="n">from_date</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="n">to_date</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">items_per_page</span> <span class="o">=</span> <span class="n">items_per_page</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="n">region</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">days_interval</span> <span class="o">=</span> <span class="n">days_interval</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cols_to_drop</span> <span class="o">=</span> <span class="n">cols_to_drop</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vid_club_credentials</span> <span class="o">=</span> <span class="n">vid_club_credentials</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">validate_df_dict</span> <span class="o">=</span> <span class="n">validate_df_dict</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="n">vid_club_credentials</span><span class="p">[</span><span class="s2">&quot;token&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">credentials</span><span class="o">=</span><span class="n">vid_club_credentials</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># noqa: B026</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.vid_club.VidClub.build_query" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_query</span><span class="p">(</span><span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="p">,</span> <span class="n">api_url</span><span class="p">,</span> <span class="n">items_per_page</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Builds the query from the inputs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>from_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date for the query.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date for the query, if empty, will be executed as
datetime.today().strftime("%Y-%m-%d").</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>api_url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generic part of the URL to Vid Club API.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>items_per_page</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of entries per page.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>endpoint</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;jobs&#39;, &#39;product&#39;, &#39;company&#39;, &#39;survey&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The endpoint source to be accessed. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>region</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;bg&#39;, &#39;hu&#39;, &#39;hr&#39;, &#39;pl&#39;, &#39;ro&#39;, &#39;si&#39;, &#39;all&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Region filter for the query. Defaults to None
(parameter is not used in url). [December 2023 status: value 'all'
does not work for company and jobs]</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Final query with all filters added.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="viadot.exceptions.ValidationError">ValidationError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If any source different than the ones in the list are used.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/vid_club.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_query</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">from_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">api_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">items_per_page</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">,</span> <span class="s2">&quot;survey&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">region</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;bg&quot;</span><span class="p">,</span> <span class="s2">&quot;hu&quot;</span><span class="p">,</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span> <span class="s2">&quot;pl&quot;</span><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="s2">&quot;si&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Builds the query from the inputs.</span>

<span class="sd">    Args:</span>
<span class="sd">        from_date (str): Start date for the query.</span>
<span class="sd">        to_date (str): End date for the query, if empty, will be executed as</span>
<span class="sd">            datetime.today().strftime(&quot;%Y-%m-%d&quot;).</span>
<span class="sd">        api_url (str): Generic part of the URL to Vid Club API.</span>
<span class="sd">        items_per_page (int): number of entries per page.</span>
<span class="sd">        endpoint (Literal[&quot;jobs&quot;, &quot;product&quot;, &quot;company&quot;, &quot;survey&quot;], optional):</span>
<span class="sd">            The endpoint source to be accessed. Defaults to None.</span>
<span class="sd">        region (Literal[&quot;bg&quot;, &quot;hu&quot;, &quot;hr&quot;, &quot;pl&quot;, &quot;ro&quot;, &quot;si&quot;, &quot;all&quot;], optional):</span>
<span class="sd">            Region filter for the query. Defaults to None</span>
<span class="sd">            (parameter is not used in url). [December 2023 status: value &#39;all&#39;</span>
<span class="sd">            does not work for company and jobs]</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Final query with all filters added.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: If any source different than the ones in the list are used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">]:</span>
        <span class="n">region_url_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;region=</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">region</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="n">api_url</span><span class="si">}{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">?from=</span><span class="si">{</span><span class="n">from_date</span><span class="si">}</span><span class="s2">&amp;to=</span><span class="si">{</span><span class="n">to_date</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="n">region_url_string</span><span class="si">}</span><span class="s2">&amp;limit=</span><span class="si">{</span><span class="n">items_per_page</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;survey&quot;</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_url</span><span class="si">}{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">?language=en&amp;type=question&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Pick one these sources: jobs, product, company, survey&quot;</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">url</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.vid_club.VidClub.check_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_connection</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_date</span><span class="o">=</span><span class="s1">&#39;2022-03-22&#39;</span><span class="p">,</span> <span class="n">to_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">items_per_page</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initiate first connection to API to retrieve piece of data.</p>
<p>With information about type of pagination in API URL.
This option is added because type of pagination for endpoints is being changed
in the future from page number to 'next' id.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>endpoint</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;jobs&#39;, &#39;product&#39;, &#39;company&#39;, &#39;survey&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The endpoint source to be accessed. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>from_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date for the query, by default is the
oldest date in the data 2022-03-22.</p>
              </div>
            </td>
            <td>
                  <code>&#39;2022-03-22&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date for the query. By default None,
which will be executed as datetime.today().strftime("%Y-%m-%d") in code.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>items_per_page</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of entries per page.
100 entries by default.</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>region</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;bg&#39;, &#39;hu&#39;, &#39;hr&#39;, &#39;pl&#39;, &#39;ro&#39;, &#39;si&#39;, &#39;all&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Region filter for the query. Defaults to None
(parameter is not used in url). [December 2023 status: value 'all'
does not work for company and jobs]</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generic part of the URL to Vid Club API.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>], <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[Dict[str, Any], str]: Dictionary with first response from API with
JSON containing data and used URL string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="viadot.exceptions.ValidationError">ValidationError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If from_date is earlier than 2022-03-22.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="viadot.exceptions.ValidationError">ValidationError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If to_date is earlier than from_date.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/vid_club.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_connection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">,</span> <span class="s2">&quot;survey&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">from_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2022-03-22&quot;</span><span class="p">,</span>
    <span class="n">to_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">items_per_page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">region</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;bg&quot;</span><span class="p">,</span> <span class="s2">&quot;hu&quot;</span><span class="p">,</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span> <span class="s2">&quot;pl&quot;</span><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="s2">&quot;si&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initiate first connection to API to retrieve piece of data.</span>

<span class="sd">    With information about type of pagination in API URL.</span>
<span class="sd">    This option is added because type of pagination for endpoints is being changed</span>
<span class="sd">    in the future from page number to &#39;next&#39; id.</span>

<span class="sd">    Args:</span>
<span class="sd">        endpoint (Literal[&quot;jobs&quot;, &quot;product&quot;, &quot;company&quot;, &quot;survey&quot;], optional):</span>
<span class="sd">            The endpoint source to be accessed. Defaults to None.</span>
<span class="sd">        from_date (str, optional): Start date for the query, by default is the</span>
<span class="sd">            oldest date in the data 2022-03-22.</span>
<span class="sd">        to_date (str, optional): End date for the query. By default None,</span>
<span class="sd">            which will be executed as datetime.today().strftime(&quot;%Y-%m-%d&quot;) in code.</span>
<span class="sd">        items_per_page (int, optional): Number of entries per page.</span>
<span class="sd">            100 entries by default.</span>
<span class="sd">        region (Literal[&quot;bg&quot;, &quot;hu&quot;, &quot;hr&quot;, &quot;pl&quot;, &quot;ro&quot;, &quot;si&quot;, &quot;all&quot;], optional):</span>
<span class="sd">            Region filter for the query. Defaults to None</span>
<span class="sd">            (parameter is not used in url). [December 2023 status: value &#39;all&#39;</span>
<span class="sd">            does not work for company and jobs]</span>
<span class="sd">        url (str, optional): Generic part of the URL to Vid Club API.</span>
<span class="sd">            Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[Dict[str, Any], str]: Dictionary with first response from API with</span>
<span class="sd">            JSON containing data and used URL string.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: If from_date is earlier than 2022-03-22.</span>
<span class="sd">        ValidationError: If to_date is earlier than from_date.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">from_date</span> <span class="o">&lt;</span> <span class="s2">&quot;2022-03-22&quot;</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;from_date cannot be earlier than 2022-03-22.&quot;</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">to_date</span> <span class="o">&lt;</span> <span class="n">from_date</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;to_date cannot be earlier than from_date.&quot;</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>

    <span class="n">first_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_query</span><span class="p">(</span>
        <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
        <span class="n">from_date</span><span class="o">=</span><span class="n">from_date</span><span class="p">,</span>
        <span class="n">to_date</span><span class="o">=</span><span class="n">to_date</span><span class="p">,</span>
        <span class="n">api_url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
        <span class="n">items_per_page</span><span class="o">=</span><span class="n">items_per_page</span><span class="p">,</span>
        <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">first_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">first_url</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.vid_club.VidClub.get_response" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_response</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_date</span><span class="o">=</span><span class="s1">&#39;2022-03-22&#39;</span><span class="p">,</span> <span class="n">to_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">items_per_page</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Basing on the pagination type retrieved using check_connection function.</p>
<p>It gets the response from the API queried and transforms it into DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>endpoint</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;jobs&#39;, &#39;product&#39;, &#39;company&#39;, &#39;survey&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The endpoint source to be accessed. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>from_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date for the query, by default is the
oldest date in the data 2022-03-22.</p>
              </div>
            </td>
            <td>
                  <code>&#39;2022-03-22&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date for the query. By default None,
which will be executed as datetime.today().strftime("%Y-%m-%d") in code.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>items_per_page</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of entries per page.
100 entries by default.</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>region</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;bg&#39;, &#39;hu&#39;, &#39;hr&#39;, &#39;pl&#39;, &#39;ro&#39;, &#39;si&#39;, &#39;all&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Region filter for the query. Defaults to None
(parameter is not used in url). [December 2023 status: value 'all'
does not work for company and jobs]</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Table of the data carried in the response.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="viadot.exceptions.ValidationError">ValidationError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If any source different than the ones in the list are used.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/vid_club.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_response</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">,</span> <span class="s2">&quot;survey&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">from_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2022-03-22&quot;</span><span class="p">,</span>
    <span class="n">to_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">items_per_page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">region</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;bg&quot;</span><span class="p">,</span> <span class="s2">&quot;hu&quot;</span><span class="p">,</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span> <span class="s2">&quot;pl&quot;</span><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="s2">&quot;si&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Basing on the pagination type retrieved using check_connection function.</span>

<span class="sd">    It gets the response from the API queried and transforms it into DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        endpoint (Literal[&quot;jobs&quot;, &quot;product&quot;, &quot;company&quot;, &quot;survey&quot;], optional):</span>
<span class="sd">            The endpoint source to be accessed. Defaults to None.</span>
<span class="sd">        from_date (str, optional): Start date for the query, by default is the</span>
<span class="sd">            oldest date in the data 2022-03-22.</span>
<span class="sd">        to_date (str, optional): End date for the query. By default None,</span>
<span class="sd">            which will be executed as datetime.today().strftime(&quot;%Y-%m-%d&quot;) in code.</span>
<span class="sd">        items_per_page (int, optional): Number of entries per page.</span>
<span class="sd">            100 entries by default.</span>
<span class="sd">        region (Literal[&quot;bg&quot;, &quot;hu&quot;, &quot;hr&quot;, &quot;pl&quot;, &quot;ro&quot;, &quot;si&quot;, &quot;all&quot;], optional):</span>
<span class="sd">            Region filter for the query. Defaults to None</span>
<span class="sd">            (parameter is not used in url). [December 2023 status: value &#39;all&#39;</span>
<span class="sd">            does not work for company and jobs]</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Table of the data carried in the response.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: If any source different than the ones in the list are used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span>
    <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">,</span> <span class="s2">&quot;survey&quot;</span><span class="p">]:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The source has to be: jobs, product, company or survey&quot;</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">to_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">to_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">response</span><span class="p">,</span> <span class="n">first_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_connection</span><span class="p">(</span>
        <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
        <span class="n">from_date</span><span class="o">=</span><span class="n">from_date</span><span class="p">,</span>
        <span class="n">to_date</span><span class="o">=</span><span class="n">to_date</span><span class="p">,</span>
        <span class="n">items_per_page</span><span class="o">=</span><span class="n">items_per_page</span><span class="p">,</span>
        <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">keys_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">keys_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">keys_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">ind</span> <span class="o">=</span> <span class="s2">&quot;next&quot;</span> <span class="ow">in</span> <span class="n">keys_list</span>

    <span class="k">if</span> <span class="s2">&quot;data&quot;</span> <span class="ow">in</span> <span class="n">keys_list</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">while</span> <span class="n">length</span> <span class="o">==</span> <span class="n">items_per_page</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ind</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">next_page</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;next&quot;</span><span class="p">]</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_url</span><span class="si">}</span><span class="s2">&amp;next=</span><span class="si">{</span><span class="n">next_page</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_url</span><span class="si">}</span><span class="s2">&amp;page=</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">response_api</span> <span class="o">=</span> <span class="n">handle_api_response</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span>
            <span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">response_api</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">df_page</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
            <span class="n">df_page</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_page</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s2">&quot;product&quot;</span><span class="p">:</span>
                <span class="n">df_page</span> <span class="o">=</span> <span class="n">df_page</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">df_page</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">df</span><span class="p">,</span> <span class="n">df_page</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.vid_club.VidClub.intervals" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">intervals</span><span class="p">(</span><span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="p">,</span> <span class="n">days_interval</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Breaks dates range into smaller by provided days interval.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>from_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date for the query in "%Y-%m-%d" format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date for the query, if empty, will be executed as
datetime.today().strftime("%Y-%m-%d").</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>days_interval</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Days specified in date range per api call
(test showed that 30-40 is optimal for performance).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="list">list</span>[<span title="str">str</span>], <span title="list">list</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str], List[str]: Starts and Ends lists that contains information
about date ranges for specific period and time interval.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="viadot.exceptions.ValidationError">ValidationError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the final date of the query is before the start date.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/vid_club.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">intervals</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">from_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">to_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">days_interval</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Breaks dates range into smaller by provided days interval.</span>

<span class="sd">    Args:</span>
<span class="sd">        from_date (str): Start date for the query in &quot;%Y-%m-%d&quot; format.</span>
<span class="sd">        to_date (str): End date for the query, if empty, will be executed as</span>
<span class="sd">            datetime.today().strftime(&quot;%Y-%m-%d&quot;).</span>
<span class="sd">        days_interval (int): Days specified in date range per api call</span>
<span class="sd">            (test showed that 30-40 is optimal for performance).</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str], List[str]: Starts and Ends lists that contains information</span>
<span class="sd">            about date ranges for specific period and time interval.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: If the final date of the query is before the start date.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">to_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">to_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">to_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">from_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

    <span class="n">from_date_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">from_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">to_date_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">to_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">to_date_obj</span> <span class="o">-</span> <span class="n">from_date_obj</span>

    <span class="k">if</span> <span class="n">delta</span><span class="o">.</span><span class="n">days</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;to_date cannot be earlier than from_date.&quot;</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">interval</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_interval</span><span class="p">)</span>
    <span class="n">starts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ends</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">period_start</span> <span class="o">=</span> <span class="n">start_date</span>
    <span class="k">while</span> <span class="n">period_start</span> <span class="o">&lt;</span> <span class="n">end_date</span><span class="p">:</span>
        <span class="n">period_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">period_start</span> <span class="o">+</span> <span class="n">interval</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
        <span class="n">starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">period_start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">ends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">period_end</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">period_start</span> <span class="o">=</span> <span class="n">period_end</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">starts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ends</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">from_date</span><span class="p">)</span>
        <span class="n">ends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">to_date</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">starts</span><span class="p">,</span> <span class="n">ends</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="viadot.sources.vid_club.VidClub.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Looping get_response and iterating by date ranges defined in intervals.</p>
<p>Stores outputs as DataFrames in a list. At the end, daframes are concatenated
in one and dropped duplicates that would appear when quering.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>if_empty</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;warn&#39;, &#39;skip&#39;, &#39;fail&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What to do if a fetch
produce no data. Defaults to "warn</p>
              </div>
            </td>
            <td>
                  <code>&#39;warn&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Dataframe of the concatanated data carried in the responses.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/viadot/sources/vid_club.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">if_empty</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Looping get_response and iterating by date ranges defined in intervals.</span>

<span class="sd">    Stores outputs as DataFrames in a list. At the end, daframes are concatenated</span>
<span class="sd">    in one and dropped duplicates that would appear when quering.</span>

<span class="sd">    Args:</span>
<span class="sd">        if_empty (Literal[&quot;warn&quot;, &quot;skip&quot;, &quot;fail&quot;], optional): What to do if a fetch</span>
<span class="sd">            produce no data. Defaults to &quot;warn</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Dataframe of the concatanated data carried in the responses.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">starts</span><span class="p">,</span> <span class="n">ends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">(</span>
        <span class="n">from_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="p">,</span>
        <span class="n">to_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">to_date</span><span class="p">,</span>
        <span class="n">days_interval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">days_interval</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">dfs_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">starts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ends</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ingesting data for dates [</span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2">]-[</span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">]...&quot;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
                <span class="n">from_date</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                <span class="n">to_date</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
                <span class="n">items_per_page</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">items_per_page</span><span class="p">,</span>
                <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">dfs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfs_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dfs_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="n">from_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="p">,</span>
            <span class="n">to_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">to_date</span><span class="p">,</span>
            <span class="n">items_per_page</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">items_per_page</span><span class="p">,</span>
            <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">list_columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span><span class="o">.</span><span class="n">any</span><span class="p">()]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_columns</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols_to_drop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_to_drop</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Dropping following columns: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_to_drop</span><span class="si">}</span><span class="s2">...&quot;</span>
                <span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Column(s): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_to_drop</span><span class="si">}</span><span class="s2"> don&#39;t exist in the DataFrame.</span>
<span class="s2">                    No columns were dropped. Returning full DataFrame...&quot;&quot;&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Existing columns: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Provide columns to drop in a List.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_if_empty</span><span class="p">(</span><span class="n">if_empty</span><span class="o">=</span><span class="n">if_empty</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    2025-06-09
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 <a href="https://dyvenia.com/">dyvenia</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/dyvenia/viadot" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/dyvenia" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:hello@dyvenia.com" target="_blank" rel="noopener" title="hello@dyvenia.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top", "content.code.copy", "navigation.tracking", "toc.follow", "toc.integrate", "content.action.view", "content.action.edit", "announce.dismiss", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../../javascripts/tablesort.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>